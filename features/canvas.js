let queueToDraw=[];const iconRegistry={QS_ICON:{src:chrome.runtime.getURL("images/Prices/voxels_qs.png"),image:new Image}};for(const e in iconRegistry)iconRegistry[e].image.src=iconRegistry[e].src;function initializeCanvas(){const e=document.createElement("canvas");function t(){e.width=window.innerWidth,e.height=window.innerHeight}e.id="voxels-canvas",function t(){const i=document.querySelector("#game-container");i?i.appendChild(e):setTimeout(t,100)}(),t(),window.addEventListener("resize",t),function t(){const i=e.getContext("2d");i&&(i.clearRect(0,0,e.width,e.height),queueToDraw.length>0&&(i.font='15px "Press Start 2P"',i.textAlign="center",i.textBaseline="middle",queueToDraw.sort(((e,t)=>e.y-t.y)),queueToDraw.forEach((({x:e,y:t,text:n,shape:o,shapeParams:r})=>{if(n){const o=i.measureText(n).width,r=24;i.fillStyle="rgba(64, 64, 64, 0.9)",i.beginPath(),i.roundRect(e-o/2-10,t-r/2-5,o+20,r+10,10),i.fill(),i.strokeStyle="#6626ff",i.lineWidth=3,i.beginPath(),i.roundRect(e-o/2-10,t-r/2-5,o+20,r+10,10),i.stroke(),i.fillStyle="#e3ff36",i.fillText(n,e,t)}else if(o){if(i.beginPath(),"circle"===o){const{radius:n,width:o,height:a}=r;i.arc(e+o/2,t+a/2,n,0,2*Math.PI)}else if("rect"===o){const{width:n,height:o}=r;i.rect(e,t,n,o)}if(i.fillStyle=r.fillColor||"#ffffff",i.fill(),i.strokeStyle=r.borderColor||"#000000",i.lineWidth=r.borderWidth||1,i.stroke(),r.text){i.font='10px "Press Start 2P"',i.textAlign="center",i.textBaseline="top";const n=r.text.split("\n"),o=12,a=e+r.width/2,c=n.length*o,l=4,s=Math.max(...n.map((e=>i.measureText(e).width)))+2*l,h=c+2*l,f=a-s/2,d=t+r.height/2-h/2;r.textbg&&(i.fillStyle="rgba(34, 32, 68, 0.8)",i.fillRect(f,d,s,h),i.strokeStyle="#6626ff",i.lineWidth=1,i.strokeRect(f,d,s,h)),i.fillStyle="#e3ff36";const g=d+l;n.forEach(((e,t)=>{const n=g+t*o,r=e.match(/^(\d+)\s*\[(\w+)\]$/);if(r){const t=r[1],c=r[2],l=iconRegistry[c];if(l&&l.image.complete){const e=4,r=10,c=i.measureText(t).width,s=a-(c+e+r)/2;i.fillText(t,s+c/2,n),i.drawImage(l.image,s+c+e,n+(o-r)/2,r,r)}else i.fillText(e,a,n)}else i.fillText(e,a,n)}))}}})),queueToDraw=[]),requestAnimationFrame(t))}()}function entityOnScreen(e){if(cameraData&&"object"==typeof cameraData&&["left","right","top","bottom"].every((e=>e in cameraData))){const{left:t,right:i,top:n,bottom:o}=cameraData,r=e.x,a=e.x+e.width,c=e.y,l=e.y+e.height>=n&&c<=o;return a>=t&&r<=i&&l}return!1}function calculateScreenCoords(e){const t=cameraData;return{screenX:(e.x-t.left)*t.zoom,screenY:(e.y-t.top)*t.zoom,screenWidth:(void 0!==e.width?e.width:0)*t.zoom,screenHeight:(void 0!==e.height?e.height:0)*t.zoom}}