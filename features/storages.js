let mouseX=0,mouseY=0,isMobile=!1;function isMobileDevice(){return/Mobi|Android/i.test(navigator.userAgent)}isMobile=isMobileDevice(),document.addEventListener("mousemove",(e=>{mouseX=e.clientX,mouseY=e.clientY}));let currentStorageMid,currentLocation,currentCoinBalance=0,displayStorageHover=!0,firstLoadForPet=!0,uniqueItemNamesList=[],cachedStorages=null,previousPetInventory=null,cachedEntitiesMap=null,cachedStorageItemNames=[],cachedInventory=[],currentLand="",cameraData=null,cachedMixers=null;function handleEntityData(e){e.coinBalance!==currentCoinBalance&&e.coinBalance>0&&(currentCoinBalance=e.coinBalance),e.itemMixers&&(cachedMixers=e.itemMixers);if(e.storages&&JSON.stringify(cachedStorages)!==JSON.stringify(e.storages)){cachedStorages=e.storages;let t=e.location.match(/\d+/),n=t?t[0]:null;e.location.includes("speck")&&(n="speck"),(n&&autoUpdateLocations.includes(n)||e.location&&["PostOfficeInterior","DrunkenGooseInterior","mocaclub"].includes(e.location)&&autoUpdateLocations.includes(e.location))&&handleStorages(e.storages,e.location,!1)}if(e.petInventory&&JSON.stringify(e.petInventory)!==JSON.stringify(previousPetInventory)){previousPetInventory=JSON.parse(JSON.stringify(e.petInventory));let t=0;e.petInventory.items.forEach((e=>{const n=marketPrices[e.itemName];if(n){const o=n*e.quantity;t+=o}})),petInventoryValue=t}const t=function(e){const t=new Set;return e.storages?(cachedStorageItemNames=[],e.storages.forEach((e=>{e.items.forEach((e=>{t.add(e.itemName),cachedStorageItemNames.push(e.itemName)}))}))):cachedStorageItemNames.forEach((e=>{t.add(e)})),e.inventory&&e.inventory.items&&(e.inventory.items.forEach((e=>{t.add(e.item)})),JSON.stringify(cachedInventory)!==JSON.stringify(e.inventory.items)&&(cachedInventory=e.inventory.items,handleT4Data(cachedInventory,"inventory"))),e.petInventory&&e.petInventory.items&&e.petInventory.items.forEach((e=>{t.add(e.itemName)})),Array.from(t)}(e),n=[...uniqueItemNamesList].sort(),o=[...t].sort();if(JSON.stringify(n)!==JSON.stringify(o)&&(uniqueItemNamesList=[...t]),!isMobile&&displayStorageHover&&function(t){const n=document.querySelector(".voxels-extra-nodes"),o=document.querySelector(nodeNames.storageBox),i=document.querySelector("#voxels-main-modal");if(n)if(o||i&&i.matches(":hover")){const e=document.getElementById("voxels-storages-hover");e&&(e.remove(),currentStorageMid=0)}else if(t){let o,i=!1;if("pet"===t.id?(o=e.petInventory,i=!0):o=cachedStorages.find((e=>e.mid===t.id)),o){if(currentStorageMid!==(i?"pet":o.mid)){currentStorageMid=i?"pet":o.mid;let e=document.getElementById("voxels-storages-hover");e||(e=document.createElement("div"),e.id="voxels-storages-hover",n.appendChild(e)),e.innerHTML="";const t=i?"Pet Inventory":`Chest Tier ${Math.ceil(o.size/6)}`;let s=0;const c=document.createElement("div");c.classList.add("voxels-storages-hover-header");const r=document.createElement("div");r.textContent=t;const d=document.createElement("div");d.classList.add("voxels-storages-hover-header-value"),d.textContent=s;const l=document.createElement("img");l.src=chrome.runtime.getURL("images/Prices/coin.png"),d.prepend(l),c.appendChild(r),c.appendChild(d),e.appendChild(c);const m=document.createElement("div");m.classList.add("voxels-storages-hover-content");const u=i?Math.min(o.size,6):6;for(let e=0;e<Math.ceil(o.size/u);e++)for(let t=0;t<u;t++){const n=document.createElement("div");n.classList.add("voxels-storages-hover-cell");const i=e*u+t,a=o.items.find((e=>e.position===i));if(a){const e=displayNamesJSONArray.find((e=>e.item===a.itemName));if(e){const t=document.createElement("img");t.src=e.image,t.alt=a.itemName,n.appendChild(t);const o=document.createElement("div");o.classList.add("voxels-storages-hover-quantity"),o.textContent=`x${a.quantity}`,n.appendChild(o);const i=marketPrices[a.itemName];if(i){const e=i*a.quantity;if(s+=e,displayInventoryPrice){const t=document.createElement("div");t.classList.add("voxels-inventory-price"),t.textContent=nFormatter(e,1),t.innerHTML+='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">',n.appendChild(t)}}}else{const e=document.createElement("img");e.src="https://pixels-api.com/images/item_not_found.png",e.alt="Item not identified",n.appendChild(e);const t=document.createElement("div");t.classList.add("voxels-storages-hover-quantity"),t.textContent=`x${a.quantity}`,n.appendChild(t)}}m.appendChild(n)}function a(t){const n=window.innerWidth,o=window.innerHeight,i=e.offsetWidth,a=e.offsetHeight;let s=t.clientX,c=t.clientY;t.clientX+i>n&&(s=t.clientX-i),t.clientY+a>o&&(c=t.clientY-a),e.style.left=`${s}px`,e.style.top=`${c}px`}e.appendChild(m),d.innerHTML='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">'+nFormatter(s,3),a({clientX:mouseX,clientY:mouseY}),document.addEventListener("mousemove",a)}}else if(t.name===nodeNames.hover_node_01||t.name===nodeNames.hover_node_02){if(currentLandStorage&&currentStorageMid!==t.name){currentStorageMid=t.name;let e=currentLandStorage,o=document.getElementById("voxels-storages-hover");o||(o=document.createElement("div"),o.id="voxels-storages-hover",n.appendChild(o)),o.innerHTML="";const i="Land Surplus";let s=0;const c=document.createElement("div");c.classList.add("voxels-storages-hover-header");const r=document.createElement("div");r.textContent=i;const d=document.createElement("div");d.classList.add("voxels-storages-hover-header-value"),d.textContent=s;const l=document.createElement("img");l.src=chrome.runtime.getURL("images/Prices/coin.png"),d.prepend(l),c.appendChild(r),c.appendChild(d),o.appendChild(c);const m=document.createElement("div");m.classList.add("voxels-storages-hover-content");const u=Math.min(e.size,6);for(let t=0;t<Math.ceil(e.size/u);t++)for(let n=0;n<u;n++){const o=document.createElement("div");o.classList.add("voxels-storages-hover-cell");const i=t*u+n,a=e.items.find((e=>e.slot===i));if(a){const e=displayNamesJSONArray.find((e=>e.item===a.item));if(e){const t=document.createElement("img");t.src=e.image,t.alt=a.item,o.appendChild(t);const n=document.createElement("div");n.classList.add("voxels-storages-hover-quantity"),n.textContent=`x${a.quantity}`,o.appendChild(n);const i=marketPrices[a.item];if(i){const e=i*a.quantity;if(s+=e,displayInventoryPrice){const t=document.createElement("div");t.classList.add("voxels-inventory-price"),t.textContent=nFormatter(e,1),t.innerHTML+='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">',o.appendChild(t)}}}else{const e=document.createElement("img");e.src="https://pixels-api.com/images/item_not_found.png",e.alt="Item not identified",o.appendChild(e);const t=document.createElement("div");t.classList.add("voxels-storages-hover-quantity"),t.textContent=`x${a.quantity}`,o.appendChild(t)}}m.appendChild(o)}function a(e){const t=window.innerWidth,n=window.innerHeight,i=o.offsetWidth,a=o.offsetHeight;let s=e.clientX,c=e.clientY;e.clientX+i>t&&(s=e.clientX-i),e.clientY+a>n&&(c=e.clientY-a),o.style.left=`${s}px`,o.style.top=`${c}px`}o.appendChild(m),d.innerHTML='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">'+nFormatter(s,3),a({clientX:mouseX,clientY:mouseY}),document.addEventListener("mousemove",a)}}else{const e=document.getElementById("voxels-storages-hover");e&&(e.remove(),currentStorageMid=0)}}else{const e=document.getElementById("voxels-storages-hover");e&&(e.remove(),currentStorageMid=0)}}(e.hoverNode),e.location){let t=e.location.match(/\d+/),n=t?t[0]:"";e.location.includes("speck")&&(n="speck"),currentLocation!==e.location&&(currentLand=n,currentLocation=e.location)}}function handleStorages(e,t,n){if(!t.includes("unknown")){const o={};e.forEach((e=>{e.items.forEach((e=>{o[e.itemName]?o[e.itemName]+=e.quantity:o[e.itemName]=e.quantity}))}));const i=Object.entries(o).map((([e,t])=>({item:e,count:t})));document.querySelector(nodeNames.hudTopLeft)&&updateStoredItems(i,t,n)}}function updateStoredItems(e,t,n){chrome.storage.local.get("pid",(async function(o){const i={pid:o.pid,operation:"addStoredItems",extra:[{items:e},{location:t}]};try{const e=await makeRequestToTools(i);e.data.status&&e.data.data.lands&&(handleT4Data(e.data.data.lands,"storages"),storedItemCache=e.data.data.lands),n&&(loadingScreen(0),e.data.status&&loadNetworth(0))}catch(e){}}))}