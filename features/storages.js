let mouseX=0,mouseY=0,isMobile=!1;function isMobileDevice(){return/Mobi|Android/i.test(navigator.userAgent)}isMobile=isMobileDevice(),document.addEventListener("mousemove",e=>{mouseX=e.clientX,mouseY=e.clientY});let currentStorageMid,currentCoinBalance=0,displayStorageHover=!0,firstLoadForPet=!0,uniqueItemNamesList=[],cachedStorages=null,previousPetInventory=null,cachedEntitiesMap=null,cachedStorageItemNames=[],cachedInventory=[],currentLocation,currentLand="",cameraData=null,cachedMixers=null;function handleEntityData(e){e.coinBalance!==currentCoinBalance&&e.coinBalance>0&&(currentCoinBalance=e.coinBalance),e.itemMixers&&(cachedMixers=e.itemMixers);let t=e.storages&&JSON.stringify(cachedStorages)!==JSON.stringify(e.storages);if(t){cachedStorages=e.storages;let i=e.location.match(/\d+/),n=i?i[0]:null;e.location.includes("speck")&&(n="speck"),(n&&autoUpdateLocations.includes(n)||e.location&&["PostOfficeInterior","DrunkenGooseInterior","mocaclub"].includes(e.location)&&autoUpdateLocations.includes(e.location))&&handleStorages(e.storages,e.location,!1)}if(e.petInventory&&JSON.stringify(e.petInventory)!==JSON.stringify(previousPetInventory)){previousPetInventory=JSON.parse(JSON.stringify(e.petInventory));let a=0;e.petInventory.items.forEach(e=>{let t=currentPricesList[e.itemName];if(t){let i=t*e.quantity;a+=i}}),petInventoryValue=a}let o=function e(t){let i=new Set;return t.storages?(cachedStorageItemNames=[],t.storages.forEach(e=>{e.items.forEach(e=>{i.add(e.itemName),cachedStorageItemNames.push(e.itemName)})})):cachedStorageItemNames.forEach(e=>{i.add(e)}),t.inventory&&t.inventory.items&&(t.inventory.items.forEach(e=>{i.add(e.item)}),JSON.stringify(cachedInventory)!==JSON.stringify(t.inventory.items)&&handleT4Data(cachedInventory=t.inventory.items,"inventory")),t.petInventory&&t.petInventory.items&&t.petInventory.items.forEach(e=>{i.add(e.itemName)}),Array.from(i)}(e);if(JSON.stringify(uniqueItemNamesList)!==JSON.stringify(o)&&(uniqueItemNamesList=o).length>0&&fetchItemListPrices(uniqueItemNamesList),!isMobile&&displayStorageHover&&function t(i){let n=document.querySelector(".voxels-extra-nodes"),a=document.querySelector(nodeNames.storageBox);if(!n){console.error("Extra nodes container not found.");return}if(a){let o=document.getElementById("voxels-storages-hover");o&&(o.remove(),currentStorageMid=0);return}if(i){let r,s=!1;if("pet"===i.id?(r=e.petInventory,s=!0):r=cachedStorages.find(e=>e.mid===i.id),r){if(currentStorageMid!==(s?"pet":r.mid)){currentStorageMid=s?"pet":r.mid;let l=document.getElementById("voxels-storages-hover");l||((l=document.createElement("div")).id="voxels-storages-hover",n.appendChild(l)),l.innerHTML="";let c=s?"Pet Inventory":`Chest Tier ${Math.ceil(r.size/6)}`,d=0,m=document.createElement("div");m.classList.add("voxels-storages-hover-header");let u=document.createElement("div");u.textContent=c;let g=document.createElement("div");g.classList.add("voxels-storages-hover-header-value"),g.textContent=d;let v=document.createElement("img");v.src=chrome.runtime.getURL("images/Prices/coin.png"),g.prepend(v),m.appendChild(u),m.appendChild(g),l.appendChild(m);let p=document.createElement("div");p.classList.add("voxels-storages-hover-content");let h=s?Math.min(r.size,6):6;for(let f=0;f<Math.ceil(r.size/h);f++)for(let y=0;y<h;y++){let I=document.createElement("div");I.classList.add("voxels-storages-hover-cell");let x=f*h+y,E=r.items.find(e=>e.position===x);if(E){let L=displayNamesJSONArray.find(e=>e.item===E.itemName);if(L){let S=document.createElement("img");S.src=L.image,S.alt=E.itemName,I.appendChild(S);let C=document.createElement("div");C.classList.add("voxels-storages-hover-quantity"),C.textContent=`x${E.quantity}`,I.appendChild(C);let M=currentPricesList[E.itemName];if(M){let N=M*E.quantity;if(d+=N,displayInventoryPrice){let $=document.createElement("div");$.classList.add("voxels-inventory-price"),$.textContent=nFormatter(N,1),$.innerHTML+='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">',I.appendChild($)}}}else{let q=document.createElement("img");q.src="https://pixels-api.com/images/item_not_found.png",q.alt="Item not identified",I.appendChild(q);let B=document.createElement("div");B.classList.add("voxels-storages-hover-quantity"),B.textContent=`x${E.quantity}`,I.appendChild(B)}}p.appendChild(I)}function P(e){let t=window.innerWidth,i=window.innerHeight,n=l.offsetWidth,a=l.offsetHeight,o=e.clientX,r=e.clientY;e.clientX+n>t&&(o=e.clientX-n),e.clientY+a>i&&(r=e.clientY-a),l.style.left=`${o}px`,l.style.top=`${r}px`}l.appendChild(p),g.innerHTML='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">'+nFormatter(d,3),P({clientX:mouseX,clientY:mouseY}),document.addEventListener("mousemove",P)}}else{let X=document.getElementById("voxels-storages-hover");X&&(X.remove(),currentStorageMid=0)}}else{let Y=document.getElementById("voxels-storages-hover");Y&&(Y.remove(),currentStorageMid=0)}}(e.hoverNode),e.location){let r=e.location.match(/\d+/),s=r?r[0]:"";e.location.includes("speck")&&(s="speck"),currentLocation!==e.location&&(currentLand=s,currentLocation=e.location)}}function handleStorages(e,t,i){if(!t.includes("unknown")){let n={};e.forEach(e=>{e.items.forEach(e=>{n[e.itemName]?n[e.itemName]+=e.quantity:n[e.itemName]=e.quantity})});let a=Object.entries(n).map(([e,t])=>({item:e,count:t})),o=document.querySelector(nodeNames.hudTopLeft);o&&updateStoredItems(a,t,i)}}function updateStoredItems(e,t,i){chrome.storage.local.get("pid",async function(n){let a=n.pid;try{let o=await makeRequestToTools({pid:a,operation:"addStoredItems",extra:[{items:e},{location:t}]});o.data.status&&o.data.data.lands&&(handleT4Data(o.data.data.lands,"storages"),storedItemCache=o.data.data.lands),i&&(loadingScreen(0),o.data.status&&loadNetworth(0))}catch(r){console.error("Error updating entities:",r)}})}