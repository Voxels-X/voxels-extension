let mouseX=0,mouseY=0,isMobile=!1;function isMobileDevice(){return/Mobi|Android/i.test(navigator.userAgent)}isMobile=isMobileDevice(),document.addEventListener("mousemove",e=>{mouseX=e.clientX,mouseY=e.clientY});let currentStorageMid,currentCoinBalance=0,displayStorageHover=!0,firstLoadForPet=!0,uniqueItemNamesList=[],cachedStorages=null,previousPetInventory=null,cachedEntitiesMap=null,cachedStorageItemNames=[],currentLocation,currentLand="";function handleEntityData(e){e.coinBalance!==currentCoinBalance&&e.coinBalance>0&&(currentCoinBalance=e.coinBalance);let t=e.storages&&JSON.stringify(cachedStorages)!==JSON.stringify(e.storages);if(t){cachedStorages=e.storages;let i=e.location.match(/\d+/),n=i?i[0]:null;e.location.includes("speck")&&(n="speck"),(n&&autoUpdateLocations.includes(n)||e.location&&["PostOfficeInterior","DrunkenGooseInterior","mocaclub"].includes(e.location)&&autoUpdateLocations.includes(e.location))&&handleStorages(e.storages,e.location,!1)}if(e.petInventory&&JSON.stringify(e.petInventory)!==JSON.stringify(previousPetInventory)){previousPetInventory=JSON.parse(JSON.stringify(e.petInventory));let o=0;e.petInventory.items.forEach(e=>{let t=currentPricesList[e.itemName];if(t){let i=t*e.quantity;o+=i}}),petInventoryValue=o}let r=function e(t){let i=new Set;return t.storages?(cachedStorageItemNames=[],t.storages.forEach(e=>{e.items.forEach(e=>{i.add(e.itemName),cachedStorageItemNames.push(e.itemName)})})):cachedStorageItemNames.forEach(e=>{i.add(e)}),t.inventory&&t.inventory.items&&t.inventory.items.forEach(e=>{i.add(e.item)}),t.petInventory&&t.petInventory.items&&t.petInventory.items.forEach(e=>{i.add(e.itemName)}),Array.from(i)}(e);if(JSON.stringify(uniqueItemNamesList)!==JSON.stringify(r)&&(uniqueItemNamesList=r).length>0&&fetchItemListPrices(uniqueItemNamesList),!isMobile&&displayStorageHover&&function t(i){let n=document.querySelector(".voxels-extra-nodes"),o=document.querySelector(nodeNames.storageBox);if(!n){console.error("Extra nodes container not found.");return}if(o){let r=document.getElementById("voxels-storages-hover");r&&(r.remove(),currentStorageMid=0);return}if(i){let a,s=!1;if("pet"===i.id?(a=e.petInventory,s=!0):a=cachedStorages.find(e=>e.mid===i.id),a){if(currentStorageMid!==(s?"pet":a.mid)){currentStorageMid=s?"pet":a.mid;let l=document.getElementById("voxels-storages-hover");l||((l=document.createElement("div")).id="voxels-storages-hover",n.appendChild(l)),l.innerHTML="";let c=s?"Pet Inventory":`Chest Tier ${Math.ceil(a.size/6)}`,d=0,m=document.createElement("div");m.classList.add("voxels-storages-hover-header");let u=document.createElement("div");u.textContent=c;let g=document.createElement("div");g.classList.add("voxels-storages-hover-header-value"),g.textContent=d;let p=document.createElement("img");p.src=chrome.runtime.getURL("images/Prices/coin.png"),g.prepend(p),m.appendChild(u),m.appendChild(g),l.appendChild(m);let v=document.createElement("div");v.classList.add("voxels-storages-hover-content");let h=s?Math.min(a.size,6):6;for(let f=0;f<Math.ceil(a.size/h);f++)for(let y=0;y<h;y++){let E=document.createElement("div");E.classList.add("voxels-storages-hover-cell");let I=f*h+y,x=a.items.find(e=>e.position===I);if(x){let L=displayNamesJSONArray.find(e=>e.item===x.itemName);if(L){let S=document.createElement("img");S.src=L.image,S.alt=x.itemName,E.appendChild(S);let C=document.createElement("div");C.classList.add("voxels-storages-hover-quantity"),C.textContent=`x${x.quantity}`,E.appendChild(C);let N=currentPricesList[x.itemName];if(N){let $=N*x.quantity;if(d+=$,displayInventoryPrice){let M=document.createElement("div");M.classList.add("voxels-inventory-price"),M.textContent=nFormatter($,1),M.innerHTML+='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">',E.appendChild(M)}}}else{let q=document.createElement("img");q.src="https://pixels-api.com/images/item_not_found.png",q.alt="Item not identified",E.appendChild(q);let B=document.createElement("div");B.classList.add("voxels-storages-hover-quantity"),B.textContent=`x${x.quantity}`,E.appendChild(B)}}v.appendChild(E)}function P(e){let t=window.innerWidth,i=window.innerHeight,n=l.offsetWidth,o=l.offsetHeight,r=e.clientX,a=e.clientY;e.clientX+n>t&&(r=e.clientX-n),e.clientY+o>i&&(a=e.clientY-o),l.style.left=`${r}px`,l.style.top=`${a}px`}l.appendChild(v),g.innerHTML='<img src="'+chrome.runtime.getURL("images/Prices/coin.png")+'">'+nFormatter(d,3),P({clientX:mouseX,clientY:mouseY}),document.addEventListener("mousemove",P)}}else{let X=document.getElementById("voxels-storages-hover");X&&(X.remove(),currentStorageMid=0)}}else{let Y=document.getElementById("voxels-storages-hover");Y&&(Y.remove(),currentStorageMid=0)}}(e.hoverNode),e.location){let a=e.location.match(/\d+/),s=a?a[0]:"";e.location.includes("speck")&&(s="speck"),currentLocation!==e.location&&(currentLand=s,currentLocation=e.location)}}function handleStorages(e,t,i){if(!t.includes("unknown")){let n={};e.forEach(e=>{e.items.forEach(e=>{n[e.itemName]?n[e.itemName]+=e.quantity:n[e.itemName]=e.quantity})});let o=Object.entries(n).map(([e,t])=>({item:e,count:t})),r=document.querySelector(nodeNames.hudTopLeft);r&&updateStoredItems(o,t,i)}}function updateStoredItems(e,t,i){chrome.storage.local.get("pid",async function(n){let o=n.pid;try{let r=await makeRequestToTools({pid:o,operation:"addStoredItems",extra:[{items:e},{location:t}]});i&&(loadingScreen(0),r.data.status&&loadNetworth(0))}catch(a){console.error("Error updating entities:",a)}})}