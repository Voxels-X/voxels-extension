function loadGuildsPage(){chrome.storage.local.get("pid",(async function(e){const t={pid:e.pid,operation:"fetchUserGuilds"};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,t);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadGuildHome(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadGuildHome(e){var t=document.getElementById("voxels-full-page-main");t.innerHTML="";var a=document.createElement("div");a.setAttribute("id","voxels-guild-home");var l=document.createElement("div");l.classList.add("voxels-guild-top-row");var n=document.createElement("img");if(n.src=chrome.runtime.getURL("images/icons/icon__house.svg"),n.classList.add("voxels-guild-home-icon","clickable"),n.addEventListener("click",(function(){loadLeaderboard(e.guild_leaderboard)})),l.appendChild(n),e.player_guilds&&e.player_guilds.length>0){var i=document.createElement("div");i.classList.add("voxels-guild-dropdown");var d=document.createElement("button");d.classList.add("voxels-guild-dropdown-button","clickable"),d.innerText="‚ñº My Guilds",d.onclick=function(){i.classList.toggle("active")},i.appendChild(d);var s=document.createElement("div");s.className="voxels-guild-dropdown-content",e.player_guilds.forEach((e=>{var t=document.createElement("div");t.classList.add("voxels-guild-dropdown-element","clickable"),t.innerText=e.name,t.onclick=function(){openGuild(e.handle)},s.appendChild(t)})),i.appendChild(s),l.appendChild(i)}a.appendChild(l);var r=document.createElement("div");r.setAttribute("id","voxels-guild-main-area"),r.classList.add("voxels-scroll"),a.appendChild(r),t.appendChild(a),loadLeaderboard(e.guild_leaderboard)}function loadLeaderboard(e){let t=document.getElementById("voxels-guild-main-area");t.innerHTML="",e.forEach(((e,a)=>{var l=document.createElement("div");l.classList.add("voxels-guild-row","clickable"),l.onclick=function(){openGuild(e.handle)};var n=document.createElement("span");n.className="voxels-guild-place",n.textContent=a+1+".",l.appendChild(n);var i=document.createElement("img");i.src=e.emblem,i.className="voxels-guild-emblem",l.appendChild(i);var d=document.createElement("span");d.className="voxels-guild-name",d.textContent=e.name,l.appendChild(d);var s=document.createElement("span");s.className="voxels-guild-level",e.guild_total_level&&(s.textContent="üèÜ "+e.guild_total_level),l.appendChild(s);var r=document.createElement("span");r.className="voxels-guild-price",r.innerHTML="<img class='pixels-icon' src='"+chrome.runtime.getURL("images/Other/Pixel.png")+"'>"+(e.membership_count+1),l.appendChild(r),t.appendChild(l)}))}function openGuild(e){chrome.storage.local.get("pid",(async function(t){const a=t.pid,l={pid:a,operation:"fetchGuildData",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,l);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadGuildPage(e.data,a)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadGuildPage(e,t){let a=document.getElementById("voxels-guild-main-area");a.innerHTML="",a.scrollIntoView({behavior:"smooth",block:"start"});let l=e.guildStats,n=e.guildMembers.some((e=>"Owner"===e.role&&e.pid===t)),i=document.createElement("div");i.classList.add("voxels-guildpage-top"),a.appendChild(i);let d=document.createElement("img");d.src=l.emblem,d.className="voxels-guildpage-emblem",i.appendChild(d);let s=document.createElement("span");if(s.innerHTML='<a href="https://dashboard.pixels.xyz/guild/'+l.handle+'" target="_blank">'+l.name+"</a>",s.className="voxels-guildpage-name",i.appendChild(s),n){let e=document.createElement("img");e.src=chrome.runtime.getURL("images/icons/icon__settings.svg"),e.classList.add("voxels-guildpage-owner-settings","clickable"),e.addEventListener("click",(()=>ownerGuildSettings(l.handle))),s.appendChild(e)}if(l.voxels_membership_end){const t=new Date;if(new Date(l.voxels_membership_end)>t)if(l.guild_total_level){let t=document.createElement("span");if(t.innerHTML="üèÜ "+l.guild_total_level+" | Members: "+l.member_number+' | Price: <img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/Pixel.png")+'"> '+(l.membership_count+1),t.className="voxels-guildpage-level",i.appendChild(t),l.voxels_description){let e=document.createElement("p");e.textContent=l.voxels_description,e.className="voxels-guildpage-description",i.appendChild(e)}if(l.discord){let e=document.createElement("div");e.innerHTML='Discord: <a href="https://discord.gg/'+l.discord+'" target="_blank">https://discord.gg/'+l.discord+"</a>",e.className="voxels-guildpage-discord",i.appendChild(e)}if(l.guild_lands){let e=document.createElement("div");e.textContent=`Lands: ${l.guild_lands.replace(/[\[\]"]+/g,"").split(",").join(", ")}`,e.className="voxels-guildpage-lands",i.appendChild(e)}!function(e){let t=document.createElement("div");t.classList.add("voxels-guildpage-members"),a.appendChild(t);let l=document.createElement("div");function n(a,l){let n="asc"===t.getAttribute("data-sort-"+a);t.setAttribute("data-sort-"+a,n?"desc":"asc"),l&&(l.innerHTML=n?"‚ñ≤":"‚ñº");let i=e.guildMembers.sort(((e,t)=>{let l=e[a],i=t[a];return n?l-i:i-l}));var d;d=i,document.querySelectorAll(".voxels-guildpage-member-row").forEach((e=>e.remove())),d.forEach((e=>{let a=document.createElement("div");a.classList.add("voxels-guildpage-member-row","clickable"),a.addEventListener("click",(function(){loadPlayerPageTop(),loadPlayerPage(e.pid)})),e.username==username&&a.classList.add("voxels-guildpage-member-current");let l=document.createElement("span");if(l.textContent=e.username,l.className="voxels-guildpage-member-name",e.premium){let e=document.createElement("img");e.src=chrome.runtime.getURL("images/Other/Premium_small.png"),e.className="premium-icon",l.prepend(e)}a.appendChild(l);let n=document.createElement("span");n.textContent=e.role,a.appendChild(n);let i=document.createElement("span");i.textContent=e.level,a.appendChild(i);let d=document.createElement("span");d.textContent=e.premium?e.pixels_made:"",a.appendChild(d);let s=document.createElement("span");s.textContent=e.shards,a.appendChild(s),t.appendChild(a)}))}l.className="voxels-guildpage-legend",["Name","Role","Level","Pixels Made","Shards"].forEach((e=>{let t=document.createElement("span");if(t.textContent=e,t.className=`voxels-guildpage-legend-${e.toLowerCase().replace(/\s+/g,"-")}`,["Level","Pixels Made","Shards"].includes(e)){let a=document.createElement("span");a.innerHTML="‚ñº",a.className="sort-icon",t.onclick=()=>n(e.toLowerCase().replace(/\s+/g,"_"),a),t.appendChild(a)}l.appendChild(t)})),t.appendChild(l),n("level","")}(e);let n=document.createElement("div");n.innerHTML="Guild data gets updated every hour.",n.className="voxels-guildpage-premium-info",a.appendChild(n);let d=document.createElement("div"),s=document.createElement("a");s.href="javascript:void(0);",s.textContent="here",s.addEventListener("click",(function(){loadGuildPremium(l)})),d.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Prolong guild membership for '+l.name+" ",d.appendChild(s),d.className="voxels-guildpage-premium-info",a.appendChild(d)}else{let e=document.createElement("span");e.textContent="We are currently loading your guild data. Please allow for a couple minutes.",e.className="voxels-guildpage-info",i.appendChild(e)}else displayGuildPremium(i,l)}else displayGuildPremium(i,l)}function displayGuildPremium(e,t){let a=document.createElement("div"),l=document.createElement("a");l.href="javascript:void(0);",l.textContent="here.",l.addEventListener("click",(function(){loadGuildPremium(t)})),a.innerHTML='No active Voxels guild membership.<br><br><img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Acquire guild membership for '+t.name+" ",a.appendChild(l),a.className="voxels-guildpage-premium-info",e.appendChild(a)}function loadGuildPremium(e){chrome.storage.local.get("pid",(async function(t){const a=t.pid,l={pid:a,operation:"fetchGuildPremiumData",extra:e.handle};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,l);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadGuildPremiumPage(e.data,a)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadGuildPremiumPage(e,t){showFullOverlay(),guildData=e.guildStats;let a=document.getElementById("voxels-full-overlay-main");a.innerHTML="";var l=document.createElement("div");if(l.classList.add("voxels-guild-premium-top"),l.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'" alt="Guild Shield"> <span>Voxels Guild Membership</span> <img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'" alt="Guild Shield">',a.appendChild(l),guildData.voxels_membership_end){const e=new Date;if(new Date(guildData.voxels_membership_end)>e){var n=document.createElement("div");n.classList.add("voxels-guild-premium-explanation"),n.innerHTML="<p>Membership active: Ends on <span>"+guildData.voxels_membership_end+"</span></p>",a.appendChild(n)}}var i=document.createElement("div");i.classList.add("voxels-guild-premium-explanation"),i.innerHTML="<p>Acquire/Prolong Guild Membership for <span>"+guildData.name+'</span>:</p><p><span>+ 1 month of all membership features</span></p><p><span>+ 10<img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/pass.png")+'">Voxels Premium passes included</span></p>',a.appendChild(i),horizontalLine=document.createElement("hr"),horizontalLine.classList.add("voxels-guild-spacer"),a.appendChild(horizontalLine);var d=document.createElement("div");d.classList.add("voxels-guild-premium-explanation"),d.innerHTML='<p>How to:</p><p>Send<span><img class="pixels-icon" src="'+chrome.runtime.getURL("images/Other/Pixel.png")+'">'+e.guilds_price+"</span> from your wallet to:</p>";var s=document.createElement("p");s.classList.add("voxels-premium-copy","clickable"),s.setAttribute("id","voxels-copy"),s.setAttribute("translate","no"),s.innerHTML=e.voxels_addresses.rns+"<img src='"+chrome.runtime.getURL("images/icons/icon__copy.svg")+"' alt='Copy Icon'>",d.appendChild(s),s.addEventListener("click",(function(){var t=document.createElement("textarea");t.value=e.voxels_addresses.rns,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}));var r=document.createElement("p");r.classList.add("voxels-premium-copy","clickable"),r.setAttribute("translate","no");const o=e.voxels_addresses.base.replace(/^(.{6})(.*)(.{6})$/,"$1...$3");r.innerHTML=o+"<img src='"+chrome.runtime.getURL("images/icons/icon__copy.svg")+"' alt='Copy Icon'>",d.appendChild(r),r.addEventListener("click",(function(){var t=document.createElement("textarea");t.value=e.voxels_addresses.base,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}));var c=document.createElement("p");c.innerHTML="<span>After sending $PIXEL click:</span>",d.appendChild(c);var m=document.createElement("p");m.classList.add("voxels-premium-reload","clickable"),m.innerHTML="Claim Membership<img src='"+chrome.runtime.getURL("images/icons/icon__refresh.svg")+"' alt='Refresh Icon'>",d.appendChild(m);var p=0;m.addEventListener("click",(function(){var e=Date.now();e-p<1e4?showAlert("Please wait 10s before retrying.","error"):(p=e,m.disabled=!0,setTimeout((function(){m.disabled=!1}),1e4),checkGuildPremium(guildData.guild_id))})),a.appendChild(d)}function checkGuildPremium(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"checkGuildPremium",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),e.data.transaction_found?quickMessage("Successfully claimed membership!","success"):quickMessage("No new transaction found. Please retry in 10s","error")))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function ownerGuildSettings(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"fetchGuildOwnerPage",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadGuildOwnerPage(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadGuildOwnerPage(e){showFullOverlay(),guildData=e.guildStats;let t=document.getElementById("voxels-full-overlay-main");t.innerHTML="";let a=document.createElement("div");a.setAttribute("id","voxels-guild-owner-area"),a.classList.add("voxels-scroll"),t.appendChild(a);let l=document.createElement("div");l.classList.add("voxels-guildpage-top"),a.appendChild(l);let n=document.createElement("span");if(n.textContent=guildData.name,n.className="voxels-guildpage-name",l.appendChild(n),guildData.voxels_membership_end){const t=new Date;if(new Date(guildData.voxels_membership_end)>t){var i=document.createElement("div");i.classList.add("voxels-guild-premium-explanation"),i.innerHTML="<p>Membership active: Ends on <span>"+guildData.voxels_membership_end+"</span></p>",i.innerHTML+="<p>Membership acquired by <span>"+guildData.voxels_bought_by+"</span></p>";let t=document.createElement("div"),n=document.createElement("a");function d(e,t){let a="",l="";"description"===e?(a="Edit guild description (Max. length: 400 characters. Allowed characters: Letters, Digits, .,?!)",l=/^[a-zA-Z0-9.,?! ]{1,400}$/):"discord"===e&&(a="Edit discord tag (end part of your discord url)",l=/^[a-zA-Z0-9]{1,20}$/),inputWithCallback(a,(function(t){l.test(t)?updateGuildSettings(guildData.handle,e,t):quickMessage("Invalid input.","error")}))}if(n.href="javascript:void(0);",n.textContent="here.",n.addEventListener("click",(function(){loadGuildPremium(guildData)})),t.innerHTML='<img src="'+chrome.runtime.getURL("images/Other/guilds--shield-only.png")+'">Prolong guild membership for '+guildData.name+" ",t.appendChild(n),t.className="voxels-guildpage-premium-info",i.appendChild(t),guildData.voxels_description){let e=document.createElement("p");e.innerHTML="<span>Description:</span> "+guildData.voxels_description,i.appendChild(e)}let s=document.createElement("p");if(s.innerHTML="<span>Edit Description</span>",s.className="clickable",s.onclick=()=>d("description",guildData.guild_id),i.appendChild(s),guildData.discord){let e=document.createElement("p");e.innerHTML='<span>Discord:</span> <a href="https://discord.gg/'+guildData.discord+'" target="_blank">https://discord.gg/'+guildData.discord+"</a>",i.appendChild(e)}let r=document.createElement("p");r.innerHTML="<span>Edit Discord</span>",r.className="clickable",r.onclick=()=>d("discord",guildData.guild_id),i.appendChild(r),l.appendChild(i),e.guildMembers.forEach((e=>{e.pixels_made>0?e.cpratio=Math.round(-1*(e.coins_made-e.coins_spent)/e.pixels_made):e.cpratio=0})),function(e){let t=document.createElement("div");t.classList.add("voxels-guildpage-members"),a.appendChild(t);let l=document.createElement("div");function n(a,l){let n="asc"===t.getAttribute("data-sort-"+a);t.setAttribute("data-sort-"+a,n?"desc":"asc"),l&&(l.innerHTML=n?"‚ñ≤":"‚ñº");let i=e.guildMembers.sort(((e,t)=>{let l=e[a],i=t[a];return n?l-i:i-l}));var d;d=i,document.querySelectorAll(".voxels-guildpage-member-row").forEach((e=>e.remove())),d.forEach((e=>{let a=document.createElement("div");a.className="voxels-guildpage-member-row",e.username==username&&a.classList.add("voxels-guildpage-member-current");let l=document.createElement("span");if(l.textContent=e.username,l.className="voxels-guildpage-member-name",e.premium){let e=document.createElement("img");e.src=chrome.runtime.getURL("images/Other/Premium_small.png"),e.className="premium-icon",l.prepend(e)}a.appendChild(l);let n=document.createElement("span");n.textContent=e.role,a.appendChild(n);let i=document.createElement("span");i.textContent=e.level,a.appendChild(i);let d=document.createElement("span");d.textContent=e.premium?e.pixels_made:"",a.appendChild(d);let s=document.createElement("span");s.textContent=e.shards,a.appendChild(s);let r=document.createElement("span");r.textContent=e.premium?e.coins_spent:"",a.appendChild(r);let o=document.createElement("span");o.textContent=e.premium?e.cpratio:"",a.appendChild(o);let c=document.createElement("span");c.textContent=e.premium?e.tasks_done:"",a.appendChild(c);let m=document.createElement("span");m.textContent=e.premium?e.pixel_tasks:"",a.appendChild(m),t.appendChild(a)}))}l.className="voxels-guildpage-legend",["Name","Role","Level","Pixels Made","Shards","Coins spent","CPRatio","Tasks Done","Pixel tasks"].forEach((e=>{let t=document.createElement("span");if(t.textContent=e,t.className=`voxels-guildpage-legend-${e.toLowerCase().replace(/\s+/g,"-")}`,["Level","Pixels Made","Shards","Coins spent","CPRatio","Tasks Done","Pixel tasks"].includes(e)){let a=document.createElement("span");a.innerHTML="‚ñº",a.className="sort-icon",t.onclick=()=>n(e.toLowerCase().replace(/\s+/g,"_"),a),t.appendChild(a)}l.appendChild(t)})),t.appendChild(l),n("level","")}(e)}}}function updateGuildSettings(e,t,a){chrome.storage.local.get("pid",(async function(l){const n={pid:l.pid,operation:"updateGuildSettings",extra:JSON.stringify({handle:e,type:t,input:a})};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,n);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadGuildOwnerPage(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}