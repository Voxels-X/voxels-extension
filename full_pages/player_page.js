function loadLeaderboardPage(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"fetchPlayerLeaderboard",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadLeaderboardHome(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadLeaderboardHome(e){data=e.leaderboard,skill=e.skill,skill_list=e.skill_list,currentPlayer=e.currentPlayer;var t=document.getElementById("voxels-full-page-main");t.innerHTML="";var a=document.createElement("div");a.setAttribute("id","voxels-player-home");var l=document.createElement("div");l.classList.add("voxels-player-top-row");var n=document.createElement("img");n.src=chrome.runtime.getURL("images/icons/icon__house.svg"),n.classList.add("voxels-player-home-icon","clickable"),n.onclick=function(){loadLeaderboardHome(e)},l.appendChild(n);var s=document.createElement("img");s.src=chrome.runtime.getURL("images/icons/icon__player.svg"),s.classList.add("voxels-player-page-icon","clickable"),s.onclick=function(){chrome.storage.local.get("pid",(function(e){e.pid&&loadPlayerPage(e.pid)}))},l.appendChild(s);var r=document.createElement("div");r.classList.add("voxels-player-input-container");var i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("placeholder","Enter username, id or wallet..."),i.classList.add("voxels-player-input"),i.setAttribute("autocomplete","off");var o=document.createElement("button");o.setAttribute("id","playerSubmitButton"),o.innerHTML="&#8594;",o.classList.add("voxels-player-submit-button");const d=limiter((function(e){searchPlayer(e)}),5e3);o.onclick=function(){i.value.length<=45?d(i.value):quickMessage("Please check your input","error")},i.addEventListener("keydown",(function(e){document.activeElement===i&&(e.stopPropagation(),"Enter"===e.key&&document.getElementById("playerSubmitButton").click())}));const c=document.createElement("ul");function p(e){return e.toLowerCase().replace(/[^\p{L}\p{N}]/gu,"")}c.classList.add("voxels-player-input-suggestions","voxels-scroll"),r.appendChild(c),i.addEventListener("input",(function(){const e=p(i.value);if(c.innerHTML="",!e||0===usernames.length)return void(c.style.display="none");const t=[],a=[],l=[];for(const n of usernames){const s=p(n);s===e?t.push(n):s.startsWith(e)?a.push(n):s.includes(e)&&l.push(n)}const n=[...t,...a,...l].slice(0,100);0!==n.length?(c.style.display="block",n.forEach((e=>{const t=document.createElement("li");t.classList.add("voxels-player-input-suggestion","clickable"),t.textContent=e,t.addEventListener("click",(()=>{searchPlayer(e),i.value=e,c.innerHTML=""})),c.appendChild(t)}))):c.style.display="none"})),i.addEventListener("blur",(()=>{setTimeout((()=>{c.style.display="none"}),100)})),r.appendChild(i),r.appendChild(o),l.appendChild(r),a.appendChild(l);var m=document.createElement("div");m.setAttribute("id","voxels-player-main-area"),m.classList.add("voxels-scroll"),a.appendChild(m),createPlayerLeaderboard(m,data,skill,skill_list,currentPlayer),t.appendChild(a),initCustomSelect()}function createPlayerLeaderboard(e,t,a,l,n){e.innerHTML="";let s=document.createElement("div");s.classList.add("voxels-player-leaderboard");let r=document.createElement("div");r.classList.add("voxels-player-leaderboard-header");let i=document.createElement("div");i.classList.add("voxels-custom-select");let o=document.createElement("ul");o.classList.add("voxels-custom-select-items","voxels-custom-select-hide"),i.appendChild(o);let d=document.createElement("div");d.classList.add("voxels-custom-select-selected");const c=[{key:"totalxp",label:"Experience",iconSrc:chrome.runtime.getURL("images/icons/icon__xp.svg"),aliases:["overall","pixels","coins","totalxp"]},{key:"buck",label:"Buoy Buck",iconSrc:chrome.runtime.getURL("images/Prices/voxels_buoy.png"),aliases:["buck"]},{key:"liveops",label:"Stuff Stubs",iconSrc:chrome.runtime.getURL("images/Prices/voxels_stuffstubs.png"),aliases:["liveops"]},{key:"zoneztokens",label:"Zonez Tokens",iconSrc:chrome.runtime.getURL("images/Prices/voxels_zoneztokens.png"),aliases:["zoneztokens"]}];function p({key:e,label:t,iconSrc:a}){let l=document.createElement("li"),n=document.createElement("img");return n.classList.add("skill_logo"),n.src=a,l.appendChild(n),l.appendChild(document.createTextNode(t)),l.addEventListener("click",(()=>loadLeaderboardPage(e))),l}let m=c.find((e=>e.aliases.includes(a)));if(m){d.innerHTML="";let e=document.createElement("img");e.src=m.iconSrc,e.classList.add("skill_logo"),d.appendChild(e),d.appendChild(document.createTextNode(m.label)),a=m.key}else{let e=document.createElement("img");e.src=`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${a}.png?v2`,e.classList.add("skill_logo"),d.appendChild(e),d.appendChild(document.createTextNode(a))}i.appendChild(d),c.forEach((e=>{o.appendChild(p(e))})),l.forEach((e=>{o.appendChild(p({key:e,label:e,iconSrc:`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${e}.png?v2`}))})),["","","Overall"].forEach((e=>{let t=document.createElement("div");if(t.textContent=e,"Overall"===e){t.classList.add("clickable");const e=limiter((()=>loadLeaderboardPage("overall")),5e3);t.addEventListener("click",e)}r.appendChild(t)})),r.appendChild(i);let u=document.createElement("div");u.classList.add("voxels-player-leaderboard-header-currency-wrapper","clickable");let v=document.createElement("img");v.src=chrome.runtime.getURL("images/Other/Pixel.png"),v.classList.add("currency-icon");let g=document.createElement("span");g.classList.add("voxels-player-leaderboard-header-currency-wrapper-text"),g.textContent="Pixels",u.appendChild(g),u.appendChild(v),u.addEventListener("click",(()=>loadLeaderboardPage("pixels"))),r.appendChild(u);let h=document.createElement("div");h.classList.add("voxels-player-leaderboard-header-currency-wrapper","clickable");let y=document.createElement("img");y.src=chrome.runtime.getURL("images/Prices/coin.png"),y.classList.add("currency-icon");let x=document.createElement("span");x.classList.add("voxels-player-leaderboard-header-currency-wrapper-text"),x.textContent="Coins",h.appendChild(x),h.appendChild(y),h.addEventListener("click",(()=>loadLeaderboardPage("coins"))),r.appendChild(h),s.appendChild(r);let C=document.createElement("div");C.classList.add("voxels-player-leaderboard-rows","voxels-scroll");const L=(e,t)=>{let a=document.createElement("div");a.classList.add("voxels-player-leaderboard-currency-wrapper");let l=document.createElement("img");l.src=chrome.runtime.getURL(t),l.classList.add("currency-icon"),a.appendChild(l);const n=window.innerWidth<1350?nFormatter(e,2):e.toLocaleString();return a.appendChild(document.createTextNode(n)),a},f=(e,l=!1)=>{let n=document.createElement("div");n.classList.add("voxels-player-leaderboard-row","clickable"),(l||e.username===username)&&n.classList.add("voxels-player-leaderboard-row-current");let s=document.createElement("div");s.classList.add("voxels-player-leaderboard-rank"),s.textContent=e.position?e.position:t.indexOf(e)+1,n.appendChild(s);let r=document.createElement("div");r.classList.add("voxels-player-leaderboard-username"),r.textContent=e.username,n.appendChild(r);let i=document.createElement("div");i.classList.add("voxels-player-leaderboard-overalllvl"),i.textContent=e.overall_level,n.appendChild(i);let o=document.createElement("div");o.classList.add("voxels-player-leaderboard-skilllvl");"totalxp"===a?o.textContent=nFormatter(e.overall_total_xp,2):["buck","liveops","zoneztokens"].includes(a)?o.textContent=e[a]:o.textContent=e[a+"_level"],n.appendChild(o);let d=L(e.pixels,"images/Other/Pixel.png");n.appendChild(d);let c=L(e.coins,"images/Prices/coin.png");return n.appendChild(c),n.addEventListener("click",(()=>loadPlayerPage(e.pid))),n};t.forEach((e=>{C.appendChild(f(e))})),n&&C.appendChild(f(n,!0)),s.appendChild(C),e.appendChild(s)}function loadPlayerPage(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"fetchPlayerPageData",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadPlayerHome(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function loadPlayerHome(e){var t=document.getElementById("voxels-player-main-area");t.innerHTML="",t.scrollIntoView({behavior:"smooth",block:"start"});var a,l=document.createElement("div");l.classList.add("voxels-playerpage-container"),(a=document.createElement("div")).classList.add("voxels-playerpage-card"),(a=document.createElement("div")).classList.add("voxels-playerpage-card");var n=document.createElement("div");n.classList.add("voxels-playerpage-header");var s=document.createElement("div");s.classList.add("voxels-playerpage-iconlevel");var r=document.createElement("img");"Basic"===e.currentAvatar||e.currentAvatar.includes(".gif")||e.currentAvatar.includes("ipfs.io")?r.src=chrome.runtime.getURL("images/Other/Basic.png"):(r.src=e.currentAvatar,r.addEventListener("error",(function(){r.src=chrome.runtime.getURL("images/Other/Basic.png")}))),r.classList.add("voxels-playerpage-icon"),s.appendChild(r);var i=document.createElement("div");i.classList.add("voxels-playerpage-levelicon");var o=document.createElement("div");o.classList.add("voxels-playerpage-levelicon-line"),o.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>Rank </span>"+e.overall_position,i.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-playerpage-levelicon-line"),d.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>lvl </span>"+e.overall_level,i.appendChild(d);var c=document.createElement("div");c.classList.add("voxels-playerpage-levelicon-line"),c.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>XP </span>"+nFormatter(e.overall_total_xp,1),i.appendChild(c),s.appendChild(i),n.appendChild(s);const p=document.createElement("div");p.classList.add("voxels-playerpage-profile-balance");const m=document.createElement("div");m.classList.add("voxels-playerpage-balance-container"),p.appendChild(m);[{key:"cur_coins",img:"images/Prices/coin.png",value:e.coinBalances.cur_coins.toLocaleString("en-US")},{key:"cur_pixel",img:"images/Other/Pixel.png",value:e.coinBalances.cur_pixel},{key:"nft_lands",img:"images/pixels_icon.png",value:e.nftLandPixelsCount}].forEach((e=>{const t=document.createElement("div");t.classList.add("voxels-playerpage-balance-currency"),t.innerHTML=e.value;const a=document.createElement("img");a.src=chrome.runtime.getURL(e.img),t.prepend(a),m.appendChild(t)}));const u=document.createElement("div");u.classList.add("voxels-playerpage-balance-currency","voxels-playerpage-other-balances"),u.textContent="Other";const v=document.createElement("div");v.classList.add("voxels-playerpage-other-balance-popup"),[{label:"Buoy",key:"cur_buoybuck",img:"images/Prices/voxels_buoy.png"},{label:"QS",key:"cur_speedup",img:"images/Prices/voxels_qs.png"},{label:"Stuff Stubs",key:"cur_liveops",img:"images/Prices/voxels_stuffstubs.png"},{label:"Zonez Tokens",key:"cur_zoneztokens",img:"images/Prices/voxels_zoneztokens.png"}].forEach((t=>{const a=document.createElement("div");a.classList.add("voxels-playerpage-other-balance-item"),a.textContent=` ${e.coinBalances[t.key]||0}`;const l=document.createElement("img");l.src=chrome.runtime.getURL(t.img),a.prepend(l),v.appendChild(a)})),u.appendChild(v),m.appendChild(u),n.appendChild(p),a.appendChild(n);var g=document.createElement("div");g.classList.add("voxels-playerpage-skills-overview"),a.appendChild(g),e.current_skills.forEach((t=>{var a=document.createElement("div");a.classList.add("voxels-playerpage-skill-overview-entry");var l=document.createElement("img");l.src=`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${t}.png?v2`,l.alt=`${t} icon`,l.classList.add("voxels-playerpage-skill-overview-icon"),a.appendChild(l);var n=document.createElement("div");n.classList.add("voxels-playerpage-skill-overview-text"),n.innerHTML=`<span class="voxels-playerpage-skill-overview-level"><div class="voxels-playerpage-levelicon-prefix">Lvl</div> ${e[`${t}_level`]}</span>`,a.appendChild(n),g.appendChild(a)})),l.appendChild(a);var h=document.createElement("div");h.classList.add("voxels-playerpage-username"),h.innerHTML="<h2>"+e.username+"</h2>",l.appendChild(h);var y=document.createElement("div");y.classList.add("voxels-playerpage-info-section");var x=document.createElement("div");x.classList.add("voxels-playerpage-info-container");const C=document.createElement("div");C.className="voxels-playerpage-info-title-wrapper";const L=document.createElement("span");L.className="voxels-playerpage-info-title-text",L.textContent="Market Listings",C.appendChild(L),x.appendChild(C);const f=document.createElement("div");f.className="voxels-playerpage-info-title-extra";const E=e.player_market_data.reduce(((e,t)=>e+t.price*(t.quantity??0)),0),k=chrome.runtime.getURL("images/Prices/coin.png");f.innerHTML=`<span>Total:</span> \n    <img class="voxels-playerpage-coin-icon" src="${k}" alt="coin">\n    ${nFormatter(E,2)}\n    `,C.appendChild(f),x.appendChild(C);var b=document.createElement("div");if(b.classList.add("voxels-playerpage-info-content","voxels-scroll"),e.player_market_data.length>0){const t=document.createElement("div");t.classList.add("voxels-playerpage-market-flex");const a=document.createElement("div");a.classList.add("voxels-playerpage-market-row","voxels-playerpage-market-header-row");["Item","Price","#","Sold","Total","Added"].forEach(((e,l)=>{const n=document.createElement("div");n.classList.add("voxels-playerpage-market-col","sortable-column","clickable"),2!==l&&3!==l&&5!==l||n.classList.add("voxels-playerpage-market-col-sm"),n.textContent=`${e}`,n.addEventListener("click",(()=>{!function(e,t){const a=Array.from(e.querySelectorAll(".voxels-playerpage-market-row:not(.voxels-playerpage-market-header-row)")),l=e.dataset.sortCol,n=e.dataset.sortOrder||"asc",s=l==t&&"asc"===n,r=a[0].children[t-1].getAttribute("data-value"),i=!isNaN(parseFloat(r));a.sort(((e,a)=>{const l=e.children[t-1].getAttribute("data-value"),n=a.children[t-1].getAttribute("data-value");return i?s?parseFloat(n)-parseFloat(l):parseFloat(l)-parseFloat(n):s?n.localeCompare(l):l.localeCompare(n)})),a.forEach((t=>e.appendChild(t))),e.dataset.sortCol=t,e.dataset.sortOrder=s?"desc":"asc"}(t,l+1)})),a.appendChild(n)})),t.appendChild(a),e.player_market_data.forEach((e=>{const a=e.price*(e.quantity??0),l=e.itemId,n=marketPrices[l]||0,s=getNameForItem(l)||l,r=getImageForItem(l)||"https://pixels-api.com/images/item_not_found.png",i=`<img class="voxels-playerpage-coin-icon" src="${chrome.runtime.getURL("images/Prices/coin.png")}" alt="coin">`,o=new Date(e.createdAt).toLocaleDateString(void 0,{month:"numeric",day:"numeric"}),d=e.price<=n?"voxels-playerpage-market-col-green":"voxels-playerpage-market-col-red",c=document.createElement("div");c.classList.add("voxels-playerpage-market-row"),c.innerHTML=`\n            <div class="voxels-playerpage-market-col voxels-playerpage-item-cell" data-value="${s.toLowerCase()}">\n                <img class="voxels-playerpage-item-icon clickable" src="${r}" alt="${s}">\n                <span>${s}</span>\n            </div>\n            <div class="voxels-playerpage-market-col ${d}" data-value="${e.price}">${i}${nFormatter(e.price,2)}</div>\n            <div class="voxels-playerpage-market-col voxels-playerpage-market-col-sm" data-value="${e.quantity}">${(e.quantity??0)>99999?nFormatter(e.quantity,2):e.quantity??0}</div>\n            <div class="voxels-playerpage-market-col voxels-playerpage-market-col-sm" data-value="${e.purchasedQuantity??0}">${(e.purchasedQuantity??0)>99999?nFormatter(e.purchasedQuantity,2):e.purchasedQuantity??0}</div>\n            <div class="voxels-playerpage-market-col" data-value="${a}">${i}${nFormatter(a,2)}</div>\n            <div class="voxels-playerpage-market-col voxels-playerpage-market-col-sm" data-value="${e.createdAt}">${o}</div>\n        `,t.appendChild(c);const p=c.querySelector(".voxels-playerpage-item-cell"),m=p.querySelector("img");m.addEventListener("mouseenter",(()=>{const t=l,a=n*(e.quantity??0),r=nFormatter(a,1),i=nFormatter(n,1),o=document.createElement("div");o.classList.add("voxels-ms-hover");const d=document.createElement("div");d.classList.add("voxels-ms-hover-name"),d.textContent=s;const c=document.createElement("div");c.classList.add("voxels-ms-hover-price");const m=document.createElement("img");m.src=chrome.runtime.getURL("images/Prices/coin.png"),m.classList.add("voxels-ms-price-icon"),c.innerHTML=`${e.quantity} x `,c.appendChild(m),c.innerHTML+=` ${i} = `,c.appendChild(m.cloneNode()),c.innerHTML+=` ${r}`,o.appendChild(d),o.appendChild(c);const u=findRecipe(t);if(null!==u){const e=createRecipeContainer(u);o.appendChild(e)}const v=historic_item_prices(t);if(v){const e=document.createElement("div");e.classList.add("voxels-networth-hover-graph-container");const a=document.createElement("div");a.classList.add("voxels-networth-hover-graph-header"),a.textContent="7-day Graph",e.appendChild(a);let l=[...v];if(marketPrices[t]){const e=Math.floor(Date.now()/1e3);l.push({t:e,p:marketPrices[t]})}const n=renderPriceChart(l);e.appendChild(n),o.appendChild(e)}document.body.appendChild(o);const g=p.getBoundingClientRect(),h=o.offsetWidth,y=o.offsetHeight;let x=g.left+g.width/2-h/2,C=g.top-y-5;const L=window.innerWidth;x<0&&(x=5),x+h>L&&(x=L-h),C<0&&(C=5),o.style.position="absolute",o.style.left=`${x}px`,o.style.top=`${C}px`,premium&&(currentItemHovered=t,itemHoverLoop())})),m.addEventListener("mouseleave",(()=>{document.querySelectorAll(".voxels-ms-hover").forEach((e=>e.remove())),premium&&(currentItemHovered=null)}))})),b.appendChild(t)}else{(U=document.createElement("div")).classList.add("voxels-playerpage-info-empty-message"),U.textContent="No market listings found.",b.appendChild(U)}x.appendChild(b),y.appendChild(x);var P=document.createElement("div");P.classList.add("voxels-playerpage-info-container");const _=document.createElement("div");_.className="voxels-playerpage-info-title-wrapper";const w=document.createElement("span");w.className="voxels-playerpage-info-title-text",w.textContent="Player Info",_.appendChild(w),P.appendChild(_);var S=document.createElement("div");S.classList.add("voxels-playerpage-info-content","voxels-scroll","voxels-playerpage-info-content-guild");var T=document.createElement("div");T.classList.add("voxels-playerpage-meta");var $=document.createElement("p");$.classList.add("clickable"),$.textContent="ID "+e.pid,$.addEventListener("click",(function(){navigator.clipboard.writeText(e.pid).then((()=>{var e=document.createElement("span");e.textContent="Copied!",e.style.position="absolute",e.style.backgroundColor="#333",e.style.color="#fff",e.style.padding="5px",e.style.borderRadius="5px",e.style.top=$.offsetTop+"px",e.style.left=$.offsetLeft+$.offsetWidth+10+"px",e.style.zIndex=4e3,document.body.appendChild(e),setTimeout((()=>{document.body.removeChild(e)}),2e3)})).catch((e=>{}))})),T.appendChild($);var H=document.createElement("div");if(e.cryptoWallets.forEach((e=>{var t=document.createElement("p");"eth"===e.type.toLowerCase()?t.innerHTML="ETH <a target='_blank' href='https://etherscan.io/address/"+e.address+"'>"+e.address+"</a>":"Ronin"===e.type&&(t.innerHTML="RONIN <a target='_blank' href='https://app.roninchain.com/address/"+e.address+"'>"+e.address+"</a>"),H.appendChild(t)})),T.appendChild(H),e.vipExpiration){var R=document.createElement("p");R.textContent="VIP TILL "+formatDateTime(e.vipExpiration)+(e.vipTier?" - TIER "+e.vipTier:""),T.appendChild(R)}S.appendChild(T);var F=document.createElement("div");F.classList.add("voxels-playerpage-info-subsection");var N=document.createElement("div");if(N.classList.add("voxels-playerpage-info-content-title"),N.textContent="Player Name History",F.appendChild(N),e.player_name_history.length>0){var A=document.createElement("ul");A.classList.add("voxels-playerpage-info-subheader");var M=document.createElement("div");M.classList.add("voxels-playerpage-info-subsection-header-title-row");var I=document.createElement("div");I.classList.add("voxels-playerpage-info-subsection-header-title-row-name"),I.textContent="Name",M.appendChild(I);var q=document.createElement("div");q.classList.add("voxels-playerpage-info-subsection-header-title-count"),q.textContent="Date",M.appendChild(q),A.appendChild(M),F.appendChild(A),e.player_name_history.forEach((function(e){var t=document.createElement("li");t.classList.add("voxels-playerpage-info-row");var a=document.createElement("div");a.classList.add("voxels-playerpage-info-name"),a.textContent=e.username;var l=document.createElement("div");l.classList.add("voxels-playerpage-info-count"),l.textContent=e.date,t.appendChild(a),t.appendChild(l),F.appendChild(t)}))}else{var U;(U=document.createElement("div")).classList.add("voxels-playerpage-info-empty-message"),U.textContent="No player name changes.",F.appendChild(U)}S.appendChild(F);var z=document.createElement("div");z.classList.add("voxels-playerpage-info-subsection");var B=document.createElement("div");B.classList.add("voxels-playerpage-info-content-title"),B.textContent="Guilds",S.appendChild(B);var D=document.createElement("ul");D.classList.add("voxels-playerpage-info-subheader");var O=document.createElement("div");O.classList.add("voxels-playerpage-info-subsection-header-title-row");var G=document.createElement("div");G.classList.add("voxels-playerpage-info-subsection-header-title-row-name"),G.textContent="Name",O.appendChild(G);var W=document.createElement("div");if(W.classList.add("voxels-playerpage-info-subsection-header-title-count"),W.textContent="Shards",O.appendChild(W),D.appendChild(O),S.appendChild(D),0===e.guilds.length){var X=document.createElement("div");X.classList.add("voxels-playerpage-info-empty-message"),X.innerText="No guild shards found.",z.appendChild(X)}else{Object.keys(e.guilds).map((function(t){return{handle:t,...e.guilds[t]}})).sort((function(e,t){return t.count-e.count})).forEach((function(e){z.appendChild(function(e){var t=document.createElement("li");t.classList.add("voxels-playerpage-info-row");var a=document.createElement("div");a.classList.add("voxels-playerpage-info-emblem","clickable");var l=document.createElement("img"),n=e.emblem;n&&n.startsWith("cdn:/")&&(n=n.replace("cdn:/","https://mesh-online-assets.s3.us-east-2.amazonaws.com/")),l.src=n,l.alt=e.name+" emblem",l.style.width="32px",l.style.height="32px",a.appendChild(l);var s=document.createElement("div");s.classList.add("voxels-playerpage-info-name"),s.innerHTML=e.name;var r=document.createElement("div");return r.classList.add("voxels-playerpage-info-count"),r.innerHTML=e.count,t.appendChild(a),t.appendChild(s),t.appendChild(r),a.addEventListener("click",(function(){loadGuildPageTop(),openGuild(e.handle)})),t}(e))}))}S.appendChild(z),P.appendChild(S),y.appendChild(P),l.appendChild(y);const Q=document.createElement("div");Q.classList.add("voxels-playerpage-stats-container");const V=document.createElement("div");V.className="voxels-playerpage-info-title-wrapper";const Z=document.createElement("span");Z.className="voxels-playerpage-info-title-text",Z.textContent="Graph",V.appendChild(Z);const Y=document.createElement("div");Y.classList.add("voxels-stats-range-container");const j=limiter(updatePlayerGraph,4e3);let J="1w";["1w","3m","6m","12m"].forEach((t=>{const a=document.createElement("div");a.classList.add("clickable","voxels-stats-date-select"),a.textContent=t,a.dataset.range=t,t===J&&a.classList.add("selected-range"),a.addEventListener("click",(()=>{j(t,e.pid)&&(Y.querySelectorAll(".voxels-stats-date-select").forEach((e=>e.classList.remove("selected-range"))),a.classList.add("selected-range"),J=t)})),Y.appendChild(a)})),V.appendChild(Y),Q.appendChild(V);var K=document.createElement("div");K.id="playerGraph",Q.appendChild(K),l.appendChild(Q),generateAndAddPlayerChart(K,e);const ee=document.createElement("div");ee.classList.add("voxels-playerpage-stats-container");const te=document.createElement("div");te.className="voxels-playerpage-info-title-wrapper";const ae=document.createElement("span");ae.className="voxels-playerpage-info-title-text",ae.textContent="Skills",te.appendChild(ae),ee.appendChild(te);var le=document.createElement("div");le.classList.add("voxels-playerpage-skills-list"),e.current_skills.forEach((t=>{var a=document.createElement("div");a.classList.add("voxels-playerpage-skill-container");var l=document.createElement("div");l.classList.add("voxels-playerpage-skill-details");var n=document.createElement("div");n.classList.add("voxels-playerpage-skill-info");let s=Number(e[`${t}_total_xp`]).toLocaleString("en-US");if(n.innerHTML=`<div class="voxels-playerpage-skill-title">${t}</div> Rank: ${e[`${t}_position`]}, XP: ${s}`,l.appendChild(n),e.enable_level_up){var r=document.createElement("div");r.classList.add("voxels-playerpage-level-up");for(var i=e[`${t}_level`]+1,o=document.createElement("select"),d=i;d<=100;d++){var c=document.createElement("option");c.value=d,c.text=d,o.appendChild(c)}var p=document.createElement("span"),m=e[`${t}_total_xp`];function u(){var e=parseInt(o.value),t=Number(xpArray[e-1]-m).toLocaleString("en-US");p.textContent=`${t} XP`}o.addEventListener("change",u),u(),r.innerHTML="XP required for Level ",r.appendChild(o),r.appendChild(document.createTextNode(": ")),r.appendChild(p),l.appendChild(r)}a.appendChild(l);var v=document.createElement("div");v.classList.add("voxels-playerpage-skill-bar");var g=document.createElement("img");g.src=`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${t}.png?v2`,g.alt=t,g.classList.add("voxels-playerpage-skill-icon"),v.appendChild(g),(x=document.createElement("div")).classList.add("voxels-playerpage-skill-level"),x.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>Lvl</span>"+e[`${t}_level`],v.appendChild(x);var h=document.createElement("div");h.classList.add("voxels-playerpage-skill-progress-bar");var y=document.createElement("div");y.classList.add("voxels-playerpage-skill-progress-bar-inner");var x=e[`${t}_level`];if(y.style.width=`${x}%`,h.appendChild(y),v.appendChild(h),e.player_history&&e.player_history.length>0){var C=document.createElement("div");C.classList.add("voxels-playerpage-skill-tooltip"),document.body.appendChild(C),v.addEventListener("mouseenter",(function(a){var l="";[...e.player_history].reverse().forEach((e=>{if(void 0!==e[`${t}_level`]){let a=Number(e[`${t}_total_xp`]).toLocaleString("en-US");l+=`<span>${e.date}</span>: Level ${e[`${t}_level`]}, Total XP ${a}<br>`}})),C.innerHTML=l,C.style.display="block";var n=a.target.getBoundingClientRect();C.style.left=`${n.left+window.pageXOffset}px`,C.style.top=`${n.bottom+window.pageYOffset}px`})),v.addEventListener("mouseleave",(function(){C.style.display="none"}))}a.appendChild(v),le.appendChild(a)})),ee.appendChild(le),l.appendChild(ee),t.appendChild(l)}async function updatePlayerGraph(e,t){const a={operation:"getPlayerRangeData",extra:{range:e,mid:t}};loadingScreen(1);try{const t=await makeFetchRequestByPID(apiURL,a);handleErrors(t)||(loadingScreen(0),loadPlayerGraphRange(t.data,e))}catch(e){}}function loadPlayerGraphRange(e,t){const a=new Date(e.range_start),l=parseRangeToDays(t),n=[],s={};e.entries.forEach((e=>{s[e.date]={date:e.date,coins:parseFloat(e.coins),pixels:parseFloat(e.pixels)}}));let r=null;for(let e=0;e<l;e++){const t=new Date(a);t.setDate(a.getDate()+e);const l=t.toISOString().split("T")[0];s[l]?(r=s[l],n.push(s[l])):r?n.push({date:l,coins:r.coins,pixels:r.pixels}):n.push({date:l,coins:0,pixels:0})}n.sort(((e,t)=>e.date.localeCompare(t.date)));const i=(new Date).toISOString().split("T")[0];let o=s[i]??e.entries.length?s[e.entries[e.entries.length-1].date]:null;const d=document.getElementById("playerGraph");d&&(d.innerHTML="",generateAndAddPlayerChart(d,{player_history:n,coinBalances:{cur_coins:o?o.coins:0,cur_pixel:o?o.pixels:0}},!0))}function formatDateTime(e){var t=new Date(e);return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+("0"+t.getMinutes()).substr(-2)}function generateAndAddPlayerChart(e,t,a=!1){var l=function(e){var t=[],l=[],n=[];for(var s in e)e.hasOwnProperty(s)&&(t.push(s),l.push(e[s].pixels),n.push(e[s].coins));return{labels:t,datasets:[{label:"Pixels",data:l,borderColor:"#5ff600",backgroundColor:"#5ff600",fill:!1,tension:a?.6:.4,pointRadius:a?0:3,pointHoverRadius:a?0:5,yAxisID:"y"},{label:"Coins",data:n,borderColor:"#e3ff36",backgroundColor:"#e3ff36",fill:!1,tension:a?.6:.4,pointRadius:a?0:3,pointHoverRadius:a?0:5,yAxisID:"y1"}]}}(function(e){var t=e.player_history,a=e.coinBalances,l={};t.forEach((e=>{var t=e.date,a=parseFloat(e.pixels),n=parseFloat(e.coins);l[t]={pixels:a,coins:n}}));var n=(new Date).toISOString().split("T")[0],s=parseFloat(a.cur_pixel),r=parseFloat(a.cur_coins);return l[n]={pixels:s,coins:r},l}(t));!function(t,a,l){var n,s,r,i=(n=t,s=e,(r=document.createElement("canvas")).id=n,r.style.width="100%",r.style.height="400px",r.style.maxHeight="400px",s.appendChild(r),r.getContext("2d"));new Chart(i,{type:"line",data:a,options:l})}("playerChartCanvas",l,{responsive:!0,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!1},legend:{labels:{color:"white",font:{family:"'Press Start 2P'",size:6}}},tooltip:{titleColor:"white",bodyColor:"white",backgroundColor:"black",titleFont:{family:"'Press Start 2P'",size:6},bodyFont:{family:"'Press Start 2P'",size:6}}},scales:{x:{grid:{color:e=>0===e.tick.value?"white":"transparent"},ticks:{color:"white",font:{family:"'Press Start 2P'",size:6}}},y:{beginAtZero:!0,grid:{color:e=>0===e.tick.value?"white":"rgba(255, 255, 255, 0.2)"},border:{dash:e=>0===e.tick.value?[]:[2,4]},ticks:{color:"white",font:{family:"'Press Start 2P'",size:6}},title:{display:!0,text:"Pixels",color:"white",font:{family:"'Press Start 2P'",size:6}}},y1:{beginAtZero:!0,position:"right",grid:{drawOnChartArea:!1},ticks:{color:"white",font:{family:"'Press Start 2P'",size:6}},title:{display:!0,text:"Coins",color:"white",font:{family:"'Press Start 2P'",size:6}}}}})}function searchPlayer(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"searchPlayer",extra:e};loadingScreenFull(1);try{const e=await makeFetchRequestByPID(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreenFull(0),loadPlayerHome(e.data)))}catch(e){loadingScreenFull(0),quickMessage("Please try again.","error")}}))}function checkForAboutPage(){let e=document.querySelectorAll(nodeNames.playerPageAbout);if(0===e.length)return;if(document.querySelector(".aboutToVoxelsLink"))return;let t=document.createElement("div");t.classList.add("aboutToVoxelsLink","clickable");let a=document.createElement("img");a.src=chrome.runtime.getURL("images/logo.png"),a.alt="Logo";let l=document.createElement("span");l.innerText="Player Page",t.appendChild(a),t.appendChild(l),t.addEventListener("click",(()=>{let e=document.querySelector(nodeNames.playerPageUsername);if(e){let t=e.textContent.trim();openFullpage(),loadPlayerPageTop(),searchPlayer(t)}})),e[0].appendChild(t)}function showPlayerPagePremium(){var e=document.getElementById("voxels-full-page-main");e.innerHTML="";var t=document.createElement("div");t.className="voxels-playerpage-premium-container";var a=document.createElement("h3");a.className="voxels-playerpage-premium-heading",a.textContent="Voxels Premium feature";var l=document.createElement("p");l.className="voxels-playerpage-premium-text";var n=document.createElement("span");n.classList.add("voxels-playerpage-premium-link","clickable"),n.textContent="premium",n.onclick=function(){changeTab("premium")},l.textContent="Acquire ",l.appendChild(n),l.appendChild(document.createTextNode(" to view leaderboards, player stats with skills/coins/pixels/buoy bucks, player market listings, 12 month history and a lot more... and search for any player!"));var s=document.createElement("img");s.className="voxels-playerpage-premium-image",s.src=chrome.runtime.getURL("images/Premium/playerpage.png"),s.alt="Premium features",t.appendChild(a),t.appendChild(l),t.appendChild(s),e.appendChild(t)}