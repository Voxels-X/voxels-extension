let checkInterval,checkHudInterval,inventoryLoaded=!1,inventoryArray=[];const imageBlobToNameMap=new Map([[876,"mine"],[791,"coop"],[1210,"hutch"],[832,"apiary"]]);let imageHashMap,userPremium;function mainInterval(e,t){let n,r=!1;function o(){document.querySelectorAll(nodeNames.hudTopLeft).length>0&&(clearInterval(checkHudInterval),setTimeout(c,400),n=new Date)}imageHashMap=t,userPremium=e;var a=0;function c(){var e=Date.now();e-a>2e3&&(loadInventoryPrices(),a=e),checkHudInterval=setInterval((()=>{if(0===document.querySelectorAll(nodeNames.hudTopLeft).length)clearInterval(checkHudInterval),checkHudInterval=setInterval(o,100);else{if(!settings.useNewInventory){var e=Date.now();if(!location.href.endsWith("/gridcraft")){if(0===document.querySelectorAll(".voxels-inventory-price").length)e-a>1e4&&(loadInventoryPrices(),a=e)}}if(checkForAboutPage(),userPremium)checkInventoryChange(),r=checkForWindow(r,nodeNames.msCard,".voxels-contract-cost",addMSPrices),r&&setupDeliveries();else{const e=document.querySelectorAll(nodeNames.msCard);e&&e.length>0&&setupDeliveries()}(new Date-n)/1e3>=50&&(n=new Date,settings.useNewInventory||loadInventoryPrices(),userPremium&&setTasksCost())}}),500)}checkHudInterval=setInterval(o,100)}function checkForWindow(e,t,n,r){const o=document.querySelectorAll(t);if(e){if(0===o.length)return!1;return 0===document.querySelectorAll(n).length&&r(n),!0}return o.length>0&&(r(n),!0)}function checkInventoryChange(){const e=getCurrentInventory(!1);if(0===inventoryArray.length||0===e.length)return void(inventoryArray=e);const t=compareInventories(inventoryArray,e);!1!==t?(startTimerType(t),inventoryArray=getCurrentInventory(!0)):inventoryArray=e}function getCurrentInventory(e){const t=document.querySelectorAll(nodeNames.hudItems);let n=[];return t.forEach((t=>{const r=t.querySelector(nodeNames.hudItemImage),o=t.querySelector(nodeNames.hudQuantities),a=parseInt(t.querySelector(nodeNames.hudShortcut).textContent)-1;if(r&&o&&e){const e=r.src;fetch(e,{method:"GET"}).then((e=>e.headers.get("Content-Length"))).then((e=>{const t=o.textContent.replace("x",""),r=parseInt(t)||1;n[a]={length:e,quantity:r}})).catch((e=>{}))}else if(o){const e=o.textContent.replace("x",""),t=parseInt(e)||1;n[a]={length:null,quantity:t}}else n[a]=null})),n}function compareInventories(e,t){for(let n=0;n<t.length;n++){const r=t[n],o=e[n];if(null!==r&&(null===o&&r.quantity>=1&&r.quantity<=10||null!==o&&r.quantity>o.quantity&&r.quantity<=o.quantity+10)){const e=fetchImageAndCheckContent(n);if(!1!==e)return e}}return!1}function fetchImageAndCheckContent(e){const t=[].slice.call(document.querySelectorAll(nodeNames.hudShortcut)).filter((function(t){return t.innerHTML.trim()===String(e+1)}))[0].parentElement.querySelector(nodeNames.hudItemImage);if(t){const e=calculateAverageColor(t);if(imageHashMap[e])return imageHashMap[e]}return!1}function isEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}