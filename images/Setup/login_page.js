let instanceActive=!0,setupSuccessful=!1,searchIndustries=[];function getGameInstance(e){let t=window.Phaser;if(void 0!==t){let n=window.Phaser,s=n.Game,a=new Proxy(s,{construct:function t(n,s){let a=new n(...s);return e(a),a}});n.Game=a}else setTimeout(()=>getGameInstance(e),10)}function runGameInstance(e){let t=null;!function n(){if(setupSuccessful=!0,!e){console.log("Voxels: Connection lost... Please reload the page.",e);return}let s=e.scene.scenes[1];if(s){if(s.__cameraMonitorSetup||(monitorCamera(s),s.__cameraMonitorSetup=!0),s.__balanceMonitorSetup||(monitorBalance(s),s.__balanceMonitorSetup=!0),s.__landMonitorSetup||(monitorLand(s),s.__landMonitorSetup=!0),s.__inventoryMonitorSetup||(monitorInventory(s),s.__inventoryMonitorSetup=!0),s.__entityMonitorSetup||(monitorEntities(s),s.__entityMonitorSetup=!0),instanceActive){let a=e.scene.scenes[1].selfPlayer.playerData.label;window.postMessage({type:"VOXELS_PLAYER_LABEL",label:a})}let r=getPlayerData(e);r.inventoryData&&window.postMessage({type:"VOXELS_INV_DATA",data:r.inventoryData});try{let i=getEntities(e),l=i.storages,o=getStorages(l,e),u=e.scene.scenes[1].hoverNode,c=null;if(u&&u.propCache){let m=u.element?u.element:null;u.propCache.id?c={id:u.propCache.id,owner:u.propCache.owner,name:m}:u.playerData&&"pet"===u.playerData.kind&&(c={id:u.playerData.kind,owner:u.propCache.owner,name:m})}let d={},p=getPetInventoryData(e),f=JSON.stringify(o)!==JSON.stringify(t);f&&(d.storages=o,t=o),d.hoverNode=c,d.inventory=r.inventoryData||null,d.location=r.location||null,d.coinBalance=r.coinBalance||null,d.petInventory=p||null,d.itemMixers=i.itemMixers||null,Object.keys(d).length>0&&window.postMessage({type:"VOXELS_GAME_DATA",data:d})}catch(y){console.error("An error occurred:",y)}}setTimeout(n,200)}()}function voxelsCheckHud(){let e=document.querySelectorAll(".Hud_topLeftBackground__OhgQS");e.length>0&&(clearInterval(voxelsCheckHudInterval),setupSuccessful||voxelsQuickMessage("Error loading Voxels. Please reload Pixels","error"))}function monitorCamera(e){let t=e.cameras.main,{x:n,y:s}=t.worldView,a=t.zoom,r=t.worldView,i=()=>window.postMessage({type:"CAMERA_CHANGE",data:{height:r.height,width:r.width,bottom:r.y+r.height,top:r.y,left:r.x,right:r.x+r.width,zoom:t.zoom}});e.time.addEvent({delay:1e3/60,loop:!0,callback(){let{x:e,y:r}=t.worldView,l=t.zoom;(e!==n||r!==s||l!==a)&&(n=e,s=r,a=l,i())}}),e.time.addEvent({delay:500,loop:!0,callback:i})}function monitorBalance(e){let t=e?.stateManager?.selfPlayer?.coinInventory;if(!t||!t.$items){console.warn("No coin inventory found to monitor.");return}let n=new Map;for(let[s,a]of t.$items.entries())n.set(a.currencyId,a.balance);let r=()=>{let e=[];for(let[s,a]of t.$items.entries()){let r=a.balance,i=a.currencyId;n.get(i)!==r&&(e.push({currencyId:i,balance:r}),n.set(i,r))}e.length>0&&window.postMessage({type:"BALANCE_CHANGE",data:e})};e.time.addEvent({delay:100,loop:!0,callback:r})}function monitorLand(e){let t=e?.stateManager;if(!t){console.warn("No state manager found to monitor.");return}let n=["producer","crafting","business","petcare","total"],s={mapId:"",landAttributes:new Map},a=()=>{let e={mapId:t.mapId,landAttributes:new Map},a=s.mapId!==e.mapId;for(let r of n){let i=t.mapLimits?.$items?.get(r);if(i){let{max:l,used:o}=i;e.landAttributes.set(r,{max:l,used:o});let u=s.landAttributes.get(r);u&&u.max===l&&u.used===o||(a=!0)}}a&&(s=e,window.postMessage({type:"LAND_CHANGE",data:{mapId:e.mapId,landAttributes:Array.from(e.landAttributes.entries()).map(([e,{max:t,used:n}])=>({attribute:e,max:t,used:n}))}}))};e.time.addEvent({delay:100,loop:!0,callback:a})}function monitorInventory(e){let t=e?.stateManager;if(!t)return;let n=null,s=()=>{let t=e.stateManager.selfPlayer?JSON.parse(JSON.stringify(e.stateManager.selfPlayer.inventory)):null;if(!t||!t.slots)return;let s={activeRow:t.activeRow??null,size:t.size??null,items:Object.entries(t.slots).map(([e,t])=>({slot:Number(e),item:t.item,quantity:t.quantity,state:t.state||null}))};n&&JSON.stringify(n)===JSON.stringify(s)||(n=s,window.postMessage({type:"INVENTORY_CHANGE",data:s}))};e.time.addEvent({delay:100,loop:!0,callback:s})}function flattenCurrentState(e){return e&&"object"==typeof e?Object.entries(e).reduce((e,[t,n])=>("object"==typeof n&&null!==n?Object.entries(n).forEach(([n,s])=>{e[`${t}_${n}`]=s}):e[t]=n,e),{}):e}function monitorEntities(e){let t=e?.stateManager;if(!t)return;let n=null,s=()=>{let s=e.entities?JSON.parse(JSON.stringify(Array.from(e.entities.entries()).filter(([e,t])=>searchIndustries.some(e=>t.element.startsWith(e))).map(([e,t])=>{let n=t.currentState||{},s=n?.statics?Object.values(n.statics).find(e=>"soilTier"===e.name):null,a=n?.statics?Object.values(n.statics).find(e=>"maturetime"===e.name):null,r=n?.displayInfo?.utcTarget??null,i=n?.statics?Object.values(n.statics).find(e=>"finishTime"===e.name):null,l={s:n?.state||null};return i&&i.value>r?l.fT=Math.round(i.value):r&&(l.fT=Math.round(r)),s&&(l.sT=s.value),a&&(l.mT=a.value),{e:t.element,cS:l}}))):null;if(!s)return;let a=t?.room?.state;if(!a)return;let r=a.id,i=a.guild?a.guild:null,l=a.levels?.$items?Object.fromEntries(Array.from(a.levels.$items.entries()).map(([e,t])=>[e,t.level])):{},o=a.permissions?.use?Array.from(a.permissions.use.$items.values()):[],u=a.nft?.traits?Object.fromEntries(Object.entries(a.nft.traits)):{},c=a.storage?.size??0,m=a.storage?.slots?.$items?Array.from(a.storage.slots.$items.entries()).map(([e,t])=>({slot:parseInt(e,10),item:t.item,quantity:t.quantity})):[],d=a.members?.$items?Object.fromEntries(Array.from(a.members.$items.entries()).map(([e,t])=>{let n=t.member,s=t.roles?.$items?Array.from(t.roles.$items.values()).slice(0,1).map(e=>"BLOCK"===e?"BLOCK":"Builder"):[];return[n,s]})):{},p={...flattenCurrentState({levels:l,permissions:o,traits:u}),storage:{size:c,items:m},guild:i,members:d},f={id:r,entities:s,landInfo:p};n&&JSON.stringify(n)===JSON.stringify(f)||(n=f,window.postMessage({type:"LAND_DATA_CHANGE",data:f}))};e.time.addEvent({delay:100,loop:!0,callback:s})}function getPlayerData(e){let t=[];if(e.scene.scenes[1]){let n=e.scene.scenes[1],s=n.playerId,a=n.stateManager.selfPlayer?n.stateManager.selfPlayer.farms:null,r=null,i=null;a&&a.$items&&(r=a.$items.get(0),i=a.$items.get(1));let l=n.stateManager.mapId,o=l.match(/\d+/),u=o?o[0]:"unknown",c;c=l&&""!==l.trim()?r&&l.includes(r)?`speck-farm-${u}`:i&&l.includes(i)?`speck-house-${u}`:l.includes("House")?`${u}-house`:l.includes("Farm")?`${u}-farm`:l:"unknown";let m=n.stateManager.selfPlayer?n.stateManager.selfPlayer.inventory:null,d=null;if(m){let p=m.size,f=m.activeRow,y=m.slots.$items,g=[];y.forEach((e,t)=>{g.push({slot:t,item:e.item,quantity:e.quantity})}),d={size:p,activeRow:f,items:g}}let v=0;if(n?.stateManager?.selfPlayer?.coinInventory){let h=n.stateManager.selfPlayer.coinInventory;if(h.$items){for(let[$,E]of h.$items.entries())if("cur_coins"===E.currencyId){v=E.balance;break}}}t={playerId:s,location:c,inventoryData:d,coinBalance:v}}return t}function getEntities(e){let t=[];if(!e.scene.scenes[1])return[];{let n=e.scene.scenes[1],s=n.playerId,a=n.entities,r=new Map;a.forEach((e,n)=>{e&&e.owner===s&&e.element&&(e.element.includes("storage_box")||e.element.includes("woodchest")||e.element.includes("storageChest")||e.element.includes("moca_storage")||e.element.includes("xmasStorage")||e.element.includes("halloween_2024_storage"))&&e.owner===s&&t.push(e.mid)});let i=Array.from(r,([e,t])=>({element:e,count:t})),l=null;return n.sys?.config==="roomcavehub"&&(l=[],a.forEach((e,t)=>{if(e.element&&["ent_guano_mixer","ent_spore_chamber","ent_goo_pot"].includes(e.element)&&e.currentState?.trackers){let n=getEntityInfo(e.currentState);l[e.element]={...n.trackers,state:n.state,x:e.x||null,y:e.position?.y!=null&&null!=e.height?e.position.y+e.height:null}}})),{storages:t,entities_map:i,itemMixers:l}}}function simplifyArray(e){return e&&Array.isArray(e)?e.reduce((e,t)=>(e[t.name]=t.numeric?parseFloat(t.value):t.value,e),{}):{}}function getEntityInfo(e){return e?{...e,trackers:simplifyArray(e.trackers)}:null}function getStorages(e,t){let n=t.scene.scenes[1];if(!n.stateManager||!n.stateManager.selfPlayer||!n.stateManager.selfPlayer.entities)return[];let s=n.stateManager.selfPlayer.entities.$items,a=n.entities,r=e.map(e=>{let t=s.get(e),n=a.get(e);if(t&&t.storage){let r={mid:e,size:t.storage.size,items:[],position:n?{x:n.position.x,y:n.position.y,width:n.width,height:n.height}:null};return t.storage.slots.$items.forEach((e,t)=>{e&&e.item&&r.items.push({position:e.slot,itemName:e.item,quantity:e.quantity})}),r}if(n&&n.element&&n.element.includes("woodchest")){let i;switch(n.element){case"ent_woodchest_01":i=6;break;case"ent_woodchest_02":i=12;break;case"ent_woodchest_03":i=18;break;case"ent_woodchest_04":i=24;break;default:i=0}if(i>0)return{mid:e,size:i,items:[],position:{x:n.position.x,y:n.position.y}}}return null});return r.filter(e=>null!==e)}function getPetInventoryData(e){let t=e.scene.scenes[1]?.stateManager?.selfPlayer?.pet;if(t&&t.inventory){let n=t.inventory.slots,s=[];return n.$items.forEach(e=>{e&&e.item&&s.push({position:e.slot,itemName:e.item,quantity:e.quantity||0})}),{size:t.inventory.size,items:s}}return null}window.postMessage({type:"VOXELS_INITIATED"}),window.addEventListener("message",e=>{e.source===window&&(e.data.type&&"VOXELS_SET_INSTANCE_ACTIVE"===e.data.type?instanceActive=e.data.value:e.data.type&&"VOXELS_SEARCH_ENTITIES"===e.data.type&&(searchIndustries=e.data.data))}),voxelsCheckHudInterval=setInterval(voxelsCheckHud,100),getGameInstance(runGameInstance);let previousCustomObjectsArray=[];function arraysAreEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}function getPropsFromTaskItems(e){let t=document.querySelector(e);if(t){let n=Object.keys(t).find(e=>e.startsWith("__reactFiber$"));if(n){let s=t[n],a=s?.memoizedProps;if(a&&a.children&&Array.isArray(a.children[0])){let r=a.children[0].map(e=>e.props),i=r.map((e,t)=>{if(e.request&&e.request.item){let n=e.request.item||{},s=e.reward.currency||{},a=e.reward.skill||{},r;switch(e.playerClassId){case"f2p":r="Basic";break;case"vip":r="VIP";break;case"landowner":r="Landowner";break;default:r="Unknown"}return{position:t,type:r,name:n.name||"N/A",tier:n.tier||"N/A",quantity:e.request.quantity||"N/A",canFill:e.canFill||!1,rewardCurrency:s.currencyId||"coins",rewardAmount:s.amount||"N/A",skillType:a.skillType||"N/A",skillXp:a.xp||"N/A"}}{let i=e.cooldownEndTimestamp;return{position:t,type:"Unknown",itemName:"Loading...",reloadTimestamp:Math.floor(i/1e3)}}});arraysAreEqual(i,previousCustomObjectsArray)||(previousCustomObjectsArray=i,window.postMessage({type:"VOXELS_TASK_DATA",value:i},"*"))}}}}function voxelsQuickMessage(e,t){let n=3e3;"news"==t&&(n=6e3);var s=document.querySelector(".voxels-quick-message-popup");s&&s.remove();var a=document.createElement("div");a.className="voxels-quick-message-popup voxels-"+t,a.innerHTML='<p>Voxels:</p><p class="voxels-quick-info">'+e+'</p><div class="voxels-progress-bar"></div>',document.body.appendChild(a);var r=document.createElement("div");r.className="dismiss-pop-up clickable",r.innerText="X",a.appendChild(r),a.querySelector(".voxels-progress-bar").style.animation="voxels-progressBarAnimation "+n/1e3+"s linear forwards",r.addEventListener("click",function(){a.remove()}),setTimeout(function(){a.style.animation="0.5s ease 0s 1 normal forwards running voxels-slideOut",setTimeout(function(){a.remove()},500)},n)}window.addEventListener("message",function(e){if("VOXELS_NODE_INPAGE"===e.data.type){let t=e.data.value;t.taskContent&&setInterval(()=>getPropsFromTaskItems(t.taskContent),200)}});let currentMarketItem=null;function checkElementExistence(){let e=document.body,t=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){let n=document.querySelector(".MarketplaceItemListings_content__eeHjR");if(n){let s=Object.keys(n).find(e=>e.includes("__reactProps$"));if(s){let a=n[s],r=a?.children?.[1]?.props?.item?.id;r&&currentMarketItem!==r&&(currentMarketItem=r,window.postMessage({type:"VOXELS_MARKET_ITEM",data:currentMarketItem}))}}else null!==currentMarketItem&&(currentMarketItem=null)}});t.observe(e,{childList:!0,subtree:!0})}checkElementExistence();