let instanceActive=!0;function getGameInstance(e){let t=window.Phaser;if(void 0!==t){let n=window.Phaser,s=n.Game,a=new Proxy(s,{construct:function t(n,s){let a=new n(...s);return e(a),a}});n.Game=a}else setTimeout(()=>getGameInstance(e),10)}function runGameInstance(e){!function t(){if(e.scene.scenes[1]){if(instanceActive){let n=e.scene.scenes[1].selfPlayer.playerData.label;window.postMessage({type:"VOXELS_PLAYER_LABEL",label:n})}let s=getPlayerData(e);s.inventoryData&&window.postMessage({type:"VOXELS_INV_DATA",data:s.inventoryData});try{let a=getEntities(e),r=getStorages(a,e),i=e.scene.scenes[1].hoverNode,o=null;i&&i.propCache&&(i.propCache.id?o={id:i.propCache.id,owner:i.propCache.owner}:i.playerData&&"pet"===i.playerData.kind&&(o={id:i.playerData.kind,owner:i.propCache.owner}));let l=getPetInventoryData(e),c={storages:r,hoverNode:o,inventory:s.inventoryData||null,petInventory:l||null};window.postMessage({type:"VOXELS_GAME_DATA",data:c})}catch(u){console.error("An error occurred:",u)}}setTimeout(t,100)}()}function getPlayerData(e){let t=[];if(e.scene.scenes[1]){let n=e.scene.scenes[1],s=n.playerId,a=n.sys.config,r=a.match(/\d+/),i=r?r[0]:"unknown",o;o=a.includes("House")?`${i}-house`:a.includes("Farm")?`${i}-farm`:`${i}-unknown`;let l=n.stateManager.selfPlayer?n.stateManager.selfPlayer.inventory:null,c=null;if(l){let u=l.size,p=l.activeRow,m=l.slots.$items,y=[];m.forEach((e,t)=>{y.push({slot:t,item:e.item,quantity:e.quantity})}),c={size:u,activeRow:p,items:y}}t={playerId:s,location:o,inventoryData:c}}return t}function getEntities(e){let t=[];if(!e.scene.scenes[1])return[];{let n=e.scene.scenes[1],s=n.playerId,a=n.entities;return a.forEach((e,n)=>{e&&e.element&&(e.element.includes("woodchest")||e.element.includes("storageChest")||e.element.includes("moca_storage"))&&e.owner===s&&t.push(e.mid)}),t}}function getStorages(e,t){let n=t.scene.scenes[1];if(!n.stateManager||!n.stateManager.selfPlayer||!n.stateManager.selfPlayer.entities)return[];let s=n.stateManager.selfPlayer.entities.$items,a=n.entities,r=e.map(e=>{let t=s.get(e),n=a.get(e);if(t&&t.storage){let r={mid:e,size:t.storage.size,items:[],position:n?{x:n.position.x,y:n.position.y}:null};return t.storage.slots.$items.forEach((e,t)=>{e&&e.item&&r.items.push({position:e.slot,itemName:e.item,quantity:e.quantity})}),r}if(n&&n.element&&n.element.includes("woodchest")){let i;switch(n.element){case"ent_woodchest_01":i=6;break;case"ent_woodchest_02":i=12;break;case"ent_woodchest_03":i=18;break;case"ent_woodchest_04":i=24;break;default:i=0}if(i>0)return{mid:e,size:i,items:[],position:{x:n.position.x,y:n.position.y}}}return console.log(`No storage found for mid: ${e}`),null});return r.filter(e=>null!==e)}function getPetInventoryData(e){let t=e.scene.scenes[1]?.stateManager?.selfPlayer?.pet;if(t&&t.inventory){let n=t.inventory.slots,s=[];return n.$items.forEach(e=>{e&&e.item&&s.push({position:e.slot,itemName:e.item,quantity:e.quantity||0})}),{size:t.inventory.size,items:s}}return null}window.postMessage({type:"VOXELS_INITIATED"}),window.addEventListener("message",e=>{e.source===window&&e.data.type&&"VOXELS_SET_INSTANCE_ACTIVE"===e.data.type&&(instanceActive=e.data.value)}),getGameInstance(runGameInstance);let previousCustomObjectsArray=[];function arraysAreEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}function getPropsFromTaskItems(e){let t=document.querySelector(e);if(t){let n=Object.keys(t).find(e=>e.startsWith("__reactFiber$"));if(n){let s=t[n],a=s?.memoizedProps;if(a&&a.children&&Array.isArray(a.children[0])){let r=a.children[0].map(e=>e.props),i=r.map((e,t)=>{if(e.request&&e.request.item){let n=e.request.item||{},s=e.reward.currency||{},a=e.reward.skill||{},r;switch(e.playerClassId){case"f2p":r="Basic";break;case"vip":r="VIP";break;case"landowner":r="Landowner";break;default:r="Unknown"}return{position:t,type:r,name:n.name||"N/A",tier:n.tier||"N/A",quantity:e.request.quantity||"N/A",canFill:e.canFill||!1,rewardCurrency:s.currencyId||"coins",rewardAmount:s.amount||"N/A",skillType:a.skillType||"N/A",skillXp:a.xp||"N/A"}}{let i=e.cooldownEndTimestamp;return{position:t,type:"Unknown",itemName:"Loading...",reloadTimestamp:Math.floor(i/1e3)}}});arraysAreEqual(i,previousCustomObjectsArray)||(previousCustomObjectsArray=i,window.postMessage({type:"VOXELS_TASK_DATA",value:i},"*"))}}}}window.addEventListener("message",function(e){if("VOXELS_NODE_INPAGE"===e.data.type){let t=e.data.value;t.taskContent&&setInterval(()=>getPropsFromTaskItems(t.taskContent),200)}});