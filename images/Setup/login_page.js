let instanceActive=!0;function getGameInstance(e){let t=window.Phaser;if(void 0!==t){let n=window.Phaser,a=n.Game,s=new Proxy(a,{construct:function t(n,a){let s=new n(...a);return e(s),s}});n.Game=s}else setTimeout(()=>getGameInstance(e),10)}function runGameInstance(e){let t=null;!function n(){if(e.scene.scenes[1]){if(instanceActive){let a=e.scene.scenes[1].selfPlayer.playerData.label;window.postMessage({type:"VOXELS_PLAYER_LABEL",label:a})}let s=getPlayerData(e);s.inventoryData&&window.postMessage({type:"VOXELS_INV_DATA",data:s.inventoryData});try{let r=getEntities(e),i=r.storages,l=getStorages(i,e),o=e.scene.scenes[1].hoverNode,c=null;o&&o.propCache&&(o.propCache.id?c={id:o.propCache.id,owner:o.propCache.owner}:o.playerData&&"pet"===o.playerData.kind&&(c={id:o.playerData.kind,owner:o.propCache.owner}));let u=getPetInventoryData(e),m=JSON.stringify(l)!==JSON.stringify(t),y={};m&&(y.storages=l,t=l),y.hoverNode=c,y.inventory=s.inventoryData||null,y.location=s.location||null,y.coinBalance=s.coinBalance||null,y.petInventory=u||null,Object.keys(y).length>0&&window.postMessage({type:"VOXELS_GAME_DATA",data:y})}catch(p){console.error("An error occurred:",p)}}setTimeout(n,200)}()}function getPlayerData(e){let t=[];if(e.scene.scenes[1]){let n=e.scene.scenes[1],a=n.playerId,s=n.stateManager.selfPlayer?n.stateManager.selfPlayer.farms:null,r=null,i=null;s&&s.$items&&(r=s.$items.get(0),i=s.$items.get(1));let l=n.stateManager.mapId,o=l.match(/\d+/),c=o?o[0]:"unknown",u;u=l&&""!==l.trim()?r&&l.includes(r)?`speck-farm-${c}`:i&&l.includes(i)?`speck-house-${c}`:l.includes("House")?`${c}-house`:l.includes("Farm")?`${c}-farm`:l:"unknown";let m=n.stateManager.selfPlayer?n.stateManager.selfPlayer.inventory:null,y=null;if(m){let p=m.size,d=m.activeRow,f=m.slots.$items,g=[];f.forEach((e,t)=>{g.push({slot:t,item:e.item,quantity:e.quantity})}),y={size:p,activeRow:d,items:g}}let h=0;if(n?.stateManager?.selfPlayer?.coinInventory){let A=n.stateManager.selfPlayer.coinInventory;if(A.$items){for(let[v,w]of A.$items.entries())if("cur_coins"===w.currencyId){h=w.balance;break}}}t={playerId:a,location:u,inventoryData:y,coinBalance:h}}return t}function getEntities(e){let t=[];if(!e.scene.scenes[1])return[];{let n=e.scene.scenes[1],a=n.playerId,s=n.entities,r=new Map;s.forEach((e,n)=>{e&&e.owner===a&&e.element&&(e.element.includes("storage_box")||e.element.includes("woodchest")||e.element.includes("storageChest")||e.element.includes("moca_storage")||e.element.includes("xmasStorage"))&&e.owner===a&&t.push(e.mid)});let i=Array.from(r,([e,t])=>({element:e,count:t}));return{storages:t,entities_map:i}}}function getStorages(e,t){let n=t.scene.scenes[1];if(!n.stateManager||!n.stateManager.selfPlayer||!n.stateManager.selfPlayer.entities)return[];let a=n.stateManager.selfPlayer.entities.$items,s=n.entities,r=e.map(e=>{let t=a.get(e),n=s.get(e);if(t&&t.storage){let r={mid:e,size:t.storage.size,items:[],position:n?{x:n.position.x,y:n.position.y}:null};return t.storage.slots.$items.forEach((e,t)=>{e&&e.item&&r.items.push({position:e.slot,itemName:e.item,quantity:e.quantity})}),r}if(n&&n.element&&n.element.includes("woodchest")){let i;switch(n.element){case"ent_woodchest_01":i=6;break;case"ent_woodchest_02":i=12;break;case"ent_woodchest_03":i=18;break;case"ent_woodchest_04":i=24;break;default:i=0}if(i>0)return{mid:e,size:i,items:[],position:{x:n.position.x,y:n.position.y}}}return null});return r.filter(e=>null!==e)}function getPetInventoryData(e){let t=e.scene.scenes[1]?.stateManager?.selfPlayer?.pet;if(t&&t.inventory){let n=t.inventory.slots,a=[];return n.$items.forEach(e=>{e&&e.item&&a.push({position:e.slot,itemName:e.item,quantity:e.quantity||0})}),{size:t.inventory.size,items:a}}return null}window.postMessage({type:"VOXELS_INITIATED"}),window.addEventListener("message",e=>{e.source===window&&e.data.type&&"VOXELS_SET_INSTANCE_ACTIVE"===e.data.type&&(instanceActive=e.data.value)}),getGameInstance(runGameInstance);let previousCustomObjectsArray=[];function arraysAreEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}function getPropsFromTaskItems(e){let t=document.querySelector(e);if(t){let n=Object.keys(t).find(e=>e.startsWith("__reactFiber$"));if(n){let a=t[n],s=a?.memoizedProps;if(s&&s.children&&Array.isArray(s.children[0])){let r=s.children[0].map(e=>e.props),i=r.map((e,t)=>{if(e.request&&e.request.item){let n=e.request.item||{},a=e.reward.currency||{},s=e.reward.skill||{},r;switch(e.playerClassId){case"f2p":r="Basic";break;case"vip":r="VIP";break;case"landowner":r="Landowner";break;default:r="Unknown"}return{position:t,type:r,name:n.name||"N/A",tier:n.tier||"N/A",quantity:e.request.quantity||"N/A",canFill:e.canFill||!1,rewardCurrency:a.currencyId||"coins",rewardAmount:a.amount||"N/A",skillType:s.skillType||"N/A",skillXp:s.xp||"N/A"}}{let i=e.cooldownEndTimestamp;return{position:t,type:"Unknown",itemName:"Loading...",reloadTimestamp:Math.floor(i/1e3)}}});arraysAreEqual(i,previousCustomObjectsArray)||(previousCustomObjectsArray=i,window.postMessage({type:"VOXELS_TASK_DATA",value:i},"*"))}}}}window.addEventListener("message",function(e){if("VOXELS_NODE_INPAGE"===e.data.type){let t=e.data.value;t.taskContent&&setInterval(()=>getPropsFromTaskItems(t.taskContent),200)}});