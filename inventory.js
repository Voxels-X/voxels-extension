let inventoryPending=!1;var displayInventoryPrice,currentFetchedInventory=[],inventoryModeTotal=!1,displayHoverInfo=!0,marketPrices=[];let sentInventory=null;function getMarketPrices(){chrome.storage.local.get("pid",(async function(e){const t={pid:e.pid,operation:"getMarketPrices"};try{const e=await makeRequestToTools(t);if(!e||!e.data)return;marketPrices=e.data,loadInventoryPrices()}catch(e){}}))}function loadInventoryPrices(){const e=document.querySelectorAll(nodeNames.hudItems);if(settings.useNewInventory){if(e.length>0&&sentInventory){let o=6*sentInventory.activeRow,r=sentInventory.size,i=0;function t(e){return e>9999?nFormatter(e,1):e}sentInventory.items.forEach((function(n){hudSlot=(parseInt(n.slot,10)-o+r)%r,quantity=n.quantity,itmCode=n.item;let c=marketPrices[itmCode];if(c&&c>0){const o=c*quantity;if(i+=o,inventoryModeTotal&&(c=o),hudElement=e[hudSlot],hudElement){const e=hudElement.querySelector(".Hud_shortcut__UvE3h");if(e){if(parseInt(e.innerText,10)-1!==parseInt(n.slot,10))return}const o=hudElement.querySelector(".voxels-inventory-price");if(o){o.innerText=t(c);const e=document.createElement("img");e.src=inventoryModeTotal?chrome.runtime.getURL("images/Prices/coin_total.png"):chrome.runtime.getURL("images/Prices/coin.png"),o.appendChild(e)}else{var s=document.createElement("div");s.classList.add("voxels-inventory-price"),s.innerText=t(c);const e=document.createElement("img");e.src=inventoryModeTotal?chrome.runtime.getURL("images/Prices/coin_total.png"):chrome.runtime.getURL("images/Prices/coin.png"),s.appendChild(e),hudElement.appendChild(s)}}}else if(hudElement=e[hudSlot],hudElement){const e=hudElement.querySelector(".voxels-inventory-price");e&&e.remove()}}));const c=document.querySelector(nodeNames.hudSliding);var n=document.querySelector(".voxels-inventory-total");n||(n=document.createElement("div")),n.classList.add("voxels-inventory-total"),n.innerText=nFormatter(i,3),inventoryValue=i;const s=document.createElement("img");if(s.src=chrome.runtime.getURL("images/Prices/coin.png"),n.appendChild(s),c.appendChild(n),!displayInventoryPrice){document.querySelectorAll(".voxels-inventory-price").forEach((function(e){e.style.display="none"}));const e=document.querySelector(".voxels-inventory-total");e&&(e.style.display="none")}}}else if(e.length>0&&!inventoryPending){const t=[],n=[];e.forEach((e=>{const o=e.querySelector(nodeNames.hudItemImage);if(o)if(o.complete){const r=calculateAverageColor(o);t.push(r),n.push(e)}else o.onload=function(){const r=calculateAverageColor(o);t.push(r),n.push(e)}})),t.length>0&&(inventoryPending=!0,sendRequestByHash(t).then((e=>{setPricesInInventory(e,n),inventoryPending=!1})).catch((e=>{inventoryPending=!1})))}}function toggleInventoryStack(){return inventoryModeTotal=!inventoryModeTotal,loadInventoryPrices(),!0}function togglePrices(){displayInventoryPrice=!displayInventoryPrice;document.querySelectorAll(".voxels-inventory-price").forEach((function(e){e.style.display=displayInventoryPrice?"":"none"}));const e=document.querySelector(".voxels-inventory-total");return e&&(e.style.display=displayInventoryPrice?"":"none"),chrome.storage.local.set({displayInventoryPrice:displayInventoryPrice}),!0}function receiveInventory(e){if(e.source===window&&e.data.type&&"VOXELS_INV_DATA"===e.data.type){checkAndUpdateInventory(e.data.data)}}window.addEventListener("message",receiveInventory);let currentInventory=[];function deepEqual(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(const r of n)if(!o.includes(r)||!deepEqual(e[r],t[r]))return!1;return!0}function checkAndUpdateInventory(e){deepEqual(e,currentInventory)||(currentInventory=e,addTaskQuantities())}function setPricesInInventory(e,t){let n=0;function o(e){return e>9999?nFormatter(e,1):e}e.forEach(((e,r)=>{const i=t[r];if(null!==e.price.price){const t=i.querySelector(".voxels-inventory-price");let r=e.price.price;const s=i.querySelector(nodeNames.hudQuantities).textContent,l=r*(s&&s.length>1?parseInt(s.substring(1),10):1);if(n+=l,inventoryModeTotal&&(r=l),t){t.innerText=o(r);const e=document.createElement("img");e.src=inventoryModeTotal?chrome.runtime.getURL("images/Prices/coin_total.png"):chrome.runtime.getURL("images/Prices/coin.png"),t.appendChild(e),t.classList.add("voxels-blinking"),setTimeout((()=>{t.classList.remove("voxels-blinking")}),500)}else{var c=document.createElement("div");c.classList.add("voxels-inventory-price"),c.innerText=o(r);const e=document.createElement("img");e.src=inventoryModeTotal?chrome.runtime.getURL("images/Prices/coin_total.png"):chrome.runtime.getURL("images/Prices/coin.png"),c.appendChild(e),i.appendChild(c),c.classList.add("voxels-blinking"),setTimeout((()=>{c.classList.remove("voxels-blinking")}),500)}}}));const r=document.querySelector(nodeNames.hudSliding);var i=document.querySelector(".voxels-inventory-total");i||(i=document.createElement("div")),i.classList.add("voxels-inventory-total"),i.innerText=nFormatter(n,3),inventoryValue=n;const c=document.createElement("img");if(c.src=chrome.runtime.getURL("images/Prices/coin.png"),i.appendChild(c),r.appendChild(i),!displayInventoryPrice){document.querySelectorAll(".voxels-inventory-price").forEach((function(e){e.style.display="none"}));const e=document.querySelector(".voxels-inventory-total");e&&(e.style.display="none")}}async function sendRequestByHash(e){return new Promise((async(t,n)=>{chrome.storage.local.get("user_info",(async function(o){const r={name:o.user_info,operation:"fetchPricesByHash",extra:e};try{const n=(await makeFetchRequest(apiURL,r)).data,o=e.map(((e,t)=>({averageColor:e,price:n[t]})));t(o)}catch(e){n(e)}}))}))}function calculateAverageColor(e){const t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height);const o=n.getImageData(0,0,e.width,e.height).data;let r=0,i=0,c=0;for(let e=0;e<o.length;e+=4)r+=o[e],i+=o[e+1],c+=o[e+2];const s=o.length/4;return generateColorHash(r/s,i/s,c/s)}function calculateAverageBlueScore(e,t){const n=new Image;n.crossOrigin="Anonymous",n.src=e,n.onload=function(){const e=document.createElement("canvas"),o=e.getContext("2d");e.width=n.width,e.height=n.height,o.drawImage(n,0,0,n.width,n.height);const r=o.getImageData(0,0,n.width,n.height).data;let i=0;for(let e=0;e<r.length;e+=4)i+=r[e+2];const c=r.length/4;t(i/c)},n.onerror=function(){t(!1)}}function generateColorHash(e,t,n){const o=`${Math.round(e)},${Math.round(t)},${Math.round(n)}`;let r=0;for(let e=0;e<o.length;e++){r=(r<<5)-r+o.charCodeAt(e)}return(r>>>0).toString(16)}function observeTooltips(){new MutationObserver((e=>{for(const t of e)"childList"===t.type&&(t.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&"tooltip"===e.getAttribute("role")&&displayHoverInfo&&handleTooltip(e)})),premium&&t.removedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&"tooltip"===e.getAttribute("role")&&(document.querySelector('[role="tooltip"]')||(currentItemHovered=null))})))})).observe(document.body,{childList:!0,subtree:!0})}function handleTooltip(e){const t=e.querySelector(".ItemStyles_tooltipTitle____kIs");if(t){const n=t.textContent.trim(),o=getItmByName(n);if(null!==o){const t=e.querySelector(".MuiTooltip-tooltip");if(t){premium&&(currentItemHovered=o,itemHoverLoop());const e=findRecipe(o);if(null!==e){const n=t.querySelector(".voxels-tooltip-recipe-container");n&&n.remove();const o=createRecipeContainer(e);t.appendChild(o)}const n=historic_item_prices(o);if(n){const e=document.createElement("div");e.classList.add("voxels-networth-hover-graph-container");const r=document.createElement("div");r.classList.add("voxels-networth-hover-graph-header"),r.textContent="7-day Graph",e.appendChild(r);let i=[...n];if(marketPrices[o]){const e=marketPrices[o],t=Math.floor(Date.now()/1e3);i.push({t:t,p:e})}const c=renderPriceChart(i);e.appendChild(c),t.appendChild(e)}}}}}observeTooltips();