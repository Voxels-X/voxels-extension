function loadGuildWar(){premium?loadGWSetup():displayPremium()}let isPollingStarted=!1;function loadGWSetup(){const e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-gw");var a=document.createElement("div");a.classList.add("voxels-gw-header");var s=document.createElement("div");s.classList.add("voxels-gw-navigator");var n=document.createElement("div");n.classList.add("voxels-gw-nav-item","clickable"),n.textContent="Division";var d=document.createElement("div");d.classList.add("voxels-gw-nav-item","clickable"),d.textContent="Guild";var i=document.createElement("div");i.classList.add("voxels-nav-divider");var l=document.createElement("div");l.classList.add("voxels-gw-nav-item","clickable"),l.textContent="Stats";var o=i.cloneNode(!0);s.appendChild(n),s.appendChild(i),s.appendChild(d),s.appendChild(o),s.appendChild(l),a.appendChild(s),t.appendChild(a);var c=document.createElement("div");c.classList.add("voxels-gw-page"),t.appendChild(c),e.appendChild(t);const r=localStorage.getItem("voxels-gw-active-tab")||"division";function v(e){n.classList.remove("voxels-gw-active"),d.classList.remove("voxels-gw-active"),l.classList.remove("voxels-gw-active"),"division"===e?n.classList.add("voxels-gw-active"):"guild"===e?d.classList.add("voxels-gw-active"):"stats"===e&&l.classList.add("voxels-gw-active"),localStorage.setItem("voxels-gw-active-tab",e)}"division"===r?n.classList.add("voxels-gw-active"):"guild"===r?d.classList.add("voxels-gw-active"):"stats"===r&&l.classList.add("voxels-gw-active"),n.addEventListener("click",(function(){loadGWPage("division"),v("division")})),d.addEventListener("click",(function(){loadGWPage("guild"),v("guild")})),l.addEventListener("click",(function(){loadGWPage("stats"),v("stats")})),isPollingStarted||(startGWStatsPolling(),isPollingStarted=!0),refreshGW(!0)}function refreshGW(e){chrome.storage.local.get("pid",(async function(t){const a={pid:t.pid,operation:"request_lb"};e&&loadingScreen(1);try{const t=await makeRequestToTools(a);e&&loadingScreen(0);const s=document.querySelector(".voxels-gw-nav-item.voxels-gw-active");chrome.storage.local.set({gw_stats:t.data},(function(){loadGWPage(s.textContent.toLowerCase())}))}catch(e){}}))}function startGWStatsPolling(){setInterval((()=>{document.querySelector(".voxels-gw-page")&&refreshGW(!1)}),6e4)}function loadGWPage(e){chrome.storage.local.get(["gw_stats"],(function(t){clearGWPage();const a=document.querySelector(".voxels-gw-page"),s=[45,39,34,30,27,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1];switch(e){case"division":if(t.gw_stats&&t.gw_stats.division_leaderboard&&0!==t.gw_stats.division_leaderboard.length){const e=document.createElement("div");e.classList.add("voxels-gw-leaderboard-container"),t.gw_stats.division_leaderboard.forEach(((t,a)=>{const n=document.createElement("div");n.classList.add("voxels-gw-leaderboard-entry");const d=document.createElement("div");d.classList.add("voxels-gw-rank"),d.textContent=a+1+".",n.appendChild(d);const i=document.createElement("div");i.classList.add("voxels-gw-username","clickable"),i.textContent=t.username,n.appendChild(i),i.addEventListener("click",(function(){loadPlayerPageTop(),loadPlayerPage(t.pid)}));const l=document.createElement("div");l.classList.add("voxels-gw-score");const o=t.score.toLocaleString();l.textContent=o,n.appendChild(l);const c=s[a]||1,r=document.createElement("div");r.classList.add("voxels-gw-seasonal-points"),r.textContent=`+${c}`,n.appendChild(r),e.appendChild(n)})),a.appendChild(e)}else{const e=document.createElement("div");e.classList.add("voxels-gw-info"),e.innerHTML="Division leaderboard is loading...<br>Check your current leaderboard at: ";const t=document.createElement("a");t.href="https://dashboard.pixels.xyz/leaderboards/ldb_guildwars_season1_individual_overall_weekly",t.textContent="dashboard.pixels.xyz",t.target="_blank",e.appendChild(t),e.innerHTML+="<br>You can find links to your seasonal and weekly division in the stats tab.",a.appendChild(e)}break;case"guild":if(t.gw_stats&&t.gw_stats.guild_leaderboard&&0!==t.gw_stats.guild_leaderboard.length){const e=document.createElement("div");e.classList.add("voxels-gw-leaderboard-container"),t.gw_stats.guild_leaderboard.forEach(((t,a)=>{const n=document.createElement("div");n.classList.add("voxels-gw-leaderboard-entry");const d=document.createElement("div");d.classList.add("voxels-gw-rank"),d.textContent=a+1+".",n.appendChild(d);const i=document.createElement("div");i.classList.add("voxels-gw-username"),i.textContent=t.guild,n.appendChild(i);const l=document.createElement("div");l.classList.add("voxels-gw-score");const o=t.score.toLocaleString();l.textContent=o,n.appendChild(l);const c=s[a]||1,r=document.createElement("div");r.classList.add("voxels-gw-seasonal-points"),r.textContent=`+${c}`,n.appendChild(r),e.appendChild(n)})),a.appendChild(e)}else{const e=document.createElement("div");e.classList.add("voxels-gw-info"),e.textContent="Guild is loading... Please come back later.",a.appendChild(e)}break;case"stats":const e=document.createElement("div");e.classList.add("voxels-gw-stats-container");const d=document.createElement("div");d.classList.add("voxels-gw-stats-details");const i=document.createElement("div");i.classList.add("voxels-gw-stats-title"),i.textContent="Weekly Stats",d.appendChild(i);const l=(()=>{const e=new Date,t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));t.setUTCDate(t.getUTCDate()+4-(t.getUTCDay()||7));const a=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.ceil(((t-a)/864e5+1)/7)+3})();function n(e,t){const a=document.createElement("div");a.classList.add("voxels-gw-stats-details-balances"),a.innerHTML=`<img src="${chrome.runtime.getURL(`images/GW/${e}.png`)}"><div>${t}</div>`,d.appendChild(a)}d.innerHTML+=`<div>Week: <span>${l}</span></div>`,n("guild_runes",guildRunes);const o=document.createElement("div");o.classList.add("voxels-gw-stats-details-timer","voxels-gw-stats-details-80"),d.appendChild(o);const c=e=>{const t=new Date,a=t.getUTCDay(),s=60*t.getUTCHours()+t.getUTCMinutes(),n=t.getSeconds();let d=1/0,i=!1;if(e.forEach((({day:e,startTimesUTC:t,durationMinutes:l})=>{const o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"].indexOf(e);t.forEach((e=>{const t=60*e;let c=o-a<0?7+o:o;if(c===a&&s>=t&&s<t+l&&(i=!0),c>0||s<t){const e=60*(1440*c+t)-(60*(1440*a+s)+n);e<d&&e>0&&(d=e)}}))})),i)return"Sessions: <span>Live</span>";const l=Math.floor(d/86400),o=Math.floor(d%86400/3600),c=Math.floor(d%3600/60),r=d%60;let v="Next session: <span>";return l>0&&(v+=`${l}d `),o>0&&(v+=`${o}h `),c>0&&(v+=`${c}m `),r>0&&(v+=`${r}s`),v.trim()+"</span>"};((e,t)=>{const a=()=>{const a=c(e);t.innerHTML=`<div>${a}</div>`};a(),setInterval(a,1e3)})(weeklySessions,o),n("itm_mushroomSeeds_04",T4Items.itm_mushroomSeeds_04.total);const r=document.createElement("div");r.classList.add("voxels-gw-stats-details-80");const v=t.gw_stats?.individual_participants??0;r.innerHTML=`Players: <span>${v}</span>`,d.appendChild(r),n("itm_cave_fertilizer_04",T4Items.itm_cave_fertilizer_04.total);const m=document.createElement("div");m.classList.add("voxels-gw-stats-details-80");const p=t.gw_stats?.division_count??0;m.innerHTML=`Divisions: <span>${p}</span>`,d.appendChild(m),n("itm_soilDryer_04",T4Items.itm_soilDryer_04.total);const g=document.createElement("div");g.innerHTML="Leaderboards: ";const u=document.createElement("a");u.href="https://dashboard.pixels.xyz/leaderboards/ldb_guildwars_season1_individual_overall_weekly",u.textContent="Weekly",u.target="_blank";const x=document.createElement("a");x.href="https://dashboard.pixels.xyz/leaderboards/ldb_guildwars_season1_individual_overall",x.textContent="Seasonal",x.target="_blank",g.appendChild(u),g.innerHTML+=" <span>|</span> ",g.appendChild(x),d.appendChild(g),e.appendChild(d);const h=document.createElement("div");h.classList.add("voxels-gw-stats-details");const w=document.createElement("div");w.classList.add("voxels-gw-stats-title"),w.textContent="Mixers",h.appendChild(w);const C=e=>{const t=e-Date.now();if(t<=0)return"<span>Ready</span>";const a=Math.floor(t/864e5),s=Math.floor(t%864e5/36e5),n=Math.floor(t%36e5/6e4),d=Math.floor(t%6e4/1e3);let i="";return a>0&&(i+=`${a}d `),s>0&&(i+=`${s}h `),n>0&&(i+=`${n}m `),d>0&&(i+=`${d}s`),"Time remaining <span>"+i.trim()+"</span>"},L=document.createElement("div");if(L.classList.add("voxels-gw-stats-mixer-container"),Object.entries(globalMixerData).forEach((([e,t])=>{const a=document.createElement("div");a.classList.add("voxels-gw-stats-mixer");const s=document.createElement("img");s.src=chrome.runtime.getURL(`images/GW/${e}.png`),a.appendChild(s);const n=document.createElement("div"),d=document.createElement("div");d.classList.add("voxels-gw-stats-mixer-timer");const i=()=>{d.innerHTML=C(t.finishTimer)};i(),setInterval(i,1e3),n.appendChild(d);const l=document.createElement("div");l.classList.add("voxels-gw-stats-mixer-points"),l.innerHTML=`Points: <span>${parseFloat(t.points.toFixed(2))}</span>`,n.appendChild(l),t.pointsDiv=l,a.appendChild(n),L.appendChild(a)})),h.appendChild(L),e.appendChild(h),t.gw_stats&&t.gw_stats.top_10_individual_leaderboard&&0!==t.gw_stats.top_10_individual_leaderboard.length){const a=document.createElement("div");a.classList.add("voxels-gw-stats-details");const s=document.createElement("div");s.classList.add("voxels-gw-stats-title"),s.textContent="Weekly Top 10",a.appendChild(s);const n=document.createElement("div");n.classList.add("voxels-gw-leaderboard-container"),t.gw_stats.top_10_individual_leaderboard.forEach(((e,t)=>{const a=document.createElement("div");a.classList.add("voxels-gw-leaderboard-entry");const s=document.createElement("div");s.classList.add("voxels-gw-rank"),s.textContent=t+1+".",a.appendChild(s);const d=document.createElement("div");d.classList.add("voxels-gw-username","clickable"),d.textContent=e.username,a.appendChild(d),d.addEventListener("click",(function(){loadPlayerPageTop(),loadPlayerPage(e.pid)}));const i=document.createElement("div");i.classList.add("voxels-gw-score");const l=e.score.toLocaleString();i.textContent=l,a.appendChild(i),n.appendChild(a)})),a.appendChild(n),e.appendChild(a)}a.appendChild(e);break;default:break}}))}function clearGWPage(){document.querySelector(".voxels-gw-page").innerHTML=""}