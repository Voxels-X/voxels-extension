let historic_prices=null;const historic_item_prices=e=>historic_prices?.[e]??null;function getHistoricData(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{let i=await makeRequestToTools({pid:t,operation:"getHistoricData"});if(!i||!i.data)return;historic_prices=i.data}catch(a){console.log("Error retrieving lands")}})}function loadNetworth(e){premium?chrome.storage.local.get("pid",async function(e){let t=e.pid;loadingScreen(1);try{let i=await makeRequestToTools({pid:t,operation:"getEntities"});if(loadingScreen(0),!i||!i.data){quickMessage("Please try again later","error");return}updateAutoUpdateLocations(i.data),loadNetworthPage(i.data)}catch(a){console.error("Error retrieving entities:",a)}}):displayPremium()}function updateAutoUpdateLocations(e){if(!e||"object"!=typeof e)return;let t=e.entities?Object.keys(e.entities):[],i=e.storages?Object.keys(e.storages):[],a=[...new Set([...t,...i])];autoUpdateLocations=a.filter(e=>"total_value"!==e).map(e=>e.toString())}function getToolsLands(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{let i=await makeRequestToTools({pid:t,operation:"getLands"});if(!i||!i.data){console.log("Error: No land data returned.");return}autoUpdateLocations=i.data.lands.map(String)||[]}catch(a){console.log("Error retrieving lands")}})}let storedItemCache=null;function initialStorageFetch(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{let i=await makeRequestToTools({pid:t,operation:"getStorages"});if(!i||!i.data){console.log("Error: No storage data returned.");return}i.data.lands&&(handleT4Data(i.data.lands,"storages"),storedItemCache=i.data.lands)}catch(a){console.log("Error retrieving lands")}})}function loadNetworthPage(e){if("object"==typeof e&&e.hasOwnProperty("error")){switch(e.error){case"12001":networthContainer.textContent="Error: Premium credentials are invalid or expired. Please renew your subscription.";break;case"12002":displayPageInfo("Secure Voxels","To access the networth page, please secure your account in the settings. Click here for settings.",chrome.runtime.getURL("images/Other/secure_account.png"),function(){switchFullPage("settings")});break;default:console.error("Unknown error:",e.error),networthContainer.textContent="Error: An unknown issue occurred. Please try again later."}return networthContainer}reloadOverlay();let t=document.querySelector(".voxels-main");t.appendChild(addNetworthContent(e)).classList.add("active")}function addNetworthContent(e){var t=document.createElement("div");t.classList.add("voxels-networth-page");var i=document.createElement("div");i.classList.add("voxels-networth-header");var a=document.createElement("div");a.classList.add("voxels-networth-header-stats","hidden");var s=document.createElement("div");s.classList.add("voxels-networth-header-stats-sub-statistics");var n=e.storages.total_value,l=e.entities.total_value,r=e.market_listings.total_value,o=document.createElement("div");o.classList.add("voxels-networth-header-stats-sub-statistics-coinbalance"),s.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),d.innerText="Coin Balance",o.appendChild(d);var c=document.createElement("div");c.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),c.innerText=`${nFormatter(currentCoinBalance,1)}`,o.appendChild(c);var p=document.createElement("div");p.classList.add("voxels-networth-header-stats-sub-statistics-inventoryvalue"),s.appendChild(p);var h=document.createElement("div");h.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),h.innerText="Inventory Value",p.appendChild(h);var v=document.createElement("div");if(v.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),v.innerText=`${nFormatter(inventoryValue,1)}`,p.appendChild(v),petInventoryValue>0){var m=document.createElement("div");m.classList.add("voxels-networth-header-stats-sub-statistics-petinventoryvalue"),s.appendChild(m);var u=document.createElement("div");u.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),u.innerText="Pet Inventory Value",m.appendChild(u);var g=document.createElement("div");g.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),g.innerText=`${nFormatter(petInventoryValue,1)}`,m.appendChild(g),g.prepend(T())}var x=document.createElement("div");x.classList.add("voxels-networth-header-stats-sub-statistics-storagestotal"),s.appendChild(x);var f=document.createElement("div");f.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),f.innerText="Storages",x.appendChild(f);var L=document.createElement("div");L.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),L.innerText=`${nFormatter(n,1)}`,x.appendChild(L);var w=document.createElement("div");w.classList.add("voxels-networth-header-stats-sub-statistics-entitiestotal"),s.appendChild(w);var E=document.createElement("div");E.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),E.innerText="Entities",w.appendChild(E);var C=document.createElement("div");C.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),C.innerText=`${nFormatter(l,1)}`,w.appendChild(C);var y=document.createElement("div");y.classList.add("voxels-networth-header-stats-sub-statistics-marketlistingsvalue"),s.appendChild(y);var b=document.createElement("div");b.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),b.innerText="Market Listings",y.appendChild(b);var $=document.createElement("div");$.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),$.innerText=`${nFormatter(r,1)}`,y.appendChild($);var _=document.createElement("div");_.classList.add("voxels-networth-header-stats-main-statistic");var k=document.createElement("h2");k.classList.add("voxels-networth-header-stats-main-statistic-name"),k.textContent="Networth",_.appendChild(k);var S=document.createElement("span");function T(){let e=document.createElement("img");return e.src=chrome.runtime.getURL("/images/Prices/coin.png"),e.alt="Coin Icon",e.classList.add("coin-image"),e}S.classList.add("voxels-networth-header-stats-main-statistic-number"),c.prepend(T()),v.prepend(T()),L.prepend(T()),C.prepend(T()),$.prepend(T());let N="0";if(e.total_value){let A=e.total_value;inventoryValue>0&&(A+=inventoryValue),petInventoryValue>0&&(A+=petInventoryValue),currentCoinBalance>0&&(A+=currentCoinBalance),N=nFormatter(A,3)}S.textContent=N,S.append(T()),_.prepend(S);var P=document.createElement("div");P.classList.add("voxels-networth-header-stats-expand-btn"),P.addEventListener("click",function(){a.classList.toggle("hidden")}),_.appendChild(P),a.appendChild(_),a.appendChild(s),i.appendChild(a);var q=e.market_listings;let H=Object.keys(q).slice(0,-1),R=H.map(e=>{let t=q[e],i=getNameForItem(e),a=getImageForItem(e),{quantity:s,price:n,total_price:l}=t;return{itemName:i,itemImage:a,quantity:s,price:n,total_price:l}}),U=R.sort((e,t)=>t.total_price-e.total_price).slice(0,5);y.addEventListener("mouseenter",()=>{(hoverContainer=document.createElement("div")).classList.add("voxels-networth-marketlistings-modal"),document.body.appendChild(hoverContainer);let e=`
                <div class="voxels-networth-marketlistings-modal-title">
                    Top Market Listings
                </div>
            `,t="";t=U.length>0?U.map(({itemName:e,itemImage:t,quantity:i,total_price:a})=>`
                    <div class="voxels-networth-marketlistings-modal-item">
                        <div class="voxels-networth-marketlistings-modal-item-icon">
                            <img class="voxels-networth-entity-image" src="${t}" />
                            <div class="voxels-networth-entity-count">x${nFormatter(i,0)}</div>
                        </div>
                        <div class="voxels-networth-marketlistings-modal-item-name">${e}</div>
                        <div class="voxels-networth-marketlistings-modal-item-price">
                            <img src="${chrome.runtime.getURL("/images/Prices/coin.png")}" alt="Coin Icon" class="coin-image">
                            ${nFormatter(a,1)}
                        </div>
                    </div>
                    `).join(""):`
                <div class="voxels-networth-marketlistings-modal-empty-content">
                    No listings (updates every 5 mins)
                </div>
                `,hoverContainer.innerHTML=e+t;let i=y.getBoundingClientRect(),a=i.left+i.width/2;hoverContainer.style.position="absolute";let s=hoverContainer.offsetWidth,n=hoverContainer.offsetHeight,l=a-s/2,r=i.top-n-5,o=window.innerWidth;window.innerHeight,l<0&&(l=5),l+s>o&&(l=o-s-5),r<0&&(r=i.bottom+5),hoverContainer.style.left=`${l}px`,hoverContainer.style.top=`${r}px`;let d=()=>{hoverContainer&&hoverContainer.remove(),y.removeEventListener("mouseleave",d)};y.addEventListener("mouseleave",d)});var M=document.createElement("div");M.classList.add("voxels-networth-header-tools");var F=document.createElement("div");F.classList.add("voxels-networth-add-btn"),M.appendChild(F);let I=limiter(addNewLandAndStorageToNetworth,1e4);return F.addEventListener("click",function(){I()}),i.appendChild(M),t.appendChild(i),loadFilterNetworth(t),e.entities&&delete e.entities.total_value,e.storages&&delete e.storages.total_value,loadLands(t,e),loadLandSearch(t),t}function loadLandSearch(e){var t=document.createElement("div");t.classList.add("voxels-networth-landsearch");var i=document.createElement("div");i.classList.add("voxels-networth-landsearch-text"),i.textContent="Search for industries...",t.appendChild(i);let a=limiter(function(){requestLandSearch()},1e4);i.addEventListener("click",function(){a()}),e.appendChild(t)}function loadFilterNetworth(e){var t=document.createElement("div");t.classList.add("voxels-networth-filter-container");var i=document.createElement("input");i.setAttribute("type","text"),i.setAttribute("placeholder","Search..."),i.classList.add("voxels-filter-input"),t.appendChild(i),e.appendChild(t),i.addEventListener("input",function(t){(function t(){let a=i.value.toLowerCase(),s=e.querySelectorAll(".voxels-networth-collection-item");s.forEach(e=>{let t=e.getAttribute("data-collection-item-name").toLowerCase(),i=""===a||t.includes(a);i?e.classList.remove("voxels-networth-item-hidden"):e.classList.add("voxels-networth-item-hidden")})})(),function t(){let i=e.querySelectorAll(".voxels-networth-land");i.forEach(e=>{let t=e.querySelectorAll(".voxels-networth-collection-item"),i=Array.from(t).filter(e=>!e.classList.contains("voxels-networth-item-hidden"));0===i.length?e.style.display="none":e.style.display=""});let a=e.querySelectorAll(".voxels-networth-location");a.forEach(e=>{let t=e.querySelectorAll(".voxels-networth-collection-item"),i=Array.from(t).filter(e=>!e.classList.contains("voxels-networth-item-hidden"));if(0===i.length)e.style.display="none";else{e.style.display="";let a=e.querySelector(".voxels-toggle-button");i.length>5?(i.slice(5).forEach(e=>{e.classList.add("voxels-networth-item-hidden")}),a.style.display="flex"):a.style.display="none"}})}(),function e(){let t=Array.from(document.querySelectorAll(".voxels-toggle-button"));t.forEach(e=>{e.classList.remove("expanded"),e.classList.add("collapsed"),e.innerText="Show More"})}(),t.stopPropagation()}),i.addEventListener("keydown",function(e){i===document.activeElement&&e.stopPropagation()})}function loadLands(e,t){let i={};for(let a in t.entities){let s=t.entities[a];for(let n in i[a]=i[a]||{},i[a].total_price=s.total_price,s){let l=s[n].entities||[];if(i[a][n]=i[a][n]||{},i[a][n].entities=l,i[a][n].entities_total_price=s[n].total_price,t.storages[a]&&t.storages[a][n]){let r=t.storages[a][n].items||[];i[a][n].storages=r;let o=t.storages[a][n].total_price||0;i[a][n].storages_total_price=o,i[a].total_price+=o}}}for(let d in t.storages)for(let c in i[d]=i[d]||{},t.storages[d])if(i[d][c]=i[d][c]||{},!i[d][c].storages){let p=t.storages[d][c].items||[];i[d][c].storages=p,i[d].total_price=(i[d].total_price||0)+(t.storages[d][c].total_price||0),i[d][c].storages_total_price=t.storages[d][c].total_price||0}appendLands(e,i)}function appendLands(e,t){for(let[i,a]of Object.entries(t)){var s=document.createElement("div");s.classList.add("voxels-networth-land"),s.setAttribute("data-land-number",i);var n=document.createElement("div");let l;l="mocaclub"===i?"Moca Club":"PostOfficeInterior"===i?"Post Office":"DrunkenGooseInterior"===i?"Drunken Goose":i.charAt(0).toUpperCase()+i.slice(1);let r=nFormatter(a.total_price,1);n.textContent=`${l}`,n.classList.add("voxels-networth-land-number");var o=document.createElement("div");o.classList.add("voxels-networth-land-container"),o.innerText=`${r}`,n.appendChild(o);var d=document.createElement("img");d.classList.add("voxels-networth-land-number-icon"),d.src=chrome.runtime.getURL("/images/Prices/coin.png"),o.prepend(d);var c=document.createElement("div");c.classList.add("voxels-networth-land-tools");var p=document.createElement("div");p.classList.add("voxels-networth-refresh-btn");var h=document.createElement("img");h.classList.add("voxels-networth-refresh-btn-icon"),h.src=chrome.runtime.getURL("/images/icons/icon__refresh.svg"),p.appendChild(h);let v=limiter(function(){updateLandEntities(i)},1e4);p.addEventListener("click",function(){v()});var m=document.createElement("div");m.classList.add("voxels-close-button");var u=document.createElement("img");u.classList.add("voxels-close-button-icon"),u.src=chrome.runtime.getURL("/images/icons/icon__delete.svg"),m.appendChild(u),m.addEventListener("click",function(){removeLandFromNetworth(i)}),c.appendChild(p),c.appendChild(m),s.appendChild(n),s.appendChild(c),a.farm&&(addLocationEntities(s,"Farm",a.farm.entities,a.farm.entities_total_price),addLocationStorages(s,"Farm",a.farm.storages,a.farm.storages_total_price)),a.house&&(addLocationEntities(s,"House",a.house.entities,a.house.entities_total_price),addLocationStorages(s,"House",a.house.storages,a.house.storages_total_price)),e.appendChild(s)}}function toggleVisibility(e,t,i){e.forEach((e,a)=>{a>=t&&e.classList.toggle("voxels-networth-item-hidden",!i)})}function handleToggleButtonClick(e){let t=e.currentTarget,i=t.parentElement,a=Array.from(i.querySelectorAll(".voxels-networth-collection-item")),s=document.querySelector(".voxels-filter-input"),n=t.classList.contains("collapsed");if(s.value){let l=a.filter(e=>e.getAttribute("data-collection-item-name").toLowerCase().includes(s.value.toLowerCase()));toggleVisibility(l,5,n)}else{let r=Array.from(i.querySelectorAll(".voxels-networth-collection-item"));toggleVisibility(r,5,n)}t.classList.toggle("collapsed",!n),t.classList.toggle("expanded",n),t.innerText=n?"Show Less":"Show More"}function addLocationEntities(e,t,i,a){if(!i||0===i.length)return;i.sort((e,t)=>{let i=e.total_price||0,a=t.total_price||0;return a-i});var s=document.createElement("div");if(s.classList.add("voxels-networth-location"),"Farm"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/pixels_icon.png"),n.classList.add("voxels-networth-location-title-icon")}else if("House"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/Other/house-1.png"),n.classList.add("voxels-networth-location-title-icon")}var l=document.createElement("div");l.classList.add("voxels-networth-location-title"),l.innerText="Entities",l.prepend(n),s.appendChild(l);let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon");var o=document.createElement("div");o.classList.add("voxels-networth-location-title-price"),o.innerText=`${nFormatter(a,1)}`,o.prepend(r),l.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-content");let c=0,p=document.createElement("div");p.classList.add("voxels-toggle-button","collapsed"),p.id="toggleVisibility",p.innerText="Show More",p.addEventListener("click",handleToggleButtonClick),i.forEach(e=>{var t=document.createElement("div");t.classList.add("voxels-networth-entity","voxels-networth-collection-item"),t.setAttribute("data-collection-item-name",getNameForItem(e.item)),c>=5&&t.classList.add("voxels-networth-item-hidden"),c++;let i=getImageForItem(e.item);var a=document.createElement("img");i?a.src=i:a.src="https://pixels-api.com/images/item_not_found.png",a.classList.add("voxels-networth-entity-image");var s=e.count,n=document.createElement("div");if(n.textContent="x"+nFormatter(s,1),n.classList.add("voxels-networth-entity-count"),e.price){var l=document.createElement("div");l.classList.add("voxels-networth-price"),l.innerText=`${nFormatter(e.price,1)}`;let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon"),l.appendChild(r),t.appendChild(l)}t.addEventListener("mouseenter",()=>{let i=document.createElement("div");i.classList.add("voxels-networth-hover");let a=getNameForItem(e.item),n=findRecipe(e.item),l=s*(e.price||0),r=nFormatter(l,1),o=e.price||0,d=nFormatter(o,1),c=document.createElement("div");c.classList.add("voxels-networth-hover-name"),c.textContent=a;let p=document.createElement("div");p.classList.add("voxels-networth-hover-price"),p.innerHTML=`${s} x ${d} = ${r}`;let h=document.createElement("img");if(h.src=chrome.runtime.getURL("images/Prices/coin.png"),h.classList.add("voxels-networth-price-icon"),p.innerHTML=`${s} x `,p.appendChild(h),p.innerHTML+=` ${d} = `,p.appendChild(h.cloneNode()),p.innerHTML+=` ${r}`,i.appendChild(c),i.appendChild(p),displayHoverInfo){if(null!==n){let v=createRecipeContainer(n);i.appendChild(v)}let m=historic_item_prices(e.item);if(m){let u=document.createElement("div");u.classList.add("voxels-networth-hover-graph-container");let g=document.createElement("div");g.classList.add("voxels-networth-hover-graph-header"),g.textContent="7-day Graph",u.appendChild(g);let x=[...m];if(marketPrices[e.item]){let f=marketPrices[e.item],L=Math.floor(Date.now()/1e3);x.push({t:L,p:f})}let w=renderPriceChart(x);u.appendChild(w),i.appendChild(u)}}document.body.appendChild(i);let E=t.getBoundingClientRect(),C=E.left+E.width/2,y=i.offsetWidth,b=i.offsetHeight,$=C-y/2,_=E.top-b-5,k=window.innerWidth;window.innerHeight,$<0&&($=5),$+y>k&&($=k-y),_<0&&(_=5),i.style.position="absolute",i.style.left=`${$}px`,i.style.top=`${_}px`,currentItemHovered=e.item,itemHoverLoop()}),t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),currentItemHovered=null}),t.appendChild(a),t.appendChild(n),d.appendChild(t)});let h=Array.from(d.querySelectorAll(".voxels-networth-entity"));h.length>5?p.style.display="flex":p.style.display="none",d.appendChild(p),s.appendChild(d),e.appendChild(s)}function addLocationStorages(e,t,i,a){if(!i||0===i.length)return;i.sort((e,t)=>{let i=e.total_price||0,a=t.total_price||0;return a-i});var s=document.createElement("div");if(s.classList.add("voxels-networth-location"),"Farm"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/pixels_icon.png"),n.classList.add("voxels-networth-location-title-icon")}else if("House"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/Other/house-1.png"),n.classList.add("voxels-networth-location-title-icon")}var l=document.createElement("div");l.classList.add("voxels-networth-location-title"),l.innerText="Storages",l.prepend(n),s.appendChild(l);let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon");var o=document.createElement("div");o.classList.add("voxels-networth-location-title-price"),o.innerText=`${nFormatter(a,1)}`,o.prepend(r),l.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-content");let c=0,p=document.createElement("div");p.classList.add("voxels-toggle-button","collapsed"),p.id="toggleVisibility",p.innerText="Show More",p.addEventListener("click",handleToggleButtonClick),i.forEach(e=>{var t=document.createElement("div");t.classList.add("voxels-networth-storage","voxels-networth-collection-item"),t.setAttribute("data-collection-item-name",getNameForItem(e.item)),c>=5&&t.classList.add("voxels-networth-item-hidden"),c++;let i=getImageForItem(e.item);var a=document.createElement("img");i?a.src=i:a.src="https://pixels-api.com/images/item_not_found.png",a.classList.add("voxels-networth-storage-image");var s=e.count,n=document.createElement("div");if(n.textContent="x"+nFormatter(s,1),n.classList.add("voxels-networth-storage-count"),e.price){var l=document.createElement("div");l.classList.add("voxels-networth-price"),l.innerText=`${nFormatter(e.price,1)}`;let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon"),l.appendChild(r),t.appendChild(l)}t.appendChild(a),t.appendChild(n),t.addEventListener("mouseenter",()=>{let i=document.createElement("div");i.classList.add("voxels-networth-hover");let a=getNameForItem(e.item),n=findRecipe(e.item),l=s*(e.price||0),r=e.price||0,o=nFormatter(r,1),d=nFormatter(l,1),c=document.createElement("div");c.classList.add("voxels-networth-hover-name"),c.textContent=a;let p=document.createElement("div");p.classList.add("voxels-networth-hover-price"),p.textContent=`Total: ${s} x ${o} = ${d}`;let h=document.createElement("img");if(h.src=chrome.runtime.getURL("images/Prices/coin.png"),h.classList.add("voxels-networth-price-icon"),p.innerHTML=`${s} x `,p.appendChild(h),p.innerHTML+=` ${o} = `,p.appendChild(h.cloneNode()),p.innerHTML+=` ${d}`,i.appendChild(c),i.appendChild(p),displayHoverInfo){if(null!==n){let v=createRecipeContainer(n);i.appendChild(v)}let m=historic_item_prices(e.item);if(m){let u=document.createElement("div");u.classList.add("voxels-networth-hover-graph-container");let g=document.createElement("div");g.classList.add("voxels-networth-hover-graph-header"),g.textContent="7-day Graph",u.appendChild(g);let x=[...m];if(marketPrices[e.item]){let f=marketPrices[e.item],L=Math.floor(Date.now()/1e3);x.push({t:L,p:f})}let w=renderPriceChart(x);u.appendChild(w),i.appendChild(u)}}document.body.appendChild(i);let E=t.getBoundingClientRect(),C=E.left+E.width/2,y=i.offsetWidth,b=i.offsetHeight,$=C-y/2,_=E.top-b-5,k=window.innerWidth;window.innerHeight,$<0&&($=5),$+y>k&&($=k-y-5),_<0&&(_=5),i.style.position="absolute",i.style.left=`${$}px`,i.style.top=`${_}px`,currentItemHovered=e.item,itemHoverLoop()}),t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),currentItemHovered=null}),d.appendChild(t)});let h=Array.from(d.querySelectorAll(".voxels-networth-storage"));h.length>5?p.style.display="flex":p.style.display="none",d.appendChild(p),s.appendChild(d),e.appendChild(s)}async function removeLandFromNetworth(e){chrome.storage.local.get("pid",async function(t){let i=t.pid;try{let a=await makeRequestToTools({pid:i,operation:"removeLocation",extra:[{location:e}]});if("success"===a.data.status){var s=document.querySelector(`[data-land-number="${e}"]`);if(s){s.remove();let n=autoUpdateLocations.indexOf(e);-1!==n&&autoUpdateLocations.splice(n,1)}}else console.log(`Failed to remove land ${e}:`,a.message)}catch(l){console.error(`Error removing land ${e}:`,l)}})}function addNewLandAndStorageToNetworth(){"string"==typeof currentLand&&""!==currentLand.trim()?autoUpdateLocations.includes(currentLand)?quickMessage("This land is already being tracked.","error"):(loadingScreen(1),handleStorages(cachedStorages,currentLocation,!0)):"PostOfficeInterior"==currentLocation||"DrunkenGooseInterior"==currentLocation||"mocaclub"==currentLocation?autoUpdateLocations.includes(currentLocation)?quickMessage("This land is already being tracked.","error"):(loadingScreen(1),handleStorages(cachedStorages,currentLocation,!0)):quickMessage("Make sure you are on a valid land to start tracking.","error")}async function updateLandEntities(e){chrome.storage.local.get("pid",async function(t){let i=t.pid;try{loadingScreen(1);let a=await makeRequestToTools({pid:i,operation:"updateEntities",extra:[{location:e}]});loadingScreen(0),a.data.status?loadNetworth(0):console.log(`Failed to update land ${e}:`,a.message)}catch(s){console.error(`Error updating land ${e}:`,s)}})}async function requestLandSearch(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{loadingScreen(1);let i=await makeRequestToTools({pid:t,operation:"searchForLands"});if(loadingScreen(0),i.data.status){let a=Object.keys(i.data.entities).filter(e=>!autoUpdateLocations.includes(e.toString())).reduce((e,t)=>(e[t]=i.data.entities[t],e),{});if(0===Object.keys(a).length)autoUpdateLocations.includes("speck")?quickMessage("No new lands found with your entities.","info"):quickMessage("No new lands found with your entities. You may still add your speck.","info");else{let s=document.querySelector(".voxels-networth-landsearch");if(s){s.querySelector(".voxels-networth-landsearch-text")?.remove();let n=s.querySelector(".voxels-networth-found-lands");n&&n.remove(),(n=document.createElement("div")).classList.add("voxels-networth-found-lands");let l=document.createElement("div");l.textContent="Entities found:",l.classList.add("voxels-networth-found-title"),n.appendChild(l),Object.entries(a).forEach(([e,t])=>{let i=document.createElement("div");i.classList.add("voxels-networth-found-land-row");let a=document.createElement("div");a.textContent=`${e}`,a.classList.add("voxels-found-land-number"),i.appendChild(a);let s=mapItmToNameAndImage(t,displayNamesJSONArray),l=document.createElement("div");l.classList.add("voxels-found-land-items"),s.slice(0,5).forEach(e=>{let t=document.createElement("div");t.classList.add("voxels-found-item-image-container");let i=document.createElement("img");i.src=e.image,i.title=e.displayName,i.classList.add("voxels-found-item-image"),t.addEventListener("mouseenter",()=>{let i=document.createElement("div");i.classList.add("voxels-networth-hover");let a=getNameForItem(e.item),s=document.createElement("div");s.classList.add("voxels-networth-hover-name"),s.textContent=a,i.appendChild(s),document.body.appendChild(i);let n=t.getBoundingClientRect(),l=n.left+n.width/2,r=i.offsetWidth,o=i.offsetHeight,d=l-r/2,c=n.top-o-5,p=window.innerWidth;window.innerHeight,d<0&&(d=5),d+r>p&&(d=p-r),c<0&&(c=5),i.style.position="absolute",i.style.left=`${d}px`,i.style.top=`${c}px`,t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})})}),t.appendChild(i),l.appendChild(t)}),i.appendChild(l);let r=document.createElement("div");r.classList.add("voxels-found-add-land-button"),r.onclick=()=>{updateLandEntities(e)},i.appendChild(r),n.appendChild(i)}),s.appendChild(n)}}}else console.log("Failed to fetch lands.",i.message)}catch(r){console.error("Error fetching lands.",r)}})}const renderPriceChart=(e,t=250,i=100)=>{let a=document.createElement("div"),s=document.createElement("canvas");s.width=t,s.height=i,a.appendChild(s);let n=e.map(e=>e.p),l=e.map(e=>new Date(1e3*e.t).toLocaleTimeString()),r="#e3ff36";return new Chart(s,{type:"line",data:{labels:l,datasets:[{data:n,borderColor:r,backgroundColor:"rgba(227,255,54,0.2)",fill:!1,borderWidth:1,pointRadius:0,tension:.4}]},options:{responsive:!1,maintainAspectRatio:!1,animations:{duration:0},plugins:{legend:{display:!1},tooltip:{enabled:!1}},scales:{x:{display:!1},y:{position:"right",ticks:{font:{size:10,weight:"bold"},color:r,callback:(e,t,i)=>nFormatter(e,1)},beginAtZero:!1,grid:{color:"rgba(228, 255, 54,0.1)"}}}}}),a};