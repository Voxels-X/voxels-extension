function loadNetworth(e){premium?chrome.storage.local.get("pid",async function(e){let t=e.pid;loadingScreen(1);try{let a=await makeRequestToTools({pid:t,operation:"getEntities"});if(loadingScreen(0),!a||!a.data){quickMessage("Please try again later","error");return}updateAutoUpdateLocations(a.data),loadNetworthPage(a.data)}catch(i){console.error("Error retrieving entities:",i)}}):displayPremium()}function updateAutoUpdateLocations(e){if(!e||"object"!=typeof e)return;let t=e.entities?Object.keys(e.entities):[],a=e.storages?Object.keys(e.storages):[],i=[...new Set([...t,...a])];autoUpdateLocations=i.filter(e=>"total_value"!==e).map(e=>e.toString())}function getToolsLands(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{let a=await makeRequestToTools({pid:t,operation:"getLands"});if(!a||!a.data){console.log("Error: No land data returned.");return}autoUpdateLocations=a.data.lands.map(String)||[]}catch(i){console.log("Error retrieving lands")}})}let storedItemCache=null;function initialStorageFetch(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{let a=await makeRequestToTools({pid:t,operation:"getStorages"});if(!a||!a.data){console.log("Error: No storage data returned.");return}a.data.lands&&(handleT4Data(a.data.lands,"storages"),storedItemCache=a.data.lands)}catch(i){console.log("Error retrieving lands")}})}function loadNetworthPage(e){if("object"==typeof e&&e.hasOwnProperty("error")){switch(e.error){case"12001":networthContainer.textContent="Error: Premium credentials are invalid or expired. Please renew your subscription.";break;case"12002":displayPageInfo("Secure Voxels","To access the networth page, please secure your account in the settings. Click here for settings.",chrome.runtime.getURL("images/Other/secure_account.png"),function(){switchFullPage("settings")});break;default:console.error("Unknown error:",e.error),networthContainer.textContent="Error: An unknown issue occurred. Please try again later."}return networthContainer}reloadOverlay();let t=document.querySelector(".voxels-main");t.appendChild(addNetworthContent(e)).classList.add("active")}function addNetworthContent(e){var t=document.createElement("div");t.classList.add("voxels-networth-page");var a=document.createElement("div");a.classList.add("voxels-networth-header");var i=document.createElement("div");i.classList.add("voxels-networth-header-stats","hidden");var s=document.createElement("div");s.classList.add("voxels-networth-header-stats-sub-statistics");var n=e.storages.total_value,l=e.entities.total_value,r=e.market_listings.total_value,o=document.createElement("div");o.classList.add("voxels-networth-header-stats-sub-statistics-coinbalance"),s.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),d.innerText="Coin Balance",o.appendChild(d);var c=document.createElement("div");c.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),c.innerText=`${nFormatter(currentCoinBalance,1)}`,o.appendChild(c);var p=document.createElement("div");p.classList.add("voxels-networth-header-stats-sub-statistics-inventoryvalue"),s.appendChild(p);var h=document.createElement("div");h.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),h.innerText="Inventory Value",p.appendChild(h);var v=document.createElement("div");if(v.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),v.innerText=`${nFormatter(inventoryValue,1)}`,p.appendChild(v),petInventoryValue>0){var m=document.createElement("div");m.classList.add("voxels-networth-header-stats-sub-statistics-petinventoryvalue"),s.appendChild(m);var u=document.createElement("div");u.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),u.innerText="Pet Inventory Value",m.appendChild(u);var g=document.createElement("div");g.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),g.innerText=`${nFormatter(petInventoryValue,1)}`,m.appendChild(g),g.prepend(_())}var x=document.createElement("div");x.classList.add("voxels-networth-header-stats-sub-statistics-storagestotal"),s.appendChild(x);var L=document.createElement("div");L.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),L.innerText="Storages",x.appendChild(L);var f=document.createElement("div");f.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),f.innerText=`${nFormatter(n,1)}`,x.appendChild(f);var w=document.createElement("div");w.classList.add("voxels-networth-header-stats-sub-statistics-entitiestotal"),s.appendChild(w);var E=document.createElement("div");E.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),E.innerText="Entities",w.appendChild(E);var C=document.createElement("div");C.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),C.innerText=`${nFormatter(l,1)}`,w.appendChild(C);var y=document.createElement("div");y.classList.add("voxels-networth-header-stats-sub-statistics-marketlistingsvalue"),s.appendChild(y);var b=document.createElement("div");b.classList.add("voxels-networth-header-stats-sub-statistics-item-title"),b.innerText="Market Listings",y.appendChild(b);var $=document.createElement("div");$.classList.add("voxels-networth-header-stats-sub-statistics-item-number"),$.innerText=`${nFormatter(r,1)}`,y.appendChild($);var k=document.createElement("div");k.classList.add("voxels-networth-header-stats-main-statistic");var S=document.createElement("h2");S.classList.add("voxels-networth-header-stats-main-statistic-name"),S.textContent="Networth",k.appendChild(S);var T=document.createElement("span");function _(){let e=document.createElement("img");return e.src=chrome.runtime.getURL("/images/Prices/coin.png"),e.alt="Coin Icon",e.classList.add("coin-image"),e}T.classList.add("voxels-networth-header-stats-main-statistic-number"),c.prepend(_()),v.prepend(_()),f.prepend(_()),C.prepend(_()),$.prepend(_());let N="0";if(e.total_value){let A=e.total_value;inventoryValue>0&&(A+=inventoryValue),petInventoryValue>0&&(A+=petInventoryValue),currentCoinBalance>0&&(A+=currentCoinBalance),N=nFormatter(A,3)}T.textContent=N,T.append(_()),k.prepend(T);var q=document.createElement("div");q.classList.add("voxels-networth-header-stats-expand-btn"),q.addEventListener("click",function(){i.classList.toggle("hidden")}),k.appendChild(q),i.appendChild(k),i.appendChild(s),a.appendChild(i);var P=e.market_listings;let R=Object.keys(P).slice(0,-1),H=R.map(e=>{let t=P[e],a=getNameForItem(e),i=getImageForItem(e),{quantity:s,price:n,total_price:l}=t;return{itemName:a,itemImage:i,quantity:s,price:n,total_price:l}}),U=H.sort((e,t)=>t.total_price-e.total_price).slice(0,5);y.addEventListener("mouseenter",()=>{(hoverContainer=document.createElement("div")).classList.add("voxels-networth-marketlistings-modal"),document.body.appendChild(hoverContainer);let e=`
                <div class="voxels-networth-marketlistings-modal-title">
                    Top Market Listings
                </div>
            `,t="";t=U.length>0?U.map(({itemName:e,itemImage:t,quantity:a,total_price:i})=>`
                    <div class="voxels-networth-marketlistings-modal-item">
                        <div class="voxels-networth-marketlistings-modal-item-icon">
                            <img class="voxels-networth-entity-image" src="${t}" />
                            <div class="voxels-networth-entity-count">x${nFormatter(a,0)}</div>
                        </div>
                        <div class="voxels-networth-marketlistings-modal-item-name">${e}</div>
                        <div class="voxels-networth-marketlistings-modal-item-price">
                            <img src="${chrome.runtime.getURL("/images/Prices/coin.png")}" alt="Coin Icon" class="coin-image">
                            ${nFormatter(i,1)}
                        </div>
                    </div>
                    `).join(""):`
                <div class="voxels-networth-marketlistings-modal-empty-content">
                    No listings (updates every 5 mins)
                </div>
                `,hoverContainer.innerHTML=e+t;let a=y.getBoundingClientRect(),i=a.left+a.width/2;hoverContainer.style.position="absolute";let s=hoverContainer.offsetWidth,n=hoverContainer.offsetHeight,l=i-s/2,r=a.top-n-5,o=window.innerWidth;window.innerHeight,l<0&&(l=5),l+s>o&&(l=o-s-5),r<0&&(r=a.bottom+5),hoverContainer.style.left=`${l}px`,hoverContainer.style.top=`${r}px`;let d=()=>{hoverContainer&&hoverContainer.remove(),y.removeEventListener("mouseleave",d)};y.addEventListener("mouseleave",d)});var M=document.createElement("div");M.classList.add("voxels-networth-header-tools");var F=document.createElement("div");F.classList.add("voxels-networth-add-btn"),M.appendChild(F);let I=limiter(addNewLandAndStorageToNetworth,1e4);return F.addEventListener("click",function(){I()}),a.appendChild(M),t.appendChild(a),loadFilterNetworth(t),e.entities&&delete e.entities.total_value,e.storages&&delete e.storages.total_value,loadLands(t,e),loadLandSearch(t),t}function loadLandSearch(e){var t=document.createElement("div");t.classList.add("voxels-networth-landsearch");var a=document.createElement("div");a.classList.add("voxels-networth-landsearch-text"),a.textContent="Search for industries...",t.appendChild(a);let i=limiter(function(){requestLandSearch()},1e4);a.addEventListener("click",function(){i()}),e.appendChild(t)}function loadFilterNetworth(e){var t=document.createElement("div");t.classList.add("voxels-networth-filter-container");var a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("placeholder","Search..."),a.classList.add("voxels-filter-input"),t.appendChild(a),e.appendChild(t),a.addEventListener("input",function(t){(function t(){let i=a.value.toLowerCase(),s=e.querySelectorAll(".voxels-networth-collection-item");s.forEach(e=>{let t=e.getAttribute("data-collection-item-name").toLowerCase(),a=""===i||t.includes(i);a?e.classList.remove("voxels-networth-item-hidden"):e.classList.add("voxels-networth-item-hidden")})})(),function t(){let a=e.querySelectorAll(".voxels-networth-land");a.forEach(e=>{let t=e.querySelectorAll(".voxels-networth-collection-item"),a=Array.from(t).filter(e=>!e.classList.contains("voxels-networth-item-hidden"));0===a.length?e.style.display="none":e.style.display=""});let i=e.querySelectorAll(".voxels-networth-location");i.forEach(e=>{let t=e.querySelectorAll(".voxels-networth-collection-item"),a=Array.from(t).filter(e=>!e.classList.contains("voxels-networth-item-hidden"));if(0===a.length)e.style.display="none";else{e.style.display="";let i=e.querySelector(".voxels-toggle-button");a.length>5?(a.slice(5).forEach(e=>{e.classList.add("voxels-networth-item-hidden")}),i.style.display="flex"):i.style.display="none"}})}(),function e(){let t=Array.from(document.querySelectorAll(".voxels-toggle-button"));t.forEach(e=>{e.classList.remove("expanded"),e.classList.add("collapsed"),e.innerText="Show More"})}(),t.stopPropagation()}),a.addEventListener("keydown",function(e){a===document.activeElement&&e.stopPropagation()})}function loadLands(e,t){let a={};for(let i in t.entities){let s=t.entities[i];for(let n in a[i]=a[i]||{},a[i].total_price=s.total_price,s){let l=s[n].entities||[];if(a[i][n]=a[i][n]||{},a[i][n].entities=l,a[i][n].entities_total_price=s[n].total_price,t.storages[i]&&t.storages[i][n]){let r=t.storages[i][n].items||[];a[i][n].storages=r;let o=t.storages[i][n].total_price||0;a[i][n].storages_total_price=o,a[i].total_price+=o}}}for(let d in t.storages)for(let c in a[d]=a[d]||{},t.storages[d])if(a[d][c]=a[d][c]||{},!a[d][c].storages){let p=t.storages[d][c].items||[];a[d][c].storages=p,a[d].total_price=(a[d].total_price||0)+(t.storages[d][c].total_price||0),a[d][c].storages_total_price=t.storages[d][c].total_price||0}appendLands(e,a)}function appendLands(e,t){for(let[a,i]of Object.entries(t)){var s=document.createElement("div");s.classList.add("voxels-networth-land"),s.setAttribute("data-land-number",a);var n=document.createElement("div");let l;l="mocaclub"===a?"Moca Club":"PostOfficeInterior"===a?"Post Office":"DrunkenGooseInterior"===a?"Drunken Goose":a.charAt(0).toUpperCase()+a.slice(1);let r=nFormatter(i.total_price,1);n.textContent=`${l}`,n.classList.add("voxels-networth-land-number");var o=document.createElement("div");o.classList.add("voxels-networth-land-container"),o.innerText=`${r}`,n.appendChild(o);var d=document.createElement("img");d.classList.add("voxels-networth-land-number-icon"),d.src=chrome.runtime.getURL("/images/Prices/coin.png"),o.prepend(d);var c=document.createElement("div");c.classList.add("voxels-networth-land-tools");var p=document.createElement("div");p.classList.add("voxels-networth-refresh-btn");var h=document.createElement("img");h.classList.add("voxels-networth-refresh-btn-icon"),h.src=chrome.runtime.getURL("/images/icons/icon__refresh.svg"),p.appendChild(h);let v=limiter(function(){updateLandEntities(a)},1e4);p.addEventListener("click",function(){v()});var m=document.createElement("div");m.classList.add("voxels-close-button");var u=document.createElement("img");u.classList.add("voxels-close-button-icon"),u.src=chrome.runtime.getURL("/images/icons/icon__delete.svg"),m.appendChild(u),m.addEventListener("click",function(){removeLandFromNetworth(a)}),c.appendChild(p),c.appendChild(m),s.appendChild(n),s.appendChild(c),i.farm&&(addLocationEntities(s,"Farm",i.farm.entities,i.farm.entities_total_price),addLocationStorages(s,"Farm",i.farm.storages,i.farm.storages_total_price)),i.house&&(addLocationEntities(s,"House",i.house.entities,i.house.entities_total_price),addLocationStorages(s,"House",i.house.storages,i.house.storages_total_price)),e.appendChild(s)}}function toggleVisibility(e,t,a){e.forEach((e,i)=>{i>=t&&e.classList.toggle("voxels-networth-item-hidden",!a)})}function handleToggleButtonClick(e){let t=e.currentTarget,a=t.parentElement,i=Array.from(a.querySelectorAll(".voxels-networth-collection-item")),s=document.querySelector(".voxels-filter-input"),n=t.classList.contains("collapsed");if(s.value){let l=i.filter(e=>e.getAttribute("data-collection-item-name").toLowerCase().includes(s.value.toLowerCase()));toggleVisibility(l,5,n)}else{let r=Array.from(a.querySelectorAll(".voxels-networth-collection-item"));toggleVisibility(r,5,n)}t.classList.toggle("collapsed",!n),t.classList.toggle("expanded",n),t.innerText=n?"Show Less":"Show More"}function addLocationEntities(e,t,a,i){if(!a||0===a.length)return;a.sort((e,t)=>{let a=e.total_price||0,i=t.total_price||0;return i-a});var s=document.createElement("div");if(s.classList.add("voxels-networth-location"),"Farm"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/pixels_icon.png"),n.classList.add("voxels-networth-location-title-icon")}else if("House"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/Other/house-1.png"),n.classList.add("voxels-networth-location-title-icon")}var l=document.createElement("div");l.classList.add("voxels-networth-location-title"),l.innerText="Entities",l.prepend(n),s.appendChild(l);let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon");var o=document.createElement("div");o.classList.add("voxels-networth-location-title-price"),o.innerText=`${nFormatter(i,1)}`,o.prepend(r),l.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-content");let c=0,p=document.createElement("div");p.classList.add("voxels-toggle-button","collapsed"),p.id="toggleVisibility",p.innerText="Show More",p.addEventListener("click",handleToggleButtonClick),a.forEach(e=>{var t=document.createElement("div");t.classList.add("voxels-networth-entity","voxels-networth-collection-item"),t.setAttribute("data-collection-item-name",getNameForItem(e.item)),c>=5&&t.classList.add("voxels-networth-item-hidden"),c++;let a=getImageForItem(e.item);var i=document.createElement("img");a?i.src=a:i.src="https://pixels-api.com/images/item_not_found.png",i.classList.add("voxels-networth-entity-image");var s=e.count,n=document.createElement("div");if(n.textContent="x"+nFormatter(s,1),n.classList.add("voxels-networth-entity-count"),e.price){var l=document.createElement("div");l.classList.add("voxels-networth-price"),l.innerText=`${nFormatter(e.price,1)}`;let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon"),l.appendChild(r),t.appendChild(l)}t.addEventListener("mouseenter",()=>{let a=document.createElement("div");a.classList.add("voxels-networth-hover");let i=getNameForItem(e.item),n=findRecipe(e.item),l=s*(e.price||0),r=nFormatter(l,1),o=e.price||0,d=nFormatter(o,1),c=document.createElement("div");c.classList.add("voxels-networth-hover-name"),c.textContent=i;let p=document.createElement("div");p.classList.add("voxels-networth-hover-price"),p.innerHTML=`${s} x ${d} = ${r}`;let h=document.createElement("img");if(h.src=chrome.runtime.getURL("images/Prices/coin.png"),h.classList.add("voxels-networth-price-icon"),p.innerHTML=`${s} x `,p.appendChild(h),p.innerHTML+=` ${d} = `,p.appendChild(h.cloneNode()),p.innerHTML+=` ${r}`,a.appendChild(c),a.appendChild(p),null!==n){let v=document.createElement("div");v.classList.add("voxels-networth-hover-recipe-container");let m=document.createElement("div");m.classList.add("voxels-networth-hover-recipe-header"),m.textContent="Recipe",v.appendChild(m);let u=mapItmToNameAndImage(n.map(e=>e.id));u.forEach((e,t)=>{let a=n[t].quantity,i=document.createElement("div");i.classList.add("voxels-networth-hover-recipe-item"),i.setAttribute("data-item-name",e.name);let s=document.createElement("img");s.src=e.image,s.alt=e.name,s.classList.add("voxels-networth-hover-recipe-image");let l=document.createElement("div");l.classList.add("voxels-networth-hover-recipe-count"),l.textContent=`x${a}`,i.appendChild(s),i.appendChild(l),v.appendChild(i)}),a.appendChild(v)}document.body.appendChild(a);let g=t.getBoundingClientRect(),x=g.left+g.width/2,L=a.offsetWidth,f=a.offsetHeight,w=x-L/2,E=g.top-f-5,C=window.innerWidth;window.innerHeight,w<0&&(w=5),w+L>C&&(w=C-L),E<0&&(E=5),a.style.position="absolute",a.style.left=`${w}px`,a.style.top=`${E}px`}),t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}),t.appendChild(i),t.appendChild(n),d.appendChild(t)});let h=Array.from(d.querySelectorAll(".voxels-networth-entity"));h.length>5?p.style.display="flex":p.style.display="none",d.appendChild(p),s.appendChild(d),e.appendChild(s)}function addLocationStorages(e,t,a,i){if(!a||0===a.length)return;a.sort((e,t)=>{let a=e.total_price||0,i=t.total_price||0;return i-a});var s=document.createElement("div");if(s.classList.add("voxels-networth-location"),"Farm"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/pixels_icon.png"),n.classList.add("voxels-networth-location-title-icon")}else if("House"===t){var n=document.createElement("img");n.src=chrome.runtime.getURL("/images/Other/house-1.png"),n.classList.add("voxels-networth-location-title-icon")}var l=document.createElement("div");l.classList.add("voxels-networth-location-title"),l.innerText="Storages",l.prepend(n),s.appendChild(l);let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon");var o=document.createElement("div");o.classList.add("voxels-networth-location-title-price"),o.innerText=`${nFormatter(i,1)}`,o.prepend(r),l.appendChild(o);var d=document.createElement("div");d.classList.add("voxels-networth-content");let c=0,p=document.createElement("div");p.classList.add("voxels-toggle-button","collapsed"),p.id="toggleVisibility",p.innerText="Show More",p.addEventListener("click",handleToggleButtonClick),a.forEach(e=>{var t=document.createElement("div");t.classList.add("voxels-networth-storage","voxels-networth-collection-item"),t.setAttribute("data-collection-item-name",getNameForItem(e.item)),c>=5&&t.classList.add("voxels-networth-item-hidden"),c++;let a=getImageForItem(e.item);var i=document.createElement("img");a?i.src=a:i.src="https://pixels-api.com/images/item_not_found.png",i.classList.add("voxels-networth-storage-image");var s=e.count,n=document.createElement("div");if(n.textContent="x"+nFormatter(s,1),n.classList.add("voxels-networth-storage-count"),e.price){var l=document.createElement("div");l.classList.add("voxels-networth-price"),l.innerText=`${nFormatter(e.price,1)}`;let r=document.createElement("img");r.src=chrome.runtime.getURL("images/Prices/coin.png"),r.classList.add("voxels-networth-price-icon"),l.appendChild(r),t.appendChild(l)}t.appendChild(i),t.appendChild(n),t.addEventListener("mouseenter",()=>{let a=document.createElement("div");a.classList.add("voxels-networth-hover");let i=getNameForItem(e.item),n=findRecipe(e.item),l=s*(e.price||0),r=e.price||0,o=nFormatter(r,1),d=nFormatter(l,1),c=document.createElement("div");c.classList.add("voxels-networth-hover-name"),c.textContent=i;let p=document.createElement("div");p.classList.add("voxels-networth-hover-price"),p.textContent=`Total: ${s} x ${o} = ${d}`;let h=document.createElement("img");if(h.src=chrome.runtime.getURL("images/Prices/coin.png"),h.classList.add("voxels-networth-price-icon"),p.innerHTML=`${s} x `,p.appendChild(h),p.innerHTML+=` ${o} = `,p.appendChild(h.cloneNode()),p.innerHTML+=` ${d}`,a.appendChild(c),a.appendChild(p),null!==n){let v=document.createElement("div");v.classList.add("voxels-networth-hover-recipe-container");let m=document.createElement("div");m.classList.add("voxels-networth-hover-recipe-header"),m.textContent="Recipe",v.appendChild(m);let u=mapItmToNameAndImage(n.map(e=>e.id));u.forEach((e,t)=>{let a=n[t].quantity,i=document.createElement("div");i.classList.add("voxels-networth-hover-recipe-item"),i.setAttribute("data-item-name",e.name);let s=document.createElement("img");s.src=e.image,s.alt=e.name,s.classList.add("voxels-networth-hover-recipe-image");let l=document.createElement("div");l.classList.add("voxels-networth-hover-recipe-count"),l.textContent=`x${a}`,i.appendChild(s),i.appendChild(l),v.appendChild(i)}),a.appendChild(v)}document.body.appendChild(a);let g=t.getBoundingClientRect(),x=g.left+g.width/2,L=a.offsetWidth,f=a.offsetHeight,w=x-L/2,E=g.top-f-5,C=window.innerWidth;window.innerHeight,w<0&&(w=5),w+L>C&&(w=C-L-5),E<0&&(E=5),a.style.position="absolute",a.style.left=`${w}px`,a.style.top=`${E}px`}),t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})}),d.appendChild(t)});let h=Array.from(d.querySelectorAll(".voxels-networth-storage"));h.length>5?p.style.display="flex":p.style.display="none",d.appendChild(p),s.appendChild(d),e.appendChild(s)}async function removeLandFromNetworth(e){chrome.storage.local.get("pid",async function(t){let a=t.pid;try{let i=await makeRequestToTools({pid:a,operation:"removeLocation",extra:[{location:e}]});if("success"===i.data.status){var s=document.querySelector(`[data-land-number="${e}"]`);if(s){s.remove();let n=autoUpdateLocations.indexOf(e);-1!==n&&autoUpdateLocations.splice(n,1)}}else console.log(`Failed to remove land ${e}:`,i.message)}catch(l){console.error(`Error removing land ${e}:`,l)}})}function addNewLandAndStorageToNetworth(){"string"==typeof currentLand&&""!==currentLand.trim()?autoUpdateLocations.includes(currentLand)?quickMessage("This land is already being tracked.","error"):(loadingScreen(1),handleStorages(cachedStorages,currentLocation,!0)):"PostOfficeInterior"==currentLocation||"DrunkenGooseInterior"==currentLocation||"mocaclub"==currentLocation?autoUpdateLocations.includes(currentLocation)?quickMessage("This land is already being tracked.","error"):(loadingScreen(1),handleStorages(cachedStorages,currentLocation,!0)):quickMessage("Make sure you are on a valid land to start tracking.","error")}async function updateLandEntities(e){chrome.storage.local.get("pid",async function(t){let a=t.pid;try{loadingScreen(1);let i=await makeRequestToTools({pid:a,operation:"updateEntities",extra:[{location:e}]});loadingScreen(0),i.data.status?loadNetworth(0):console.log(`Failed to update land ${e}:`,i.message)}catch(s){console.error(`Error updating land ${e}:`,s)}})}async function requestLandSearch(){chrome.storage.local.get("pid",async function(e){let t=e.pid;try{loadingScreen(1);let a=await makeRequestToTools({pid:t,operation:"searchForLands"});if(loadingScreen(0),a.data.status){let i=Object.keys(a.data.entities).filter(e=>!autoUpdateLocations.includes(e.toString())).reduce((e,t)=>(e[t]=a.data.entities[t],e),{});if(0===Object.keys(i).length)autoUpdateLocations.includes("speck")?quickMessage("No new lands found with your entities.","info"):quickMessage("No new lands found with your entities. You may still add your speck.","info");else{let s=document.querySelector(".voxels-networth-landsearch");if(s){s.querySelector(".voxels-networth-landsearch-text")?.remove();let n=s.querySelector(".voxels-networth-found-lands");n&&n.remove(),(n=document.createElement("div")).classList.add("voxels-networth-found-lands");let l=document.createElement("div");l.textContent="Entities found:",l.classList.add("voxels-networth-found-title"),n.appendChild(l),Object.entries(i).forEach(([e,t])=>{let a=document.createElement("div");a.classList.add("voxels-networth-found-land-row");let i=document.createElement("div");i.textContent=`${e}`,i.classList.add("voxels-found-land-number"),a.appendChild(i);let s=mapItmToNameAndImage(t,displayNamesJSONArray),l=document.createElement("div");l.classList.add("voxels-found-land-items"),s.slice(0,5).forEach(e=>{let t=document.createElement("div");t.classList.add("voxels-found-item-image-container");let a=document.createElement("img");a.src=e.image,a.title=e.displayName,a.classList.add("voxels-found-item-image"),t.addEventListener("mouseenter",()=>{let a=document.createElement("div");a.classList.add("voxels-networth-hover");let i=getNameForItem(e.item),s=document.createElement("div");s.classList.add("voxels-networth-hover-name"),s.textContent=i,a.appendChild(s),document.body.appendChild(a);let n=t.getBoundingClientRect(),l=n.left+n.width/2,r=a.offsetWidth,o=a.offsetHeight,d=l-r/2,c=n.top-o-5,p=window.innerWidth;window.innerHeight,d<0&&(d=5),d+r>p&&(d=p-r),c<0&&(c=5),a.style.position="absolute",a.style.left=`${d}px`,a.style.top=`${c}px`,t.addEventListener("mouseleave",function(){let e=document.querySelectorAll(".voxels-networth-hover");e.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})})}),t.appendChild(a),l.appendChild(t)}),a.appendChild(l);let r=document.createElement("div");r.classList.add("voxels-found-add-land-button"),r.onclick=()=>{updateLandEntities(e)},a.appendChild(r),n.appendChild(a)}),s.appendChild(n)}}}else console.log("Failed to fetch lands.",a.message)}catch(r){console.error("Error fetching lands.",r)}})}