function loadSearchPage(){let e=document.querySelector(".voxels-main");e.appendChild(createIndustrySelect());let t=document.querySelector(".voxels-industry-container");t||((t=document.createElement("div")).classList.add("voxels-industry-container"),e.appendChild(t))}let requestIndustries=null,selectedLandTypes={land:!1,water:!1,space:!1},lastSearchedIndustry=null,lastSearchedTier=null;function createIndustrySelect(){selectedLandTypes={land:!1,water:!1,space:!1};let e=document.createElement("div");e.classList.add("voxels-industry-dropdown-container");let t=document.createElement("div");t.classList.add("voxels-industry-dropdown-button","clickable"),t.textContent="Select Industry",e.appendChild(t);let s=document.createElement("div");s.classList.add("voxels-industry-select-landtype-container"),["land","water","space"].forEach(e=>{let t=document.createElement("div");t.classList.add("voxels-industry-select-landtype","clickable");let a=document.createElement("img");a.src=chrome.runtime.getURL(`images/Other/${e}_land.png`),t.addEventListener("click",()=>{(!lastSearchedIndustry||!lastSearchedTier||searchIndustry(lastSearchedIndustry,lastSearchedTier))&&(t.classList.toggle("selected"),selectedLandTypes[e]=!selectedLandTypes[e])}),t.appendChild(a),s.appendChild(t)}),e.appendChild(s);let a=document.createElement("div");a.classList.add("voxels-industry-select-reload","clickable");let l=document.createElement("img");l.src=chrome.runtime.getURL("images/icons/icon__refresh.svg"),a.appendChild(l),e.appendChild(a),a.addEventListener("click",()=>{lastSearchedIndustry&&lastSearchedTier&&searchIndustry(lastSearchedIndustry,lastSearchedTier)});let d=document.createElement("div");d.classList.add("voxels-industry-select-container"),d.style.display="none",e.appendChild(d),requestIndustries.forEach(t=>{let s=document.createElement("div");s.classList.add("voxels-industry-select-row");let a=document.createElement("div");a.classList.add("voxels-industry-select-image");let l=document.createElement("img");l.src=chrome.runtime.getURL(`images/Farms/voxels_${t.name}.png`),l.alt=t.name,a.appendChild(l),s.appendChild(a);let r=document.createElement("span");r.textContent=t.display_name,r.classList.add("voxels-industry-select-name"),s.appendChild(r);let n=document.createElement("div");if(n.classList.add("voxels-industry-select-tiers"),0===t.tiers.length||1===t.tiers.length){let i=document.createElement("div");i.textContent="Standard",i.classList.add("voxels-industry-select-tier","clickable"),i.addEventListener("click",()=>{searchIndustry(t.name,"Standard")&&(e.querySelectorAll(".voxels-industry-select-tier").forEach(e=>e.classList.remove("selected")),i.classList.add("selected"),lastSearchedIndustry=t.name,lastSearchedTier="Standard",localStorage.setItem("lastSearchedIndustry",lastSearchedIndustry),localStorage.setItem("lastSearchedTier",lastSearchedTier),d.style.display="none")}),n.appendChild(i)}else t.tiers.forEach(s=>{let a=document.createElement("div");a.textContent=`${s}`,a.classList.add("voxels-industry-select-tier","clickable"),a.dataset.tier=s,a.addEventListener("click",()=>{searchIndustry(t.name,s)&&(e.querySelectorAll(".voxels-industry-select-tier").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),lastSearchedIndustry=t.name,lastSearchedTier=s,localStorage.setItem("lastSearchedIndustry",lastSearchedIndustry),localStorage.setItem("lastSearchedTier",lastSearchedTier),d.style.display="none")}),n.appendChild(a)});s.appendChild(n),d.appendChild(s)}),t.addEventListener("click",()=>{let e="none"===d.style.display;d.style.display=e?"flex":"none",t.classList.toggle("active",e)});let r=localStorage.getItem("lastSearchedIndustry");fetchedTier=localStorage.getItem("lastSearchedTier");let n="Standard"!==fetchedTier?parseInt(fetchedTier,10):fetchedTier;if(r&&n){lastSearchedIndustry=r,lastSearchedTier=n;let i=requestIndustries.find(e=>e.name===lastSearchedIndustry),c=lastSearchedTier;i&&searchIndustry(i.name,c)}return e}let lastClickTime=0;function searchIndustry(e,t){let s=Date.now();if(s-lastClickTime<500){let a=Math.ceil((500-(s-lastClickTime))/1e3);return quickMessage("Please wait "+a+"s...","error"),!1}return lastClickTime=s,chrome.storage.local.get("pid",async function(s){let a=s.pid,l={pid:a,operation:"fetchDataRequest",extra:{industry:e,tier:t,selectedLandTypes}};loadingScreen(1);try{let d=await makeFetchRequestByPID(apiURL,l);handleErrors(d)||("logout"==d?initiate():(loadingScreen(0),updateSearchTitle(e,t),addSearchedIndustries(d.data,e)))}catch(r){loadingScreen(0),quickMessage("Please try again.","error"),console.error(r)}}),!0}function updateSearchTitle(e,t){let s=requestIndustries.find(t=>t.name===e);if(!s)return;let a=s.display_name,l=t&&"Standard"!==t?` (Tier ${t})`:"",d=document.querySelector(".voxels-industry-dropdown-button.clickable");if(d){d.textContent="";let r=document.createElement("div");r.classList.add("voxels-industry-select-image");let n=document.createElement("img");n.src=chrome.runtime.getURL(`images/Farms/voxels_${e}.png`),n.alt=e,r.appendChild(n),d.appendChild(r);let i=document.createTextNode(`${a}${l}`);d.appendChild(i)}}function addSearchedIndustries(e,t){let s=document.querySelector(".voxels-industry-container");if(s.innerHTML="",0===e.length){s.innerHTML='<p class="voxels-industry-search-no-results">No results found.</p>';return}let a=document.createElement("div");a.classList.add("voxels-industry-search-table");let l=document.createElement("div");l.classList.add("voxels-industry-search-row","voxels-industry-search-header"),l.innerHTML=`
        <div class="voxels-industry-search-column">Land</div>
        <div class="voxels-industry-search-column">Ready</div>
        <div class="voxels-industry-search-column">Time</div>
    `,a.appendChild(l),e.forEach(e=>{let s=document.createElement("div");s.classList.add("voxels-industry-search-row");let l=document.createElement("div");l.classList.add("voxels-industry-search-row-main");let d;if(e.landId.includes("nftHouse"))d="Other/house-1.png";else switch(e.traits_environment){case"land":d="Other/land_land.png";break;case"water":d="Other/water_land.png";break;case"space":d="Other/space_land.png";break;default:d="pixels_icon.png"}let r=chrome.runtime.getURL(`images/${d}`),n=chrome.runtime.getURL(`images/Farms/voxels_${t}.png`),i=chrome.runtime.getURL("images/Other/guilds--shield-only.png"),c=`<img src="${r}" class="voxels-industry-search-icon">`,o=`<img src="${n}" class="voxels-industry-search-icon">`,u="";"ANY"!==e.permission&&(u=`<img src="${i}" class="voxels-industry-search-icon">`);let h=document.createElement("div");function m(){let t=e.finishing.length>0?e.finishing[0]-Date.now():0;t<=0?(h.textContent="Ready",clearInterval(p)):h.textContent=formatTime(t/1e3)}h.classList.add("voxels-industry-search-column");let p=setInterval(m,1e3);m();let y=e.landId.replace(/\D+/g,"");l.innerHTML=`
            <div class="voxels-industry-search-column">${c} ${y} ${u}</div>
            <div class="voxels-industry-search-column">${e.available}/${e.total} ${o}</div>
        `,l.appendChild(h),l.addEventListener("click",()=>{let t=s.querySelector(".voxels-industry-search-details");if(t)t.remove();else{let a=document.createElement("div");function l(){a.innerHTML=e.finishing.map(e=>{let t=e>Date.now()?formatTime((e-Date.now())/1e3):"Ready";return`<div class="voxels-industry-search-detail-row"><img src="${n}" class="voxels-industry-search-icon"> ${t}</div>`}).join(""),e.finishing.every(e=>e<=Date.now())&&clearInterval(d)}a.classList.add("voxels-industry-search-details");let d=setInterval(l,1e3);l(),s.appendChild(a)}}),s.appendChild(l),a.appendChild(s)}),s.appendChild(a)}function formatTime(e){let t=Math.floor(e/3600),s=Math.floor(e%3600/60),a="";return t>0&&(a+=`${t}h `),s>0&&(a+=`${s}m `),(a+=`${Math.floor(e%60)}s`).trim()}