function loadSearchPage(){const e=document.querySelector(".voxels-main");e.appendChild(createIndustrySelect());let t=document.querySelector(".voxels-industry-container");t||(t=document.createElement("div"),t.classList.add("voxels-industry-container"),e.appendChild(t))}let requestIndustries=null,selectedLandTypes={land:!1,water:!1,space:!1},selectedBoost=!1,filters={},lastSearchedIndustry=null,lastSearchedTier=null;function createIndustrySelect(){selectedLandTypes={land:!1,water:!1,space:!1},selectedBoost=!1,filters={};const e=document.createElement("div");e.classList.add("voxels-industry-dropdown-container");const t=document.createElement("div");t.classList.add("voxels-industry-dropdown-button","clickable"),t.textContent="Select Industry",e.appendChild(t);const s=document.createElement("div");s.classList.add("voxels-industry-select-landtype-container");["land","water","space"].forEach((e=>{const t=document.createElement("div");t.classList.add("voxels-industry-select-landtype","clickable");const n=document.createElement("img");n.src=chrome.runtime.getURL(`images/Other/${e}_land.png`),t.addEventListener("click",(()=>{lastSearchedIndustry&&lastSearchedTier&&!searchIndustry(lastSearchedIndustry,lastSearchedTier)||(t.classList.toggle("selected"),selectedLandTypes[e]=!selectedLandTypes[e])})),t.appendChild(n),s.appendChild(t)})),e.appendChild(s);const n=document.createElement("div");n.classList.add("voxels-industry-select-boost","clickable");const a=document.createElement("img");a.src=chrome.runtime.getURL("images/icons/icon__boost.svg"),n.appendChild(a),e.appendChild(n),n.addEventListener("click",(()=>{if(premium){if(lastSearchedIndustry&&lastSearchedTier&&!searchIndustry(lastSearchedIndustry,lastSearchedTier))return;n.classList.toggle("selected"),selectedBoost=!selectedBoost}else showPremiumPopup("search_boost")}));const d=document.createElement("div");d.classList.add("voxels-industry-select-filter","clickable"),d.innerHTML=`<img class="voxels-svg-invert" src="${chrome.runtime.getURL("images/icons/icon__filter.svg")}">`,e.appendChild(d);const c=document.createElement("div");c.classList.add("voxels-industry-select-filter-dropdown"),[{key:"treeDensity",label:"Tree Density",options:["Light","Dense"]},{key:"state",label:"Soil State",options:["Empty","Grown"]}].forEach((({key:e,label:t,options:s})=>{c.insertAdjacentHTML("beforeend",`<div class="voxels-industry-select-filter-dropdown-label">${t}</div>`);const n=document.createElement("div");n.classList.add("voxels-industry-select-filter-dropdown-options"),s.forEach((t=>{const s=t.toLowerCase(),a=document.createElement("div");a.className="voxels-industry-select-filter-dropdown-option clickable",a.textContent=t,filters[e]===s&&a.classList.add("selected"),a.addEventListener("click",(()=>{const t=filters[e]===s;filters={},document.querySelectorAll(".voxels-industry-select-filter-dropdown-option").forEach((e=>e.classList.remove("selected"))),t||(filters[e]=s,a.classList.add("selected")),d.classList.toggle("selected",Object.keys(filters).some((e=>filters[e]))),lastSearchedIndustry&&lastSearchedTier&&searchIndustry(lastSearchedIndustry,lastSearchedTier)})),n.appendChild(a)})),c.appendChild(n)})),d.appendChild(c),d.addEventListener("click",(()=>{if(premium){const e="flex"!==c.style.display;c.style.display=e?"flex":"none",d.classList.toggle("active",e)}else showPremiumPopup("search_filter")})),document.addEventListener("click",(e=>{d.contains(e.target)||(c.style.display="none",d.classList.remove("active"))}));const l=document.createElement("div");l.classList.add("voxels-industry-select-reload","clickable");const r=document.createElement("img");r.src=chrome.runtime.getURL("images/icons/icon__refresh.svg"),l.appendChild(r),e.appendChild(l),l.addEventListener("click",(()=>{lastSearchedIndustry&&lastSearchedTier&&searchIndustry(lastSearchedIndustry,lastSearchedTier)}));const i=document.createElement("div");i.classList.add("voxels-industry-select-container"),i.style.display="none",e.appendChild(i),requestIndustries.forEach((t=>{const s=document.createElement("div");s.classList.add("voxels-industry-select-row");const n=document.createElement("div");n.classList.add("voxels-industry-select-image");const a=document.createElement("img");a.src=chrome.runtime.getURL(`images/Farms/voxels_${t.name}.png`),a.alt=t.name,n.appendChild(a),s.appendChild(n);const d=document.createElement("span");d.textContent=t.display_name,d.classList.add("voxels-industry-select-name"),s.appendChild(d);const c=document.createElement("div");if(c.classList.add("voxels-industry-select-tiers"),0===t.tiers.length||1===t.tiers.length){const s=document.createElement("div");s.textContent="Standard",s.classList.add("voxels-industry-select-tier","clickable"),s.addEventListener("click",(()=>{searchIndustry(t.name,"Standard")&&(e.querySelectorAll(".voxels-industry-select-tier").forEach((e=>e.classList.remove("selected"))),s.classList.add("selected"),lastSearchedIndustry=t.name,lastSearchedTier="Standard",localStorage.setItem("lastSearchedIndustry",lastSearchedIndustry),localStorage.setItem("lastSearchedTier",lastSearchedTier),i.style.display="none")})),c.appendChild(s)}else t.tiers.forEach((s=>{const n=document.createElement("div");n.textContent=`${s}`,n.classList.add("voxels-industry-select-tier","clickable"),n.dataset.tier=s,n.addEventListener("click",(()=>{searchIndustry(t.name,s)&&(e.querySelectorAll(".voxels-industry-select-tier").forEach((e=>e.classList.remove("selected"))),n.classList.add("selected"),lastSearchedIndustry=t.name,lastSearchedTier=s,localStorage.setItem("lastSearchedIndustry",lastSearchedIndustry),localStorage.setItem("lastSearchedTier",lastSearchedTier),i.style.display="none")})),c.appendChild(n)}));s.appendChild(c),i.appendChild(s)})),t.addEventListener("click",(()=>{const e="none"===i.style.display;i.style.display=e?"flex":"none",t.classList.toggle("active",e)}));const o=localStorage.getItem("lastSearchedIndustry");fetchedTier=localStorage.getItem("lastSearchedTier");const m="Standard"!==fetchedTier?parseInt(fetchedTier,10):fetchedTier;if(o&&m){lastSearchedIndustry=o,lastSearchedTier=m;const e=requestIndustries.find((e=>e.name===lastSearchedIndustry)),t=lastSearchedTier;e&&searchIndustry(e.name,t)}return e}let lastClickTime=0;function searchIndustry(e,t){const s=Date.now();if(s-lastClickTime<500){const e=Math.ceil((500-(s-lastClickTime))/1e3);return quickMessage("Please wait "+e+"s...","error"),!1}return lastClickTime=s,chrome.storage.local.get("pid",(async function(s){const n={pid:s.pid,operation:"fetchDataRequest",extra:{industry:e,tier:t,selectedLandTypes:selectedLandTypes,selectedBoost:selectedBoost,filters:filters}};loadingScreen(1);try{const s=await makeFetchRequestByPID(apiURL,n);handleErrors(s)||("logout"==s?initiate():(loadingScreen(0),updateSearchTitle(e,t),addSearchedIndustries(s.data,e,t)))}catch(e){loadingScreen(0),quickMessage("Please try again.","error")}})),!0}function updateSearchTitle(e,t){const s=requestIndustries.find((t=>t.name===e));if(!s)return;const n=s.display_name,a=t&&"Standard"!==t?` (Tier ${t})`:"",d=document.querySelector(".voxels-industry-dropdown-button.clickable");if(d){d.textContent="";const c=document.createElement("div");c.classList.add("voxels-industry-select-image");const l=document.createElement("img");let r="";s.images?"Standard"===t?r=s.images[0]:t&&s.images[t-1]&&(r=s.images[t-1]):r=e,l.src=r.startsWith("https://")?r:chrome.runtime.getURL(`images/Farms/voxels_${r}.png`),l.alt=e,c.appendChild(l),d.appendChild(c);const i=document.createElement("div");i.classList.add("voxels-industry-dropdown-label"),i.textContent=`${n}${a}`,d.appendChild(i)}}function addSearchedIndustries(e,t,s){const n=document.querySelector(".voxels-industry-container");n.innerHTML="";const a=requestIndustries.find((e=>e.name===t));if(0===e.length)return void(n.innerHTML='<p class="voxels-industry-search-no-results">No results found.</p>');const d=document.createElement("div");d.classList.add("voxels-industry-search-table");const c=document.createElement("div");c.classList.add("voxels-industry-search-row","voxels-industry-search-header");const l=chrome.runtime.getURL("images/icons/icon__boost.svg");c.innerHTML=`\n    <div class="voxels-industry-search-column">Land</div>\n    <div class="voxels-industry-search-column">Ready</div>\n    <div class="voxels-industry-search-column"><img src="${l}" class="voxels-industry-search-icon" title="Boosts"></div>\n    <div class="voxels-industry-search-column">Time</div>\n    `,d.appendChild(c),e.forEach((e=>{const n=document.createElement("div");n.classList.add("voxels-industry-search-row");const c=document.createElement("div");let l;if(c.classList.add("voxels-industry-search-row-main"),e.landId.includes("nftHouse"))l="Other/house-1.png";else switch(e.traits_environment){case"land":l="Other/land_land.png";break;case"water":l="Other/water_land.png";break;case"space":l="Other/space_land.png";break;default:l="pixels_icon.png"}const r=chrome.runtime.getURL(`images/${l}`);let i="";a.images?"Standard"===s?i=a.images[0]:s&&a.images[s-1]&&(i=a.images[s-1]):i=t;const o=i.startsWith("https://")?i:chrome.runtime.getURL(`images/Farms/voxels_${i}.png`),m=chrome.runtime.getURL("images/Other/guilds--shield-only.png"),u=`<img src="${r}" class="voxels-industry-search-icon">`,h=`<img src="${o}" class="voxels-industry-search-icon">`;let p="";"ANY"!==e.permission&&(p=`<img src="${m}" class="voxels-industry-search-icon">`);const y=document.createElement("div");function v(){if(0===e.finishing.length)return y.textContent="Ready",void clearInterval(g);const t=e.finishing.map((e=>e-Date.now()));if(t.every((e=>e<=0)))y.textContent="Ready",clearInterval(g);else{y.innerHTML="";const e=[...t].sort(((e,t)=>e-t)),s=e[0]<=0?"Ready":formatTime(e[0]/1e3),n=document.createElement("div");if(n.className="voxels-industry-search-time-primary",n.textContent=s,y.appendChild(n),e.length>1){const t=e[e.length-1]<=0?"Ready":formatTime(e[e.length-1]/1e3),s=document.createElement("div");s.className="voxels-industry-search-time-secondary",s.textContent=t,y.appendChild(s)}}}y.classList.add("voxels-industry-search-column","voxels-industry-search-time-column");const g=setInterval(v,1e3);v();const L=e.landId.replace(/\D+/g,""),f=document.createElement("div");f.className="voxels-industry-search-column clickable",f.innerHTML=`${u} ${L} ${p}`,f.addEventListener("click",(e=>{const t=document.querySelector(nodeNames.land_input);t&&(e.stopPropagation(),setNativeInputValue(t,L))}));const x=document.createElement("div");x.className="voxels-industry-search-column",x.innerHTML=`${e.available}/${e.total} ${h}`,c.innerHTML="",c.appendChild(f),c.appendChild(x);const S=document.createElement("div");if(S.classList.add("voxels-industry-search-column","voxels-industry-search-boosts"),e.boosts&&e.boosts.length>0){[...e.boosts].sort().forEach((e=>{const t=e.replace(/^ent_/,"itm_"),s=document.createElement("img");s.src=getImageForItem(t),s.classList.add("voxels-industry-search-icon"),S.appendChild(s)}))}c.appendChild(S),c.appendChild(y),c.addEventListener("click",(()=>{const t=n.querySelector(".voxels-industry-search-details");if(t)t.remove();else{const t=document.createElement("div");function s(){t.innerHTML=e.finishing.map((e=>{const t=e>Date.now()?formatTime((e-Date.now())/1e3):"Ready";return`<div class="voxels-industry-search-detail-row"><img src="${o}" class="voxels-industry-search-icon"> ${t}</div>`})).join(""),e.finishing.every((e=>e<=Date.now()))&&clearInterval(a)}t.classList.add("voxels-industry-search-details");const a=setInterval(s,1e3);s(),n.appendChild(t)}})),n.appendChild(c),d.appendChild(n)})),n.appendChild(d)}function formatTime(e){const t=Math.floor(e/3600),s=Math.floor(e%3600/60);let n="";return t>0&&(n+=`${t}h `),s>0&&(n+=`${s}m `),n+=`${Math.floor(e%60)}s`,n.trim()}