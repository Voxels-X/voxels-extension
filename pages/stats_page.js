let statsData=[];function loadStats(){return new Promise((async(e,t)=>{const a={operation:"getPlayerStats"};loadingScreen(1);try{const s=await makeFetchRequestByPID(apiURL,a);handleErrors(s)||("logout"==s?(initiate(),t("User logged out")):(loadingScreen(0),statsData=s.data,chrome.storage.local.set({stats:s.data.stats,statsLeaderboard:s.data.leaderboard,statsMinimumLevel:s.data.minimumLevel}),e()))}catch(e){t(e)}}))}async function loadStatsPage(e=!0){e&&await loadStats(),reloadOverlay();const t=document.querySelector(".voxels-main"),a=await loadStatsMain();t.appendChild(a);const s=loadStatsTasks();t.appendChild(s);const n=loadGraphStats();t.appendChild(n)}function loadStatsMain(){return new Promise((e=>{chrome.storage.local.get("stats",(function(t){const a=t.stats,s=a.per_day,n=a.skill_data||{},l=a.extra;var d=document.createElement("div");d.classList.add("voxels-stats-container");var i=document.createElement("div");i.classList.add("voxels-stats-header");const o=document.createElement("div");o.classList.add("voxels-stats-name","clickable");const c=document.createElement("span");c.textContent=l.username;const r=document.createElement("img");r.src=chrome.runtime.getURL("/images/icons/icon__player.svg"),r.alt="Icon",r.classList.add("voxels-stats-icon"),o.appendChild(c),o.appendChild(r),o.addEventListener("click",(function(){loadPlayerPageTop(),loadPlayerPage(l.PID)})),i.appendChild(o);const p=document.createElement("div");p.classList.add("voxels-stats-pixels-container");const m=document.createElement("img");m.src=chrome.runtime.getURL("/images/Other/Pixel.png"),m.alt="Icon",m.classList.add("voxels-stats-pixels-icon"),p.appendChild(m);const u=document.createElement("div");u.classList.add("voxels-stats-pixels-wrapper");const v=document.createElement("div");v.classList.add("voxels-stats-pixels-top"),v.innerHTML="PIXEL",u.appendChild(v);const h=document.createElement("div");h.classList.add("voxels-stats-pixels-bottom"),h.innerHTML=`$${parseFloat(l.conversion).toFixed(4)}`,u.appendChild(h),p.appendChild(u);const x=document.createElement("div");x.classList.add("voxels-stats-pixels-wrapper","right-align");const g=document.createElement("div");g.classList.add("voxels-stats-pixels-top"),g.innerHTML=parseFloat(l.pixels).toFixed(2),x.appendChild(g);const L=document.createElement("div");L.classList.add("voxels-stats-pixels-bottom"),L.innerHTML=`$${parseFloat(l.total_value_usd).toFixed(2)}`,x.appendChild(L),p.appendChild(x),i.appendChild(p),d.appendChild(i);const C=document.createElement("div");C.classList.add("voxels-inner-container");const _=document.createElement("div");_.classList.add("voxels-stats-row");const E=document.createElement("div");E.classList.add("voxels-stats-field");const k=l.level;if(E.innerHTML="Level: <span>"+k+"</span>",_.appendChild(E),"vip"in l){const e=document.createElement("div");e.classList.add("voxels-stats-field");new Date(l.vip);e.innerHTML="<span> | VIP </span>",_.appendChild(e)}if("lands"in l){const e=document.createElement("div");e.classList.add("voxels-stats-field");const t=l.lands,a=document.createElement("span");a.innerHTML=` | <span>${t}</span> `;const s=document.createElement("img");s.src=chrome.runtime.getURL("/images/pixels_icon.png"),s.alt="Land",e.appendChild(a),e.appendChild(s),_.appendChild(e)}const y=document.createElement("img");y.src=chrome.runtime.getURL("images/icons/icon__lb.svg"),y.alt="LB",y.classList.add("voxels-stats-field-icon","voxels-stats-basics-lb","clickable"),_.appendChild(y),y.addEventListener("click",(function(){premium?loadStatsLeaderboard():showPremiumPopup("stats_leaderboard")}));const f=document.createElement("img");f.src=chrome.runtime.getURL("images/icons/icon__stats.svg"),f.alt="LVL",f.classList.add("voxels-stats-field-icon","voxels-svg-invert","clickable"),_.appendChild(f),f.addEventListener("click",(function(){premium?loadMinimumLevels():showPremiumPopup("stats_levels")}));var b=document.createElement("img");b.classList.add("voxels-stats-field-icon","voxels-svg-invert","clickable"),b.src=chrome.runtime.getURL("/images/icons/icon__refresh.svg");const w=limiter(loadStatsPage,1e4);b.addEventListener("click",(function(){w()})),_.appendChild(b),C.appendChild(_);const $=parseFloat(l.conversion),P=statsCalculations(s,$),T=(new Date).toISOString().split("T")[0],S=P.find((e=>e.date===T))||{pixels_made:0,coins_total:0,c_p_ratio:0,tasks_done:0,pixel_tasks:0},M=parseFloat(S.pixels_made),I=S.coins_total,U=S.c_p_ratio.toFixed(2),R=S.tasks_done,F=S.pixel_tasks,H=document.createElement("div");H.classList.add("voxels-stats-row");const D=document.createElement("div");D.classList.add("voxels-stats-field");const[O,B,N]=T.split("-"),V=`${parseInt(N)}/${parseInt(B)}`,q=M*$,j=`<img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" alt="px">`;D.innerHTML=`Earnings <span>(${V})</span> - ${j}<span>${M.toFixed(2)}</span> = <span>$${q.toFixed(2)}</span>`,H.appendChild(D),C.appendChild(H);const G=document.createElement("div");G.classList.add("voxels-stats-row");const A=document.createElement("div");A.classList.add("voxels-stats-field");const J=`<img src="${chrome.runtime.getURL("images/Prices/coin.png")}" alt="coin">`;A.innerHTML=`Coins: ${J}<span>${I}</span>`,G.appendChild(A),C.appendChild(G);const z=document.createElement("div");z.classList.add("voxels-stats-row");const X=document.createElement("div");X.classList.add("voxels-stats-field");const Y=S.epm?.toFixed(2)||"0.00";X.innerHTML=`CPP: ${J}<span>${U}</span> - EPM: <span>$${Y}</span>`,z.appendChild(X),C.appendChild(z);const Z=document.createElement("div");Z.classList.add("voxels-stats-row");const W=document.createElement("div");W.classList.add("voxels-stats-field"),W.innerHTML=`Tasks done: <span>${R}</span> | Pixel tasks: <span>${F}</span>`,Z.appendChild(W),C.appendChild(Z);const K=a.skill_list,Q=document.createElement("div");Q.classList.add("voxels-stats-skill-container"),K.forEach((e=>{const t=document.createElement("div");t.classList.add("voxels-stats-skill-item");const a=document.createElement("div");a.classList.add("voxels-stats-skill-icon-wrapper");const s=document.createElement("img");s.classList.add("voxels-stats-skill-image"),s.src=`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${e}.png?v2`,a.appendChild(s);const l=n[e]||{},d=l.tasks_done??"-",i=l.xp??"-";if("number"==typeof d&&d>0){const e=document.createElement("div");e.classList.add("voxels-stats-skills-done"),e.innerHTML="x"+d,a.appendChild(e)}t.appendChild(a);const o=document.createElement("div");o.classList.add("voxels-stats-skill-info-wrapper");const c=document.createElement("div");c.classList.add("voxels-stats-skill-xp"),c.innerHTML=`${nFormatter(i,0)}<span class="voxels-superscript">${"-"!==i?"XP":""}</span>`,o.appendChild(c);const r=l.pixels??0;if("number"==typeof r&&r>0){const e=document.createElement("div");e.classList.add("voxels-stats-skill-pixels");const t=document.createElement("img");t.src=chrome.runtime.getURL("/images/Other/Pixel.png"),t.alt="px",t.classList.add("voxels-stats-pixels-icon-skill"),e.appendChild(t);const a=document.createElement("span");a.textContent=r,e.appendChild(a),o.appendChild(e)}t.appendChild(o),Q.appendChild(t)})),C.appendChild(Q),d.appendChild(C),e(d)}))}))}function loadGraphStats(e=null,t=null){const a=(e??statsData).stats.per_day;data=statsCalculations(a);const s=t?parseRangeToDays(t):6;var n=document.createElement("div");n.classList.add("voxels-stats-container","voxels-stats-container-graphs");var l=document.createElement("div");l.classList.add("voxels-stats-header");const d=document.createElement("div");d.classList.add("voxels-stats-title");const i=document.createElement("span");if(i.textContent="Graphs",d.appendChild(i),l.appendChild(d),n.appendChild(l),premium){const e=document.createElement("div");e.classList.add("voxels-stats-range-container");const t=limiter(updateGraphRange,4e3);let a="1w";["1w","6m","12m","24m"].forEach((s=>{const n=document.createElement("div");n.classList.add("clickable","voxels-stats-date-select"),n.textContent=s,n.dataset.range=s,s===a&&n.classList.add("selected-range"),n.addEventListener("click",(()=>{t(s)&&(e.querySelectorAll(".voxels-stats-date-select").forEach((e=>e.classList.remove("selected-range"))),n.classList.add("selected-range"),a=s)})),e.appendChild(n)})),l.appendChild(e)}const o=document.createElement("div");o.classList.add("voxels-inner-container","voxels-inner-container-graphs");const c=null!==t;function r(e,t,a){var s=document.createElement("div");s.classList.add("voxels-main-info"),o.appendChild(s);var n,l,d,i=(n=e,l=s,(d=document.createElement("canvas")).id=n,d.style.width="100%",d.style.maxWidth="600px",l.appendChild(d),d.getContext("2d"));new Chart(i,{type:"line",data:t,options:a})}var p={responsive:!0,interaction:{mode:"index",intersect:!1},stacked:!1,plugins:{title:{display:!1,text:"Earnings Chart",color:"white"},legend:{labels:{color:"white"}},tooltip:{titleColor:"white",bodyColor:"white",backgroundColor:"black"}},scales:{x:{grid:{color:e=>0===e.tick.value?"white":"transparent"},ticks:{color:"white"}},y:{beginAtZero:!0,grid:{color:e=>0===e.tick.value?"white":"rgba(255, 255, 255, 0.2)"},border:{dash:e=>0===e.tick.value?[]:[2,4]},ticks:{color:"white"}}}};function m(e,t){var a=[],n=t.map((t=>function(e,t,a,s,n,l,d=!1){var i={data:[],label:s,borderColor:n,backgroundColor:n,fill:!1,tension:.4,hidden:d};c&&(i.pointRadius=0);for(var o=a;o>=0;o--){var r=new Date;r.setUTCDate(r.getUTCDate()-o);var p=r.toISOString().split("T")[0],m=r.getUTCDate(),u=r.getUTCMonth()+1;const a=r.getUTCFullYear(),s=c?`${m}/${u}/${a}`:`${m}/${u}`;l.includes(s)||l.push(s);for(var v=!1,h=0;h<e.length;h++)if(e[h].date===p){v=!0,i.data.push(e[h][t]);break}v||i.data.push(0)}return i}(e,t.key,s,t.label,t.color,a,t.hidden)));return{labels:a,datasets:n}}c&&(p.plugins.zoom={zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x"}});r("chartCanvas1",m(data,[{key:"pixels_made",maxItems:6,label:"Pixels made",color:"#5ff600"}]),p);r("chartCanvas2",m(data,[{key:"coins_made",maxItems:6,label:"Coins made",color:"#e3ff36",hidden:!0},{key:"coins_spent",maxItems:6,label:"Coins spent",color:"#f75543",hidden:!0},{key:"coins_total",maxItems:6,label:"Coins total",color:"#f7af43",hidden:!0},{key:"c_p_ratio",maxItems:6,label:"Coins spent/Pixel",color:"#c2fa0a"}]),p);return r("chartCanvas3",m(data,[{key:"tasks_done",maxItems:6,label:"Tasks",color:"#0a0efa"},{key:"pixel_tasks",maxItems:6,label:"Pixel tasks",color:"#0afada",hidden:!0},{key:"t_p_ratio",maxItems:6,label:"Tasks/Pixel",color:"#0afa7a",hidden:!0},{key:"pixel_percentage",maxItems:6,label:"% Pixel tasks",color:"#7e0afa",hidden:!0},{key:"pixel_per_pixel_task",maxItems:6,label:"Pixel per Pixel task",color:"#198a2f",hidden:!0}]),p),n.appendChild(o),n}function parseRangeToDays(e){const t=new Date;let a=new Date;const s=/^(\d+)([wm])$/.exec(e);if(!s)return 7;const n=parseInt(s[1]),l=s[2];"w"===l?a.setUTCDate(t.getUTCDate()-7*n):"m"===l&&a.setUTCMonth(t.getUTCMonth()-n);const d=Math.abs(t-a);return Math.floor(d/864e5)+1}async function updateGraphRange(e){const t={operation:"getStatsRangeData",extra:e};loadingScreen(1);try{const a=await makeFetchRequestByPID(apiURL,t);handleErrors(a)||(loadingScreen(0),loadGraphRange(a,e))}catch(e){}}function loadGraphRange(e,t){const a=document.querySelector(".voxels-inner-container-graphs");a&&a.remove();const s=loadGraphStats({stats:{per_day:e.data}},t),n=document.querySelector(".voxels-stats-container-graphs");n&&n.appendChild(s.querySelector(".voxels-inner-container-graphs"))}function loadStatsTasks(){const e=statsData.stats.individual_tasks;var t=document.createElement("div");t.classList.add("voxels-stats-container");var a=document.createElement("div");a.classList.add("voxels-stats-header");const s=document.createElement("div");s.classList.add("voxels-stats-title");const n=document.createElement("span");n.textContent="Tasks",s.appendChild(n),a.appendChild(s),t.appendChild(a);const l=formatStats(e);let d={Basic:0,VIP:0,Landowner:0};Object.values(l).forEach((e=>{d.Basic+=(e.types.Basic||0)*parseFloat(e.reward_amount),d.VIP+=(e.types.VIP||0)*parseFloat(e.reward_amount),d.Landowner+=(e.types.Landowner||0)*parseFloat(e.reward_amount)}));const i=document.createElement("div");i.classList.add("voxels-inner-container");const o=document.createElement("div");o.classList.add("voxels-stats-tasks-section");const c=document.createElement("div");c.classList.add("voxels-stats-tasks-pixel-header");const r=chrome.runtime.getURL("/images/Other/Pixel.png"),p=chrome.runtime.getURL("/images/Other/vip_coupon.png"),m=chrome.runtime.getURL("/images/pixels_icon.png"),u=(e,t="pixel-image")=>{const a=document.createElement("img");return a.src=e,a.className=t,a},v=e=>{const t=displayNamesJSONArray.find((t=>t.display_name===e));return t?t.image:""},h=document.createElement("span");h.textContent="Basic:",h.appendChild(u(r)),h.appendChild(document.createTextNode(d.Basic.toFixed(0))),c.appendChild(h);const x=document.createElement("span");x.appendChild(u(p,"header-image")),x.appendChild(document.createTextNode(":")),x.appendChild(u(r)),x.appendChild(document.createTextNode(d.VIP.toFixed(0))),c.appendChild(x);const g=document.createElement("span");g.appendChild(u(m,"header-image header-pixels")),g.appendChild(document.createTextNode(":")),g.appendChild(u(r)),g.appendChild(document.createTextNode(d.Landowner.toFixed(0))),c.appendChild(g),o.appendChild(c);let L=document.createElement("table");L.classList.add("voxels-stats-tasks-table");let C=document.createElement("tr");C.innerHTML=`\n    <th>Item</th>\n    <th>Pixels</th>\n    <th>Basic</th>\n    <th><img src="${p}" class="header-image"></th>\n    <th><img src="${m}" class="header-image header-pixels"></th>\n`,L.appendChild(C),Object.values(l).forEach((e=>{let t=e.task_item,a=v(t),s=parseFloat(e.reward_amount).toString(),n=e.types.Basic||0,l=e.types.VIP||0,d=e.types.Landowner||0,i=document.createElement("tr");i.innerHTML=`\n        <td><img src="${a}" class="task-item-image"> <span>${t}</span></td>\n        <td><img src="${r}" class="pixel-image">${s}</td>\n        <td>${n}</td>\n        <td>${l}</td>\n        <td>${d}</td>\n    `,L.appendChild(i)})),o.appendChild(L),i.appendChild(o);let _={};e.forEach((e=>{const t=e.task_item;_[t]||(_[t]={task_item:e.task_item,total_delivered:0}),_[t].total_delivered+=e.quantity}));let E=Object.values(_).sort(((e,t)=>e.task_item.localeCompare(t.task_item))),k=document.createElement("div");k.classList.add("voxels-stats-tasks-section");let y=document.createElement("div");y.classList.add("voxels-stats-delivered-title-container");let f=document.createElement("div");f.classList.add("voxels-stats-delivered-title"),f.textContent="Delivered Items";let b=document.createElement("span");b.classList.add("voxels-stats-delivered-expand","clickable"),b.textContent="Expand",b.addEventListener("click",(()=>{const e="none"===window.getComputedStyle(w).display;w.style.display=e?"table":"none"})),y.appendChild(f),y.appendChild(b),k.appendChild(y);let w=document.createElement("table");w.classList.add("voxels-stats-tasks-table","voxels-stats-tasks-delivered");let $=document.createElement("tr");return $.innerHTML="\n    <th>Item</th>\n    <th>Total Delivered</th>\n",w.appendChild($),E.forEach((e=>{let t=e.task_item,a=v(t),s=nFormatter(parseFloat(e.total_delivered).toString(),2),n=document.createElement("tr");n.innerHTML=`\n        <td><img src="${a}" class="task-item-image"> <span>${t}</span></td>\n        <td>${s}</td>\n    `,w.appendChild(n)})),k.appendChild(w),i.appendChild(k),t.appendChild(i),t}function formatStats(e){const t={0:"Basic",1:"VIP",2:"Landowner"},a={};return e.sort(((e,t)=>e.reward_type!==t.reward_type?e.reward_type.localeCompare(t.reward_type):parseFloat(e.reward_amount)!==parseFloat(t.reward_amount)?parseFloat(t.reward_amount)-parseFloat(e.reward_amount):e.task_item!==t.task_item?e.task_item.localeCompare(t.task_item):e.type-t.type)),e.forEach((e=>{if("pixels"===e.reward_type){const s=`${e.task_item}_${e.reward_amount}`;a[s]||(a[s]={task_item:e.task_item,reward_amount:e.reward_amount,types:{}});const n=t[e.type];a[s].types[n]||(a[s].types[n]=0),a[s].types[n]++}})),a}function loadStatsLeaderboard(){const e=document.querySelector(".voxels-main");e.innerHTML="";const t=document.createElement("div");t.classList.add("voxels-ms-leaderboard-container");const a=document.createElement("div");a.classList.add("voxels-ms-leaderboard-topbar");const s=document.createElement("img");s.src=chrome.runtime.getURL("images/icons/icon__back-arrow.svg"),s.alt="Back",s.classList.add("voxels-ms-back-icon","clickable"),s.addEventListener("click",(function(){e.innerHTML="",loadStatsPage(!1)}));const n=document.createElement("div"),l=(new Date).toLocaleDateString(void 0,{timeZone:"UTC"});n.textContent=`Leaderboard - ${l}`,n.classList.add("voxels-ms-leaderboard-title"),a.appendChild(s),a.appendChild(n),t.appendChild(a);const d=statsData.leaderboard.day,i=parseFloat(statsData.stats.extra.conversion),o=chrome.runtime.getURL("images/Other/Pixel.png"),c=chrome.runtime.getURL("images/Other/vip_coupon.png"),r=chrome.runtime.getURL("images/pixels_icon.png"),p=(e,t="pixel-image")=>{const a=document.createElement("img");return a.src=e,a.className=t,a};if(d&&0!==d.length){const e=document.createElement("div");e.classList.add("voxels-ms-leaderboard-list"),d.forEach(((t,a)=>{const s=document.createElement("div");s.classList.add("voxels-ms-leaderboard-row","clickable");const n=document.createElement("div");n.classList.add("voxels-ms-leaderboard-column","voxels-text-color-main"),n.textContent=`${a+1}.`,s.appendChild(n);const l=document.createElement("div");l.classList.add("voxels-ms-leaderboard-column","voxels-ms-leaderboard-username"),l.textContent=t.username,t.username===username&&l.classList.add("voxels-text-color-main"),s.appendChild(l);const d=document.createElement("div");d.classList.add("voxels-ms-leaderboard-column","voxels-ms-leaderboard-pixels");const m=document.createElement("img");m.src=chrome.runtime.getURL("images/Other/Pixel.png"),m.classList.add("voxels-leaderboard-pixels-icon"),d.appendChild(m),d.append(`${t.pixels_made.toLocaleString()}`),s.appendChild(d);const u=document.createElement("div");u.classList.add("voxels-ms-details-container"),u.style.display="none";const v=document.createElement("div");v.classList.add("voxels-details-row");const h=document.createElement("div");h.classList.add("voxels-details-level");const x=document.createElement("div");x.classList.add("voxels-playerpage-skill-level"),x.innerHTML="<span class='voxels-playerpage-levelicon-prefix'>Lvl</span>"+t.level,h.appendChild(x),v.appendChild(h);const g=document.createElement("div");g.classList.add("voxels-details-lands"),g.innerHTML=" "+t.lands;const L=document.createElement("img");L.src=chrome.runtime.getURL("images/pixels_icon.png"),g.prepend(L),v.appendChild(g);const C=document.createElement("div");C.classList.add("voxels-details-vip"),t.vip&&C.classList.add("js-completed"),C.innerHTML="VIP&nbsp;";const _=document.createElement("img");_.src=t.vip?chrome.runtime.getURL("images/icons/icon__task.svg"):chrome.runtime.getURL("images/icons/icon__xmark.svg"),C.appendChild(_),v.appendChild(C),u.appendChild(v);const E=document.createElement("div");E.classList.add("voxels-ms-details-row"),E.innerHTML=`Deliveries: <span class="voxels-details-calc-number">${t.tasks_done}</span>`,u.appendChild(E);const k=document.createElement("div");k.classList.add("voxels-ms-details-row"),k.innerHTML=`Coins Spent: <span class="voxels-details-calc-number">${t.coins_spent.toLocaleString()}</span>`,u.appendChild(k);const y=t.pixels_made>0?t.coins_spent/t.pixels_made:0,f=y>0?1e6/y*i:0,b=document.createElement("div");b.classList.add("voxels-ms-details-row"),b.innerHTML=`\n    CPP: <span class="voxels-details-calc-number">${y.toFixed(2)}</span>\n    &nbsp;|&nbsp;\n    EPM: <span class="voxels-details-calc-number">$${f.toFixed(2)}</span>\n`,u.appendChild(b);const w=document.createElement("div");w.classList.add("voxels-ms-details-row","voxels-stats-leaderboard-types");const $=document.createElement("span");$.appendChild(document.createTextNode("Basic: ")),$.appendChild(p(o)),$.appendChild(document.createTextNode(` ${t.pixels_type_0}`)),w.appendChild($);const P=document.createElement("span");P.appendChild(p(c,"header-image")),P.appendChild(document.createTextNode(": ")),P.appendChild(p(o)),P.appendChild(document.createTextNode(` ${t.pixels_type_1}`)),w.appendChild(P);const T=document.createElement("span");T.appendChild(p(r,"header-image header-pixels")),T.appendChild(document.createTextNode(": ")),T.appendChild(p(o)),T.appendChild(document.createTextNode(` ${t.pixels_type_2}`)),w.appendChild(T),u.appendChild(w);const S=document.createElement("div");S.classList.add("voxels-ms-details-row","voxels-details-button");const M=document.createElement("button");M.textContent="Profile page",M.addEventListener("click",(function(){loadPlayerPageTop(),loadPlayerPage(t.pid)})),S.appendChild(M),u.appendChild(S),s.addEventListener("click",(()=>{u.style.display="none"===u.style.display?"flex":"none"})),e.appendChild(s),e.appendChild(u)})),t.appendChild(e)}else{const e=document.createElement("div");e.textContent="Please wait for first stats.",e.classList.add("voxels-ms-no-data"),t.appendChild(e)}e.appendChild(t)}function loadMinimumLevels(){const e=statsData.minimumLevel,t=statsData.stats.extra.levels,a=document.querySelector(".voxels-main");a.innerHTML="";const s=document.createElement("div");s.classList.add("voxels-ms-leaderboard-container");const n=document.createElement("div");n.classList.add("voxels-ms-leaderboard-topbar");const l=document.createElement("img");l.src=chrome.runtime.getURL("images/icons/icon__back-arrow.svg"),l.alt="Back",l.classList.add("voxels-ms-back-icon","clickable"),l.addEventListener("click",(function(){a.innerHTML="",loadStatsPage(!1)})),n.appendChild(l);const d=document.createElement("div");d.classList.add("voxels-stats-min-skill-icon-wrapper");for(const t of Object.keys(e)){const e=document.createElement("img");e.src=`https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${t}.png?v2`,e.alt=t,e.classList.add("voxels-stats-min-skill-icon","clickable"),e.title=t,e.addEventListener("click",(()=>{const e=document.getElementById(`minlevel-section-${t}`);e&&e.scrollIntoView({behavior:"smooth"})})),d.appendChild(e)}if(n.appendChild(d),s.appendChild(n),e&&0!==e.length)appendMinimumLevelsToPage(s,e,t);else{const e=document.createElement("div");e.textContent="Please wait for task stats.",e.classList.add("voxels-ms-no-data"),s.appendChild(e)}a.appendChild(s)}function appendMinimumLevelsToPage(e,t,a){for(const[s,n]of Object.entries(t)){const t=Object.entries(n).map((([e,t])=>Object.entries(t).map((([t,a])=>({item:e,reward:parseFloat(t),types:{Basic:a[0]?a[0].level:null,VIP:a[1]?a[1].level:null,Landowner:a[2]?a[2].level:null}}))))).flat().sort(((e,t)=>t.reward===e.reward?t.types.Basic-e.types.Basic:t.reward-e.reward));let l=document.createElement("div");l.classList.add("voxels-stats-tasks-section","voxels-stats-skill-section"),l.id=`minlevel-section-${s}`;const d=e=>{const t=displayNamesJSONArray.find((t=>t.display_name===e));return t?t.image:""};let i=void 0!==a[s]?a[s]:"N/A",o=document.createElement("div");o.classList.add("voxels-stats-tasks-section-title"),o.innerHTML=`<img src="https://d31ss916pli4td.cloudfront.net/game/ui/skills/skills_icon_${s}.png?v2">&nbsp;${s.charAt(0).toUpperCase()+s.slice(1)} (Level ${i})`,l.appendChild(o);let c=document.createElement("table");c.classList.add("voxels-stats-skill-table");let r=document.createElement("tr");r.innerHTML=`\n            <th>Item</th>\n            <th>Pixels</th>\n            <th>Basic</th>\n            <th><img src="${chrome.runtime.getURL("/images/Other/vip_coupon.png")}" class="header-image"></th>\n            <th><img src="${chrome.runtime.getURL("/images/pixels_icon.png")}" class="header-image header-pixels"></th>\n        `,c.appendChild(r),t.forEach((e=>{let t=d(e.item),a=null!==e.types.Basic&&i>=e.types.Basic?"voxels-stats-level-reached":"",s=null!==e.types.VIP&&i>=e.types.VIP?"voxels-stats-level-reached":"",n=null!==e.types.Landowner&&i>=e.types.Landowner?"voxels-stats-level-reached":"",l=document.createElement("tr");l.innerHTML=`\n                <td><img src="${t}" class="task-item-image"> <span>${e.item}</span></td>\n                <td><img src="${chrome.runtime.getURL("/images/Other/Pixel.png")}" class="pixel-image">${e.reward}</td>\n                <td class="${a}">${null!==e.types.Basic?e.types.Basic:"-"}</td>\n                <td class="${s}">${null!==e.types.VIP?e.types.VIP:"-"}</td>\n                <td class="${n}">${null!==e.types.Landowner?e.types.Landowner:"-"}</td>\n            `,c.appendChild(l)})),l.appendChild(c),e.appendChild(l)}}function userOptout(e){voxelsConfirm("If you continue you won't be able to participate in this Voxels Season or the Leaderboard. Opt out?",(function(t){t&&chrome.storage.local.get("user_info",(async function(t){const a={name:t.user_info,operation:"leaderboardOptout",extra:e};loadingScreen(1);try{const e=await makeFetchRequest(apiURL,a);handleErrors(e)||("logout"==e?initiate():(loadingScreen(0),refreshStats(),quickMessage("You have opted out of Voxels Seasons & the leaderboard.","news")))}catch(e){}}))}))}function statsCalculations(e,t=0){const a=JSON.parse(JSON.stringify(e)),s=(new Date).toISOString().slice(0,10);return a.some((e=>e.date===s))||a.push({date:s,pixels_made:0,coins_made:0,coins_spent:0,tasks_done:0,pixel_tasks:0,coins_total:0,c_p_ratio:0,t_p_ratio:0,pixel_percentage:0,normal_tasks:0,pixel_per_pixel_task:0,epm:0}),a.forEach((e=>{const{pixels_made:a,coins_made:s,coins_spent:n,tasks_done:l,pixel_tasks:d}=e,i=n-s;e.coins_spent*=-1,e.coins_total=-1*i,e.c_p_ratio=a>0?i/a:0,e.t_p_ratio=a>0?l/a:0,e.pixel_percentage=l>0?d/l*100:0,e.pixel_per_pixel_task=d>0?a/d:0,e.normal_tasks=l-d,e.epm=e.c_p_ratio>0?1e6/e.c_p_ratio*t:0})),a}function clearStatsPage(){document.querySelector(".voxels-stats-page").innerHTML=""}