let colorTimerStarted=!1,currentEnergy=1e3;function loadTimers(e){e?getUserData().then((e=>{handleErrors(e)||(loadFarmPage(e),premium&&setInterval(checkTimers,1e4))})).catch((e=>{})):chrome.storage.local.get("timer_data",(function(e){loadFarmPage(e.timer_data)}))}function loadFarmPage(e){const t=document.querySelector(".voxels-main");t.appendChild(addContent(e)).classList.add("active");const a=Object.keys(e).length;a<51&&(a>2?premium&&addNewButton():addNewButton()),colorTimerStarted||(colorTimerStarted=!0,setInterval((()=>{setTimersBG()}),2e3)),t.appendChild(loadHelp())}function addContent(e){var t=document.createElement("div");return t.classList.add("voxels-main-page"),loadFilterTimers(t),loadFarms(t,e),t}function loadFilterTimers(e){var t=document.createElement("div");t.classList.add("voxels-filter-container");var a=document.createElement("input");a.setAttribute("type","text"),a.setAttribute("placeholder","Filter timers..."),a.classList.add("voxels-filter-input"),t.appendChild(a);var r=document.createElement("div");r.classList.add("voxels-filter-dropdown-container");var n=document.createElement("button");n.classList.add("voxels-filter-dropdown-button","clickable");var o=document.createElement("img");o.src=chrome.runtime.getURL("images/icons/icon__filter.svg"),n.appendChild(o),r.appendChild(n);var i=document.createElement("div");i.classList.add("voxels-filter-dropdown-content"),i.style.display="none",r.appendChild(i);const c=["coop","apiary","hutch","mine","tree","stump","custom","nucyber_chip","nucyber_box","grumpkin","candy","post","sauna","cow","mill","kiln","winery","woodworking","textile_mill","barneys_barnbq","submarine_sizzler","galactic_grill","bluzzleberry","orange_grumpkin","blue_grumpkin","butterberry","clover","grainbow","javabean","watermint","scarrot","astracactus","hotato","muckchuck"];function s(){const t=a.value.toLowerCase(),r=Array.from(i.querySelectorAll('input[type="checkbox"]:checked')).map((e=>e.dataset.farmType));e.querySelectorAll(".voxels-main-grid").forEach((e=>{const a=e.querySelector(".voxels-main-title-text").textContent.toLowerCase(),n=Array.from(e.querySelectorAll(".voxels-main-farm-cell")),o=0===r.length||n.some((e=>r.some((t=>e.classList.contains("voxels-type-"+t))))),i=""===t||a.includes(t);e.style.display=i&&o?"":"none"}))}c.forEach((e=>{var t=document.createElement("label"),a=document.createElement("input");a.setAttribute("type","checkbox"),a.dataset.farmType=e;var r=document.createElement("img");r.src=chrome.runtime.getURL("images/Farms/voxels_"+e+".png"),r.alt=e+" image",r.classList.add("voxels-filter-farm-icon"),t.appendChild(a),t.appendChild(r),i.appendChild(t)})),n.onclick=function(){i.style.display="none"===i.style.display?"flex":"none"},t.appendChild(r),e.appendChild(t),a.addEventListener("keydown",(function(e){setTimeout(s,10),e.stopPropagation()})),c.forEach((e=>{i.querySelector(`input[data-farm-type="${e}"]`).addEventListener("change",s)}))}function loadFarms(e,t){let a={Farms:["coop","apiary","hutch","mine"],Industries:["mill","kiln","winery","woodworking","textile_mill","barneys_barnbq","submarine_sizzler","galactic_grill"],Trees:["tree","stump"],Other:[],Crops:["bluzzleberry","orange_grumpkin","blue_grumpkin","butterberry","clover","grainbow","javabean","watermint","scarrot","astracactus","hotato","muckchuck"]};function r(e,t){var a=document.createElement("div");a.classList.add("voxels-main-farm-icon");var r=document.createElement("img");r.classList.add("voxels-main-farm-image"),r.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+e+".png",r.alt=e+" Image";var n=document.createElement("div");return n.classList.add("plus-icon"),n.textContent="+",a.appendChild(r),a.appendChild(n),a.addEventListener("click",(function(){addFarm(t,e)})),a}for(const[s,l]of Object.entries(t)){let t=s.charAt(0).toUpperCase()+s.slice(1);var n=document.createElement("div");n.classList.add("voxels-main-grid"),n.classList.add("voxels-farm-"+s);var o=document.createElement("div");o.classList.add("voxels-main-title-text"),o.textContent=t,n.appendChild(o);let m=[];m="NuCyber"==s?["nucyber_chip","nucyber_box","custom"]:"terravilla"==s?["winery","mill","kiln","textile_mill","woodworking","tree","stump","coop","apiary","hutch","mine","bluzzleberry","orange_grumpkin","blue_grumpkin","butterberry","clover","grainbow","javabean","scarrot","cow","custom"]:"collect"==s?["grumpkin","candy","post","sauna","custom"]:["mill","winery","kiln","textile_mill","woodworking","barneys_barnbq","submarine_sizzler","galactic_grill","tree","stump","coop","apiary","hutch","mine","blue_grumpkin","butterberry","clover","grainbow","javabean","watermint","scarrot","astracactus","hotato","muckchuck","custom"];let d=document.createElement("div");d.classList.add("voxels-farm-dropdown-container");let u=document.createElement("button");u.classList.add("voxels-farm-dropdown-button","clickable"),u.textContent="Add timer",d.appendChild(u);let p=document.createElement("div");p.classList.add("voxels-farm-dropdown-content"),p.style.display="none";let h={};m.forEach((e=>{let t=Object.keys(a).find((t=>a[t].includes(e)));if(t||(t="Other",a.Other.push(e)),!h[t]){let e=document.createElement("div");e.classList.add("voxels-farm-section","voxels-farm-section-"+t.toLowerCase());let a=document.createElement("div");a.textContent=t,a.classList.add("voxels-farm-section-title"),e.appendChild(a),p.appendChild(e),h[t]=e}})),m.forEach((e=>{let t=Object.keys(a).find((t=>a[t].includes(e)))||"Other",n=h[t],o=r(e,s);n.appendChild(o)})),u.onclick=function(){p.style.display="none"===p.style.display?"flex":"none"},d.appendChild(p),n.appendChild(d);var i=document.createElement("div");i.classList.add("voxels-main-remove");var c=document.createElement("div");c.classList.add("voxels-remove-icon"),c.textContent="X",i.addEventListener("click",(function(){removeLocation(s)})),i.appendChild(c),n.appendChild(i),loadFarmTypes(s,n,l),e.appendChild(n)}}function loadFarmTypes(e,t,a){let r=!1;for(const[s,l]of Object.entries(a)){var n=document.createElement("div");n.classList.add("voxels-main-farm-cell"),n.classList.add("voxels-type-"+s);var o=document.createElement("div");o.classList.add("voxels-remove-farm-icon"),o.textContent="âˆ’",o.addEventListener("click",(function(){removeFarm(e,s)})),n.appendChild(o);var i=document.createElement("img");i.classList.add("voxels-main-farm-image"),i.src=chrome.runtime.getURL("images")+"/Farms/voxels_"+s+".png",i.alt="Image",n.appendChild(i);var c=createTimer(l);c.addEventListener("click",(function(){startTimer(e,s)})),"Start"!==c.textContent&&(r=!0),n.appendChild(c),t.appendChild(n)}1==r&&t.classList.add("voxels-main-grid-active")}function handleResult(e){handleErrors(e)||("logout"==e?initiate():(reloadOverlay(),loadTitleSection("timers"),chrome.storage.local.set({timer_data:e.data}),timersArray=e.data,loadTimers(0)))}function updateFarm(e,t,a,r){if("logout"==e)initiate();else{let e;switch(a){case"custom":case"mill":case"kiln":case"winery":case"woodworking":case"textile_mill":case"barneys_barnbq":case"submarine_sizzler":case"galactic_grill":case"blue_grumpkin":case"orange_grumpkin":e=Math.floor(Date.now()/1e3)+60*r;break;case"butterberry":e=Math.floor(Date.now()/1e3)+1200;break;case"apiary":case"clover":e=Math.floor(Date.now()/1e3)+2700;break;case"hutch":case"coop":case"grainbow":case"muckchuck":e=Math.floor(Date.now()/1e3)+3600;break;case"cow":e=Math.floor(Date.now()/1e3)+4800;break;case"mine":e=Math.floor(Date.now()/1e3)+5400;break;case"nucyber_box":case"nucyber_chip":case"watermint":case"bluzzleberry":e=Math.floor(Date.now()/1e3)+14400;break;case"javabean":case"hotato":e=Math.floor(Date.now()/1e3)+18e3;break;case"scarrot":e=Math.floor(Date.now()/1e3)+21600;break;case"astracactus":e=Math.floor(Date.now()/1e3)+25200;break;case"stump":e="terravilla"==t?Math.floor(Date.now()/1e3)+18e3:Math.floor(Date.now()/1e3)+9e3;break;case"tree":e="terravilla"==t?Math.floor(Date.now()/1e3)+52200:Math.floor(Date.now()/1e3)+26100;break;case"sauna":e=Math.floor(Date.now()/1e3)+28800;break;case"grumpkin":case"candy":case"post":e=Math.floor(Date.now()/1e3)+86400;break;default:return}const n=createTimer(e);n.addEventListener("click",(function(){startTimer(t,a)}));let o=`.voxels-farm-${t} .voxels-main-farm-cell.voxels-type-${a}`,i=document.querySelector(o);const c=`.voxels-farm-${t}`,s=document.querySelector(c);if(s.classList.add("voxels-main-grid-active"),i){const e=i.querySelector(".voxels-main-timer");e&&i.removeChild(e),i.appendChild(n)}else{const e=Math.floor((new Date).getTime()/1e3);loadFarmTypes(t,s,{[a]:e}),o=`.voxels-farm-${t} .voxels-main-farm-cell.voxels-type-${a}`,i=document.querySelector(o);const r=i.querySelector(".voxels-main-timer");r&&i.removeChild(r),i.appendChild(n)}}}function removeLocation(e){chrome.storage.local.get("user_info",(async function(t){const a={name:t.user_info,operation:"removeLocation",extra:e};try{handleResult(await makeFetchRequest(apiURL,a))}catch(e){}}))}function addFarm(e,t){chrome.storage.local.get("user_info",(async function(a){const r={name:a.user_info,operation:"addFarm",extra:{[e]:t}};try{const a=await makeFetchRequest(apiURL,r);if(!handleErrors(a))if("logout"==a)initiate();else{const r=`.voxels-farm-${e}`,n=document.querySelector(r),o=Math.floor((new Date).getTime()/1e3),i={[t]:o};chrome.storage.local.set({timer_data:a.data}),timersArray=a.data,loadFarmTypes(e,n,i)}}catch(e){}}))}function removeFarm(e,t){chrome.storage.local.get("user_info",(async function(a){const r={name:a.user_info,operation:"removeFarm",extra:{[e]:t}};try{const a=await makeFetchRequest(apiURL,r);if(!handleErrors(a))if("logout"==a)initiate();else{const r=`.voxels-farm-${e} .voxels-main-farm-cell.voxels-type-${t}`,n=document.querySelector(r);chrome.storage.local.set({timer_data:a.data}),timersArray=a.data,n.remove()}}catch(e){}}))}function startTimer(e,t){chrome.storage.local.get("user_info",(async function(a){const r=a.user_info;if(["custom","mill","kiln","winery","woodworking","textile_mill","barneys_barnbq","submarine_sizzler","galactic_grill","blue_grumpkin","orange_grumpkin"].includes(t))inputWithCallback("Custom time in minutes:",(function(a){if(/^\d+$/.test(a)&&parseInt(a)<=2880){const n={name:r,operation:"startTimer",extra:{[e]:t,time:parseInt(a)}};makeFetchRequest(apiURL,n).then((r=>{handleErrors(r)||("logout"==r?initiate():(updateFarm(r,e,t,a),chrome.storage.local.set({timer_data:r.data}),timersArray=r.data))})).catch((e=>{}))}else showAlert("Please enter a valid time in minutes (not exceeding 48 hours).","error")}));else{const a={name:r,operation:"startTimer",extra:{[e]:t}};try{const r=await makeFetchRequest(apiURL,a);handleErrors(r)||("logout"==r?initiate():(updateFarm(r,e,t,0),chrome.storage.local.set({timer_data:r.data}),timersArray=r.data))}catch(e){}}}))}function startTimerType(e){chrome.storage.local.get("user_info",(async function(t){let a="";const r={name:t.user_info,operation:"updateTimer",extra:{[a]:e}};try{const t=await makeFetchRequest(apiURL,r);handleErrors(t)||("logout"==t?initiate():(chrome.storage.local.set({timer_data:t.data.timer_data}),timersArray=t.data.timer_data,a=t.data.location,"timers"===currentActiveTab&&updateFarm(t,a,e,0)))}catch(e){}}))}function checkEnergyChange(){const e=nodeNames.energyText,t=document.querySelector(e);if(t){const e=t.textContent.trim().replace(/,/g,""),a=parseFloat(e);if(currentEnergy!==a){const e=a-currentEnergy;currentEnergy=a,e>450&&startTimer("collect","sauna")}}}function addNewButton(){const e=document.querySelector(".voxels-main");var t=document.createElement("div");t.classList.add("voxels-main-button"),e.appendChild(t);var a=document.createElement("div");a.classList.add("voxels-main-button-text"),a.textContent="Add current location...",t.appendChild(a),t.addEventListener("click",addButtonClick)}async function addButtonClick(){try{handleResult(await requestNewLocation())}catch(e){}}async function requestNewLocation(){return new Promise(((e,t)=>{chrome.storage.local.get("user_info",(async function(a){const r={name:a.user_info,operation:"add"};try{const t=await makeFetchRequest(apiURL,r);if("error"in t.data)e(t);else{const a=t.data;e(a.online?a:{error:"Error 1061"})}}catch(e){t(e)}}))}))}function createTimer(e){var t=document.createElement("div");function a(){const a=calculateTimeRemaining(e),n=formatTimeRemaining(a);t.textContent=n,a<=0?(clearInterval(r),t.textContent="Start",t.style.backgroundColor="green",t.classList.remove("timer-running")):(t.style.backgroundColor="#2c2c2c",t.classList.contains("timer-running")||t.classList.add("timer-running"))}t.classList.add("voxels-main-timer"),a();var r=setInterval(a,1e3);return t}function calculateTimeRemaining(e){const t=Math.floor(Date.now()/1e3);return Math.max(0,e-t)}function formatTimeRemaining(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=e%60;return`${padZero(t)}:${padZero(a)}:${padZero(r)}`}function padZero(e){return e<10?`0${e}`:`${e}`}function setTimersBG(){document.querySelectorAll(".voxels-main-grid").forEach((e=>{const t=e.querySelector(".timer-running");t&&!e.classList.contains("voxels-main-grid-active")?e.classList.add("voxels-main-grid-active"):!t&&e.classList.contains("voxels-main-grid-active")&&e.classList.remove("voxels-main-grid-active")}))}function checkTimers(){if(notifications){const e=Math.floor(Date.now()/1e3);Object.entries(timersArray).forEach((([t,a])=>{Object.entries(a).forEach((([a,r])=>{if(r-e>=30&&r-e<=39){setTimeout((()=>{chrome.runtime.sendMessage({message:"show_notification",farmName:a,location:t,username:username})}),1e3*(r-e-30))}}))}))}}