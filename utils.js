async function makeFetchRequest(e,t,o="POST"){try{const{userStatus:n,user_acde:a}=await new Promise((e=>{chrome.storage.local.get(["userStatus","user_acde"],(function(t){e(t)}))}));if(!n||!a)return chrome.storage.local.clear((function(){})),"logout";t.user_acde=a,t.version=version;const s=await fetch(e,{method:o,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)});if(200!==s.status)throw new Error("fail");return await s.json()}catch(e){throw e}}async function makeFetchRequestByPID(e,t,o="POST"){try{const{pid:n,user_acde:a}=await new Promise((e=>{chrome.storage.local.get(["pid","user_acde"],(function(t){e(t)}))}));if(!n||!a)return chrome.storage.local.clear((function(){})),"logout";t.user_acde=a,t.version=version,t.pid||(t.pid=n);const s=await fetch(e,{method:o,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(t)});if(200!==s.status)throw new Error("fail");return await s.json()}catch(e){throw e}}async function makeRequestToTools(e,t="POST"){try{const{pid:o,user_acde:n}=await new Promise((e=>{chrome.storage.local.get(["pid","user_acde"],(function(t){e(t)}))}));if(!o||!n)return chrome.storage.local.clear((function(){})),"logout";e.user_acde=n,e.version=version;const a=await fetch(toolsURL,{method:t,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(e)});if(200!==a.status)throw new Error("fail");return await a.json()}catch(e){throw e}}function debugLog(e){}function handleErrors(e){if(e&&e.data&&e.data.error){switch(e.data.error){case"2001":showAlert("You've already added this location","error");break;case"2003":showAlert("You have to be ingame to add locations.","error");break;case"2006":showAlert("Currently only terravilla and farms can be added. More coming soon!","error");break;case"2007":break;case"2008":showAlert("This farm already exists at this location.","error");break;case"3006":showAlert("You have reached the maximum number of farms.","error");break;case"4006":showAlert("You have reached the maximum number of storages.","error");break;case"7001":showAlert("Too fast.","error");break;case"7002":showAlert("No new transaction found. Please retry in 10s","error");break;case"8001":displayInfo({title:"Update!",rows:[{text:"Voxels has received an update. Please reload this page."}]});break;case"8002":showAlert(e.data.text,"info");break;case"not_premium_playerpage":showPlayerPagePremium();break;case"Not_Premium":quickMessage("Only available for premium players.","error");break;default:quickMessage(e.data.error,"error")}return loadingScreen(0),loadingScreenFull(0),!0}return!1}function showAlert(e,t){var o=document.querySelector(".voxels-popup");o&&o.remove();var n=document.createElement("div");switch(n.className="voxels-popup",t){case"error":n.innerHTML+="<h3>Voxels Error:</h3><p>"+e+"</p>";break;case"info":n.innerHTML+="<h3>Voxels:</h3><p>"+e+"</p>",n.classList.add("voxels-popup-info");break;case"success":n.innerHTML+="<h3>Voxels:</h3><p>"+e+"</p>",n.classList.add("voxels-popup-success");break;default:n.innerHTML+="<h3>Voxels:</h3><p>"+e+"</p>";break}var a=document.createElement("div");a.className="voxels-popup-close",a.innerHTML="X",n.appendChild(a),document.body.appendChild(n),a.addEventListener("click",(function(){n.remove()})),setTimeout((function(){n.style.opacity="0",setTimeout((function(){n.remove()}),1e3)}),5e3)}function quickMessage(e,t,o=3e3){"news"==t&&(o=6e3);var n=document.querySelector(".voxels-quick-message-popup");n&&n.remove();var a=document.createElement("div");a.className="voxels-quick-message-popup voxels-"+t,a.innerHTML='<p>Voxels:</p><p class="voxels-quick-info">'+e+'</p><div class="voxels-progress-bar"></div>',document.body.appendChild(a);var s=document.createElement("div");s.className="dismiss-pop-up clickable",s.innerText="X",a.appendChild(s),a.querySelector(".voxels-progress-bar").style.animation="voxels-progressBarAnimation "+o/1e3+"s linear forwards",s.addEventListener("click",(function(){a.remove()})),setTimeout((function(){a.style.animation="0.5s ease 0s 1 normal forwards running voxels-slideOut",setTimeout((function(){a.remove()}),500)}),o)}let dragEl,dragHandleEl,premiumFeatures=[{key:"ms_leaderboard",text:"View Merchant Ships leaderboards with Pixels earned, Coins spent, Contracts Delivered & more!",image:"images/Premium/Premium_MS.png"},{key:"stats_leaderboard",text:"View Taskboard leaderboards with Pixels earned, Coins spent, CPP, EPM & more!",image:"images/Premium/Premium_StatsLB.png"},{key:"stats_levels",text:"Get premium access to minimum levels required for any $PIXEL tasks available!",image:"images/Premium/Premium_StatsLevels.png"},{key:"search_boost",text:"Filter your industry search by land boosts, that increase industry and resource productivity and efficiency!",image:"images/Premium/Premium_SearchBoost.png"},{key:"search_filter",text:"Filter industry search by land types or soil states.",image:"images/Premium/Premium_SearchFilter.png"}];function showPremiumPopup(e,t=1e4){const o=premiumFeatures.find((t=>t.key===e));if(!o)return;const n=document.querySelector(".voxels-quick-message-popup");n&&n.remove();const a=document.createElement("div");a.className="voxels-quick-message-popup voxels-info voxels-premium-popup";const s=document.createElement("div");s.classList.add("voxels-premium-popup-title"),s.textContent="Voxels Premium Feature",a.appendChild(s);const r=document.createElement("div");if(r.classList.add("voxels-premium-popup-content"),o.image){const e=document.createElement("div");e.classList.add("voxels-premium-popup-image-wrapper");const t=document.createElement("img");t.classList.add("voxels-premium-popup-image"),o.image.startsWith("https")?t.src=o.image:t.src=chrome.runtime.getURL(o.image),e.appendChild(t),r.appendChild(e)}const i=document.createElement("div");i.classList.add("voxels-premium-popup-textbtn");const l=document.createElement("div");l.className="voxels-premium-popup-text",l.textContent=o.text,i.appendChild(l);const c=document.createElement("button");c.classList.add("voxels-premium-popup-btn","clickable"),c.textContent="Get Premium",c.onclick=function(){changeTab("premium"),a.remove()},i.appendChild(c),r.appendChild(i),a.appendChild(r);const d=document.createElement("div");d.className="voxels-progress-bar",a.appendChild(d);const m=document.createElement("div");m.className="dismiss-pop-up clickable",m.innerText="X",m.addEventListener("click",(()=>a.remove())),a.appendChild(m),document.body.appendChild(a),d.style.animation=`voxels-progressBarAnimation ${t/1e3}s linear forwards`,setTimeout((function(){a.style.animation="0.5s ease 0s 1 normal forwards running voxels-slideOut",setTimeout((()=>a.remove()),500)}),t),a.style.animation="voxels-slideIn 0.5s forwards"}function convertArrayToObject(e){const t={};return e.forEach(((e,o)=>{t[o]=e})),t}function reloadVoxels(){var e=document.querySelector(".voxels-main-container");e&&e.parentNode.removeChild(e),startLoad()}function nFormatter(e,t){const o=e<0;e=Math.abs(e);const n=[{value:1,symbol:""},{value:1e3,symbol:"K"},{value:1e6,symbol:"M"},{value:1e9,symbol:"B"},{value:1e12,symbol:"T"},{value:1e15,symbol:"Q"},{value:1e18,symbol:"Q"}].findLast((t=>e>=t.value));let a=n?(e/n.value).toFixed(t).replace(/\.0+$|(?<=\.[0-9]*[1-9])0+$/,"").concat(n.symbol):"0";return o&&(a="-"+a),a}function parseFormattedAmount(e){"string"!=typeof e&&(e=String(e));const t=e.match(/^([\d\.]+)([KMBT]?)$/);if(!t)return NaN;const o=parseFloat(t[1]),n={K:1e3,M:1e6,B:1e9,T:1e12}[t[2]]||1;return Math.round(o*n)}function loadingScreen(e){const t=document.querySelector("#voxels-main-modal"),o=document.querySelector(".voxels-main"),n=document.createElement("div");if(n.id="voxels-loading-div",n.classList.add("voxels-loading"),1===e)n.innerHTML='<div class="voxels-loader"></div>',o.appendChild(n),t.style.filter="brightness(0.5)";else{const e=document.getElementById("voxels-loading-div");e&&e.parentNode===o&&o.removeChild(e),t.style.filter=""}}function loadingScreenFull(e){const t=document.querySelector("#voxels-full-page"),o=document.createElement("div");if(o.id="voxels-loading-div",o.classList.add("voxels-loading"),1===e)o.innerHTML='<div class="voxels-loader"></div>',t.appendChild(o),t.style.filter="brightness(0.5)";else{const e=document.getElementById("voxels-loading-div");e&&e.parentNode===t&&t.removeChild(e),t.style.filter=""}}let dragging=!1;const lastPosition={};let dragBoundaries;function setupDraggable(){dragHandleEl=document.querySelector("[data-drag-handle]"),dragHandleEl.addEventListener("mousedown",dragStart),document.addEventListener("mouseup",dragEnd)}function dragStart(e){0===e.button&&(dragging=!0,dragEl=getDraggableAncestor(e.target),dragEl.style.setProperty("position","absolute"),lastPosition.left=e.target.clientX,lastPosition.top=e.target.clientY,dragHandleEl.classList.add("dragging"),document.addEventListener("mousemove",dragMove))}function dragMove(e){if(1!==e.buttons)return;const t=dragEl.getBoundingClientRect(),o=t.left+e.clientX-lastPosition.left,n=t.top+e.clientY-lastPosition.top,a=window.innerWidth-t.width,s=window.innerHeight-t.height,r=Math.max(0,Math.min(o,a)),i=Math.max(0,Math.min(n,s));dragEl.style.setProperty("left",`${r}px`),dragEl.style.setProperty("top",`${i}px`),lastPosition.left=e.clientX,lastPosition.top=e.clientY,window.getSelection().removeAllRanges(),0!==r&&r!==a&&0!==i&&i!==s||0===e.buttons&&dragEnd()}function getDraggableAncestor(e){return e.getAttribute("data-draggable")?e:getDraggableAncestor(e.parentElement)}function dragEnd(){if(dragging){dragHandleEl.classList.remove("dragging"),document.removeEventListener("mousemove",dragMove),dragEl=null,dragging=!1;var e=document.getElementById("voxels-main-modal"),t={};t.top=e.style.top,t.left=e.style.left,chrome.storage.local.set({modalPosition:t})}}function responsiveDraggableReset(){var e=document.getElementById("voxels-main-modal");window.innerWidth>540?(e.style.top="70px",e.style.left="20px"):(e.style.top="50%",e.style.left="50%")}function inputWithCallback(e,t){var o=document.createElement("div");o.className="voxels-popup-input",o.innerHTML="<h3>"+e+'</h3><input type="text" id="inputField"><button id="submitButton">OK</button>',o.classList.add("voxels-popup-info");var n=o.querySelector("#inputField");n.addEventListener("keydown",(function(e){document.activeElement===n&&(e.stopPropagation(),"Enter"===e.key&&document.getElementById("submitButton").click())}));var a=document.createElement("div");a.className="voxels-popup-close",a.innerHTML="X",o.appendChild(a),document.body.appendChild(o),a.addEventListener("click",(function(){o.remove()})),document.getElementById("inputField").focus(),document.getElementById("submitButton").addEventListener("click",(function(){var e=document.getElementById("inputField").value.trim();""===e?showAlert("Please enter some input.","error"):(t(e),o.remove())}))}function limiter(e,t){let o=0;return function(...n){const a=Date.now();if(a-o>=t)return e(...n),o=a,!0;return quickMessage("Please wait "+Math.round((t-(a-o))/1e3)+"s...","error"),!1}}function voxelsConfirm(e,t){var o=document.createElement("div");o.classList.add("voxels-popup-storage","voxels-popup-info"),o.innerHTML="<h3>"+e+'</h3><button id="confirmButton">Yes</button>';var n=document.createElement("div");function a(){o.remove()}n.className="voxels-popup-close",n.innerHTML="X",o.appendChild(n),document.body.appendChild(o),n.addEventListener("click",a),document.getElementById("confirmButton").addEventListener("click",(function(){t(!0),a()}))}function openFullpage(){document.body.classList.contains("js-voxels-main-modal-active")&&document.body.classList.toggle("js-voxels-main-modal-active");document.querySelector("#voxels-full-page").style.display="flex",fullPageActive=!0}function closeFullpage(){document.querySelector("#voxels-full-page").style.display="none",fullPageActive=!1}function showFullOverlay(){document.querySelector("#voxels-full-page-overlay").style.display="block"}function hideFullOverlay(){document.querySelector("#voxels-full-page-overlay").style.display="none"}function toggleNotifications(){if(premium)return notifications=!notifications,quickMessage("Nofications "+(notifications?"On":"Off"),"info"),chrome.storage.local.set({notifications:notifications}),!0}function toggleStorageHover(){return displayStorageHover=!displayStorageHover,quickMessage("Storage Hover "+(displayStorageHover?"On":"Off"),"info"),chrome.storage.local.set({storageHover:displayStorageHover}),!0}function toggleTaskboardDisplay(){return taskboardTiles=!taskboardTiles,quickMessage("Taskboard style: "+(taskboardTiles?"Minimal":"Detailed"),"info"),chrome.storage.local.set({taskboardTiles:taskboardTiles}),loadTasks(0),!0}function toggleVoxels(){voxelsDisplayed=!voxelsDisplayed;const e=document.body,t=document.querySelector("#voxels-main-nav"),o=document.querySelector("#voxels-toggle-voxels-button");return voxelsDisplayed?(t.style.display="flex",o.style.display="none",e.classList.add("js-voxels-main-modal-active")):(t.style.display="none",o.style.display="flex",e.classList.remove("js-voxels-main-modal-active")),chrome.storage.local.set({voxelsDisplayed:voxelsDisplayed}),!0}function initCustomSelect(){var e=document.querySelector(".voxels-custom-select-selected"),t=document.querySelector(".voxels-custom-select-items"),o=t.querySelectorAll("li");e.addEventListener("click",(function(){t.classList.toggle("voxels-custom-select-hide"),e.classList.toggle("voxels-custom-select-arrow-active"),e.classList.toggle("voxels-custom-select-arrow-inactive")})),o.forEach((function(o){o.addEventListener("click",(function(){e.textContent=this.textContent,e.setAttribute("data-select",this.textContent),t.classList.add("voxels-custom-select-hide"),e.classList.remove("voxels-custom-select-arrow-active"),e.classList.add("voxels-custom-select-arrow-inactive")}))})),document.addEventListener("click",(function(o){e.contains(o.target)||(t.classList.add("voxels-custom-select-hide"),e.classList.remove("voxels-custom-select-arrow-active"),e.classList.add("voxels-custom-select-arrow-inactive"))}))}function toggleItems(e){e.currentTarget.closest(".voxels-playerpage-info-subsection").querySelectorAll(".voxels-playerpage-info-row").forEach(((e,t)=>{e.classList.contains("js-visible")?e.classList.remove("js-visible"):setTimeout((()=>{e.classList.add("js-visible")}),100*t)}))}function loadPlayerPageTop(){openFullpage();var e=document.getElementById("voxels-full-page-main");e.innerHTML="";var t=document.createElement("div");t.setAttribute("id","voxels-player-home");var o=document.createElement("div");o.classList.add("voxels-player-top-row");var n=document.createElement("img");n.src=chrome.runtime.getURL("images/icons/icon__house.svg"),n.classList.add("voxels-player-home-icon","clickable"),n.onclick=function(){loadLeaderboardPage("overall")},o.appendChild(n);var a=document.createElement("img");a.src=chrome.runtime.getURL("images/icons/icon__player.svg"),a.classList.add("voxels-player-page-icon","clickable"),a.onclick=function(){chrome.storage.local.get("pid",(function(e){e.pid&&loadPlayerPage(e.pid)}))},o.appendChild(a);var s=document.createElement("div");s.classList.add("voxels-player-input-container");var r=document.createElement("input");r.setAttribute("type","text"),r.setAttribute("placeholder","Enter username, id or wallet..."),r.classList.add("voxels-player-input"),r.setAttribute("autocomplete","off");var i=document.createElement("button");i.setAttribute("id","playerSubmitButton"),i.innerHTML="&#8594;",i.classList.add("voxels-player-submit-button");const l=limiter((function(e){searchPlayer(e)}),5e3);i.onclick=function(){r.value.length<=45?l(r.value):quickMessage("Please check your input","error")},r.addEventListener("keydown",(function(e){document.activeElement===r&&(e.stopPropagation(),"Enter"===e.key&&document.getElementById("playerSubmitButton").click())}));const c=document.createElement("ul");function d(e){return e.toLowerCase().replace(/[^\p{L}\p{N}]/gu,"")}c.classList.add("voxels-player-input-suggestions","voxels-scroll"),s.appendChild(c),r.addEventListener("input",(function(){const e=d(r.value);if(c.innerHTML="",!e||0===usernames.length)return void(c.style.display="none");const t=[],o=[],n=[];for(const a of usernames){const s=d(a);s===e?t.push(a):s.startsWith(e)?o.push(a):s.includes(e)&&n.push(a)}const a=[...t,...o,...n].slice(0,100);0!==a.length?(c.style.display="block",a.forEach((e=>{const t=document.createElement("li");t.classList.add("voxels-player-input-suggestion","clickable"),t.textContent=e,t.addEventListener("click",(()=>{searchPlayer(e),r.value=e,c.innerHTML=""})),c.appendChild(t)}))):c.style.display="none"})),r.addEventListener("blur",(()=>{setTimeout((()=>{c.style.display="none"}),100)})),s.appendChild(r),s.appendChild(i),o.appendChild(s),t.appendChild(o);var m=document.createElement("div");m.setAttribute("id","voxels-player-main-area"),m.classList.add("voxels-scroll"),t.appendChild(m),e.appendChild(t),switchFullPageNav("player")}function loadGuildPageTop(){var e=document.getElementById("voxels-full-page-main");e.innerHTML="";var t=document.createElement("div");t.setAttribute("id","voxels-guild-home");var o=document.createElement("div");o.classList.add("voxels-guild-top-row");var n=document.createElement("img");n.src=chrome.runtime.getURL("images/icons/icon__house.svg"),n.classList.add("voxels-guild-home-icon","clickable"),n.addEventListener("click",(function(){loadGuildsPage()})),o.appendChild(n),t.appendChild(o);var a=document.createElement("div");a.setAttribute("id","voxels-guild-main-area"),a.classList.add("voxels-scroll"),t.appendChild(a),e.appendChild(t),switchFullPageNav("guilds")}function switchFullPageNav(e){const t=document.querySelectorAll(".voxels-full-nav-item");t.forEach((e=>{e.classList.remove("active")}));const o=Array.from(t).find((t=>t.textContent.toLowerCase()===e));o&&o.classList.add("active"),activeFullPage=e}onPlayPixels&&window.addEventListener("resize",(function(){responsiveDraggableReset()}),!0);let currentPricesList=[];function fetchItemListPrices(e){e.length>1&&chrome.storage.local.get("pid",(async function(t){const o={pid:t.pid,operation:"retrieveItems",extra:e};try{const e=await makeFetchRequestByPID(apiURL,o);currentPricesList=e.data,firstLoadForPet&&(previousPetInventory=null,firstLoadForPet=!1)}catch(e){reject(e)}}))}const getImageForItem=e=>{const t=displayNamesJSONArray.find((t=>t.item===e));if(!t)return"";let o=t.image;return o.startsWith("cdn:/")&&(o=o.replace("cdn:/","https://d31ss916pli4td.cloudfront.net/")),o},getNameForItem=e=>{const t=displayNamesJSONArray.find((t=>t.item===e));return t?t.display_name:e},getItmByName=e=>{const t=displayNamesJSONArray.find((t=>t.display_name===e));return t?t.item:null};function mapItmToNameAndImage(e){return e.map((e=>{const t=displayNamesJSONArray.find((t=>t.item===e));return t?{item:e,image:t.image,displayName:t.display_name}:{item:e,image:"https://pixels-api.com/images/item_not_found.png",displayName:"Item not identified"}}))}function loadItemData(e){const t=getImageForItem(e)||"https://pixels-api.com/images/item_not_found.png",o=marketPrices[e]||0,n=getNameForItem(e);let a=0;for(const t in storedItemCache)if(storedItemCache.hasOwnProperty(t)){const o=storedItemCache[t];for(const t in o)if(o.hasOwnProperty(t)){const n=o[t];if(n.items&&Array.isArray(n.items))for(const t of n.items)t.item===e&&(a+=t.count)}}let s=0;if(sentInventory&&sentInventory.items)for(const t of sentInventory.items)t.item===e&&(s+=t.quantity);return{imageSrc:t,price:o,displayName:n,storageCount:a,inventoryCount:s}}const findRecipe=(e,t=1)=>{let o=craftingRecipesJSONArray.find((o=>o.item===e&&o.quantity===t));return o||(o=craftingRecipesJSONArray.find((t=>t.item===e&&1===t.quantity))),o||null};function findRecipeByName(e){return craftingRecipesJSONArray.find((t=>t.name&&t.name.trim().toLowerCase()===e.trim().toLowerCase()))||null}const findRecipeByAchievement=e=>craftingRecipesJSONArray.find((t=>t.ach===e))||null;function createRecipeContainer(e){const t=e.requiredItems,o=mapItmToNameAndImage(t.map((e=>e.id))),n=e.energy,a=e.minutesRequired,s=Math.round(60*a),r=Math.floor(s/3600),i=Math.floor(s%3600/60),l=s%60;let c="";r>0&&(c+=`${r}h `),(i>0||r>0)&&(c+=`${i}m `),(l>0||""===c)&&(c+=`${l}s`);const d=document.createElement("div");d.classList.add("voxels-tooltip-recipe-container");const m=document.createElement("div");m.classList.add("voxels-tooltip-recipe-header");const u=document.createElement("div");u.classList.add("voxels-tooltip-recipe-span");const p=document.createElement("img");p.src=chrome.runtime.getURL("images/icons/icon_energy.png"),p.alt="Energy",p.classList.add("voxels-tooltip-energy-icon");const v=document.createElement("img");v.src=chrome.runtime.getURL("images/Farms/voxels_custom.png"),v.alt="Time",v.classList.add("voxels-tooltip-timer-icon");const g=document.createTextNode("Recipe - "),f=document.createTextNode(`${n}`),h=document.createTextNode(`${c}`);m.appendChild(g),u.appendChild(p),u.appendChild(f),u.appendChild(v),u.appendChild(h),m.appendChild(u),d.appendChild(m);const y=document.createElement("div");y.classList.add("voxels-tooltip-recipe-cost");let x=0;t.forEach((e=>{const t=marketPrices[e.id]||0;x+=t*e.quantity}));const L=50*e.energy;x+=L;const E=(marketPrices[e.item]||0)*(e.quantity||1)*.99-x,b=nFormatter(x,2),k=nFormatter(Math.abs(E),2),C=E>=0?"voxels-task-cost-positive":"voxels-task-cost-negative";y.innerHTML=`\n    Cost: <span>${b}</span> - \n    Profit: <span class="${C}">${E>=0?"":"-"}${k}</span>\n    `,d.appendChild(y);const w=document.createElement("div");return w.classList.add("voxels-tooltip-recipe-items-container"),o.forEach(((e,o)=>{const n=t[o].quantity,a=document.createElement("div");a.classList.add("voxels-tooltip-recipe-item"),a.setAttribute("data-item-name",e.name);const s=document.createElement("img");s.src=e.image,s.alt=e.name,s.classList.add("voxels-tooltip-recipe-image");const r=document.createElement("div");r.classList.add("voxels-tooltip-recipe-count"),r.textContent=`x${n}`,a.appendChild(s),a.appendChild(r),w.appendChild(a)})),d.appendChild(w),d}let addMarketItemAmount=null,craftingFavourite=null,currentCrafting=null;function checkElementExistence(){const e=document.body;let t=[],o=!1;const n=()=>{o=!1,t=[];const e=document.querySelector(nodeNames.introLogo);!gameDisconnect&&e&&e.classList.length>0&&hasBeenIngame&&(gameDisconnect=!0);const n=document.querySelector(nodeNames.farmOwner);if(n){const e=Array.from(n.querySelectorAll("div")).find((e=>e.textContent?.startsWith("Owner: ")));e&&!e.classList.contains("voxels-owner-clicked")&&(e.classList.add("voxels-owner-clicked","clickable"),e.addEventListener("click",(()=>{const t=e.textContent.match(/Owner:\s*(0x[a-fA-F0-9]{40})/);if(t){const e=t[1];loadPlayerPageTop(),searchPlayer(e)}})))}const a=document.querySelector(nodeNames.craftingImageWrapper);if(a){const e=document.querySelector(nodeNames.craftingDetailsColumn)?.querySelector(nodeNames.craftingDetailsText),t=e?.textContent?.trim();if(t&&t!==currentCrafting){currentCrafting=t;const e=findRecipeByName(t);e&&(a.classList.contains("clickable")||a.classList.add("clickable"),attachHoverDetails(a,e.item,e.quantity||1))}}if(settings.favourite){const e=document.querySelector(nodeNames.craftingDetailsTitle),t=document.querySelector(nodeNames.speedUpButton),o=e?.querySelector(".voxels-favourite-banner");if(e)if(t&&o)o.remove();else if(!t&&!o){const t=document.createElement("div");t.classList.add("voxels-favourite-banner","clickable");const o=document.createElement("img");o.src=chrome.runtime.getURL("images/icons/icon__favourite.svg"),o.alt="Favourite",t.appendChild(o),e.appendChild(t),t.addEventListener("click",(()=>{const t=e.querySelector(nodeNames.craftingDetailsText)?.textContent?.trim();t&&(document.querySelectorAll(".voxels-scrolled-to").forEach((e=>{e.classList.remove("voxels-scrolled-to")})),t===craftingFavourite?(quickMessage("Crafting favourite removed","success"),craftingFavourite=null):(quickMessage(`Crafting favourite set to "${t}"`,"success"),craftingFavourite=t))}))}}if(craftingFavourite){const e=Array.from(document.querySelectorAll(nodeNames.craftingDetailsText)).find((e=>e.textContent.trim()===craftingFavourite));e&&!e.classList.contains("voxels-scrolled-to")&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("voxels-scrolled-to"))}const s=document.querySelector(nodeNames.creatorCode);if(s){const e=s.querySelector("a");if(e&&"Enter creator code?"===e.textContent.trim()){if(!s.querySelector(".voxels-creator-reminder")){const e=document.createElement("div");e.className="voxels-creator-reminder";const t=document.createElement("div");t.className="voxels-creator-reminder-inner",t.textContent=String.fromCodePoint(128070)+" Add creator code for a 5% discount",e.appendChild(t),s.appendChild(e)}}else{const e=s.querySelector(".voxels-creator-reminder");e&&e.remove()}}const r=document.querySelector(nodeNames.creatorCodeInputContainer);if(r&&!r.querySelector(".voxels-creator-insert")){const e=document.createElement("div");e.classList.add("voxels-creator-insert","clickable"),e.innerHTML='1. Click here to add "'+savedCreatorCode+'"<br>2. Click "Check"',e.addEventListener("click",(()=>{const e=r.querySelector(`input${nodeNames.creatorCodeInput}`);e&&setNativeInputValue(e,savedCreatorCode)}));const t=r.querySelector(`input${nodeNames.creatorCodeInput}`);t&&r.insertBefore(e,t)}const i=document.querySelector(nodeNames.market_listingInfo);if(i&&!document.querySelector(".voxels-floor-price")){const e=i.querySelectorAll("span");if(e.length>=2){const t=e[1],o=t.textContent.trim(),n=parseFloat(o.replace(/[^0-9.]/g,""));if(!isNaN(n)){t.classList.add("voxels-floor-price");const e=document.createElement("img");e.src=chrome.runtime.getURL("images/icons/icon__down-arrow.svg"),e.classList.add("voxels-floor-price-action","clickable"),t.appendChild(e);const o=()=>{const e=document.querySelector(nodeNames.market_priceInputWrapper);if(!e)return;const t=e.querySelector('input[type="number"]');t&&setNativeInputValue(t,n-1)};e.addEventListener("click",o)}}}const l=document.querySelector(nodeNames.market_item_amount+' input[type="number"]');l?(setTimeout((()=>{const e=parseInt(l.value,10);isNaN(e)||e===addMarketItemAmount||(addMarketItemAmount=e,addMarketItemData())}),10),l.addEventListener("input",(e=>{const t=parseInt(e.target.value,10);isNaN(t)||t===addMarketItemAmount||(addMarketItemAmount=t,addMarketItemData())}))):null!==addMarketItemAmount&&(addMarketItemAmount=null,addMarketItemData());if(document.querySelector(nodeNames.market_place)&&!document.querySelector(".voxels-market-create-price")&&addPricesToSellPage(),premium){document.querySelector(nodeNames.tasksCard)&&(checkTasks(),document.querySelectorAll(nodeNames.tasksCard).forEach((e=>{const t=e.querySelector(".voxels-tasks-prices"),o=e.querySelector(nodeNames.tasksTitle)?.innerText?.trim().toUpperCase()||"";t||o.startsWith("NEW TASK")||addTaskPrices(".voxels-tasks-prices")})))}};new MutationObserver((e=>{t.push(...e);t.some((e=>"characterData"===e.type||e.addedNodes.length>0||e.removedNodes.length>0))&&!o&&(o=!0,setTimeout(n,50))})).observe(e,{childList:!0,subtree:!0,characterData:!0})}function setNativeInputValue(e,t){Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set.call(e,t),e.dispatchEvent(new Event("input",{bubbles:!0}))}checkElementExistence();const hoverHandlers=new Map;function attachHoverDetails(e,t,o){const n=loadItemData(t),a=hoverHandlers.get(e);a&&(e.removeEventListener("mouseenter",a.mouseenter),e.removeEventListener("mouseleave",a.mouseleave),e.removeEventListener("click",a.click));const s=()=>{const a=document.createElement("div");a.classList.add("voxels-ms-hover");const s=document.createElement("div");s.classList.add("voxels-ms-hover-name"),s.textContent=n.displayName,a.appendChild(s);const r=nFormatter(o*n.price,1),i=nFormatter(n.price,1),l=document.createElement("img");l.src=chrome.runtime.getURL("images/Prices/coin.png"),l.classList.add("voxels-ms-price-icon");const c=document.createElement("div");if(c.classList.add("voxels-ms-hover-price"),c.appendChild(document.createTextNode(`${o} x `)),c.appendChild(l.cloneNode()),c.appendChild(document.createTextNode(` ${i} = `)),c.appendChild(l.cloneNode()),c.appendChild(document.createTextNode(` ${r}`)),a.appendChild(c),premium){let e=0;for(const o in storedItemCache){const n=storedItemCache[o];for(const o in n){const a=n[o];if(a.items)for(const o of a.items)o.item===t&&(e+=o.count)}}const o=document.createElement("div");o.classList.add("voxels-ms-hover-storage"),o.innerHTML=`<span>Storage:</span> ${e} <span>(Shift + Click to Search)</span>`,a.appendChild(o)}const d=findRecipe(t,o);if(d){const e=createRecipeContainer(d);a.appendChild(e)}const m=historic_item_prices(t);if(m){const e=document.createElement("div");e.classList.add("voxels-networth-hover-graph-container");const o=document.createElement("div");o.classList.add("voxels-networth-hover-graph-header"),o.textContent="7-day Graph",e.appendChild(o);let n=[...m];marketPrices[t]&&n.push({t:Math.floor(Date.now()/1e3),p:marketPrices[t]});const s=renderPriceChart(n);e.appendChild(s),a.appendChild(e)}document.body.appendChild(a);const u=e.getBoundingClientRect(),p=a.offsetWidth,v=a.offsetHeight;let g=u.left+u.width/2-p/2,f=u.top-v-5;const h=window.innerWidth;g<0&&(g=5),g+p>h&&(g=h-p),f<0&&(f=5),a.style.position="absolute",a.style.left=`${g}px`,a.style.top=`${f}px`,premium&&(currentItemHovered=t,itemHoverLoop())},r=()=>{document.querySelectorAll(".voxels-ms-hover").forEach((e=>e.remove())),premium&&(currentItemHovered=null)},i=e=>{premium&&e.shiftKey&&changeTab("networth",n.displayName)};e.addEventListener("mouseenter",s),e.addEventListener("mouseleave",r),e.addEventListener("click",i),hoverHandlers.set(e,{mouseenter:s,mouseleave:r,click:i})}document.addEventListener("keydown",(e=>{"Escape"===e.key&&document.querySelector(".voxels-ms-hover")&&(document.querySelectorAll(".voxels-ms-hover").forEach((e=>e.remove())),premium&&(currentItemHovered=null))}),!0);